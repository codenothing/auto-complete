/*
 * Auto Complete 4.0
 * September 28, 2009
 * Corey Hart @ http://www.codenothing.com
 */
;(function(c,d){c.fn.autoComplete=function(f,h,e,i){if(h===d||typeof h!=="number"){return a.call(this,f)}var g=c.Event("keyup");g.keyCode=h;return c(this).trigger(g,[f,e,i])};c.fn.bgiframe=c.fn.bgiframe?c.fn.bgiframe:c.fn.bgIframe?c.fn.bgIframe:function(){return this};var b=0,a=function(e){return this.each(function(){var o=c(this).attr("autocomplete","off"),n,g,i,f,k=c.extend({opt:-1,inputval:d,mouseClick:false,dataName:"ac-data",inputIndex:++b,ajax:"ajax.php",dataSupply:[],dataFn:d,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:o.outerWidth(),postVar:"value",postData:{},minChars:1,maxItems:-1,maxRequests:0,requestType:"post",requests:0,onMaxRequest:function(){},onSelect:function(){},onRollover:function(){},onBlur:function(){},onFocus:function(){},preventEnterSubmit:false,enter:true,delay:100,selectFuncFire:true,useCache:true,cacheLimit:50,cacheLength:0,cache:{}},e||{},c.metadata?o.metadata():{}),l=c("ul."+k.list)[0]?c("ul."+k.list).bgiframe():c("<ul/>").appendTo("body").addClass(k.list).bgiframe().hide();o.bind("keyup.autoComplete",function(t,r,p,v){var q=t.keyCode;k.mouseClick=false;if(r&&typeof r==="object"){var u=c.extend(true,{},k);k=c.extend(true,k,r);if(v){if(!p){k=u}return false}}if(q==13&&n){k.opt=-1;if(k.selectFuncFire){k.selectFuncFire=false;k.onSelect.call(o[0],n.data(k.dataName),n,l);if(i){clearTimeout(i)}i=setTimeout(function(){k.selectFuncFire=true},1000)}l.hide()}else{if(q==38){if(k.opt>0){k.opt--;n=c("li",l).removeClass(k.rollover).eq(k.opt).addClass(k.rollover);o.val(n.data(k.dataName).value||"");k.onRollover.call(o[0],n.data(k.dataName),n,l)}else{k.opt=-1;o.val(k.inputval);l.hide()}}else{if(q==40){if(k.opt<c("li",l).length-1){k.opt++;n=c("li",l.show()).removeClass(k.rollover).eq(k.opt).addClass(k.rollover);o.val(n.data(k.dataName).value||"");k.onRollover.call(o[0],n.data(k.dataName),n,l)}}else{k.opt=-1;k.inputval=o.val();if(k.inputval.length>=k.minChars){if(g){clearTimeout(g)}g=setTimeout(function(){h(k);if(u&&!p){k=u}clearTimeout(g)},k.delay)}else{if(q==8){l.html("").hide()}}}}}if(u&&!p&&!g){k=u}}).bind("blur.autoComplete",function(){k.enter=true;f=setTimeout(function(){if(k.mouseClick){return false}k.opt=-1;k.onBlur.call(o[0],k.inputval,l);l.hide()},150)}).bind("focus.autoComplete",function(){k.enter=false;if(k.inputIndex!=l.data("ac-input-index")){l.html("").hide()}k.onFocus.call(o[0],l)}).parents("form").eq(0).bind("submit.autoComplete",function(){return k.preventEnterSubmit?k.enter:true});function h(p){if(p.maxRequests&&++p.requests>=p.maxRequests){return p.requests>p.maxRequests?false:p.onMaxRequest.call(o[0],p.inputval,l)}if(p.useCache&&p.cache[p.inputval]){return m(p.cache[p.inputval],p)}if(p.dataSupply.length){return j(p)}p.postData[p.postVar]=p.inputval;c[p.requestType](p.ajax,p.postData,function(q){if(p.useCache){p.cacheLength++;p.cache[p.inputval]=q;if(p.cacheLength>p.cacheLimit){p.cache={};p.cacheLength=0}}m(q,p)},"json")}function j(t){var r=[],s=c.isFunction(t.dataFn),v=new RegExp("^"+t.inputval,"i"),p=0,u,q;for(q in t.dataSupply){u=t.dataSupply[q];u=typeof u==="object"?u:{value:u};if((s&&t.dataFn.call(o,t.inputval,u.value,r,q,t.dataSupply))||(!s&&u.value.match(v))){if(t.maxItems>-1&&++p>t.maxItems){break}r.push(u)}}m(r,t)}function m(t,s){if(!t||t.length<1){return l.html("").hide()}var u=o.offset();l.data("ac-input-index",s.inputIndex).html("").css({top:u.top+o.outerHeight(),left:u.left,width:s.width});var p=0,q=0,r;for(r in t){if(t[r].value){if(s.maxItems>-1&&++q>s.maxItems){break}c("<li/>").appendTo(l).html(t[r].display||t[r].value).data(s.dataName,t[r]).data("ac-index",p++)}}l.show().bind("mouseout.autoComplete",function(){c("li."+s.rollover,l).removeClass(s.rollover);if(!s.mouseClick&&s.selectFuncFire){o.val(s.inputval)}}).children("li").bind("mouseover.autoComplete",function(){n=c(this);c("li."+s.rollover,l).removeClass(s.rollover);o.val(n.addClass(s.rollover).data(s.dataName).value);s.onRollover.call(o[0],n.data(s.dataName),n,l);s.opt=n.data("ac-index")}).bind("click.autoComplete",function(){s.mouseClick=true;if(f){clearTimeout(f)}s.onSelect.call(o[0],n.data(s.dataName),n,l);l.hide();o.focus()})}})}})(jQuery);
