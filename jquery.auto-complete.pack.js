/**
 * Auto Complete v3.0
 * July 26, 2009
 * Released under the MIT License @ http://www.codenothing.com/license
 * Corey Hart @ http://www.codenothing.com
 */ 
(function($){$.fn.autoComplete=function(options){return this.each(function(){var $input=$(this).attr("autocomplete","off"),$li,timeid,blurid,settings=$.extend({opt:-1,inputval:"",mouseClick:false,ajax:"ajax.php",list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:$input.outerWidth(),top:$input.offset().top+$input.outerHeight(),left:$input.offset().left,postVar:"value",postData:{},minChars:1,maxRequests:0,requests:0,onMaxRequest:function(){},onSelect:function(){},onRollover:function(){},onBlur:function(){},preventEnterSubmit:false,enter:false,delay:100,selectFuncFire:true,useCache:true,cacheLimit:50,cacheLength:0,cache:{}},options||{},$.metadata?$input.metadata():{});var $ul=$("ul."+settings.list)[0]?$("ul."+settings.list):$("<ul/>").appendTo("body").addClass(settings.list).hide();$input.keyup(function(e){var key=e.keyCode;settings.enter=false;settings.mouseClick=false;if((key>47&&key<91)||key==8){settings.opt=-1;settings.inputval=$input.val();if(settings.inputval.length>=settings.minChars){if(timeid){clearTimeout(timeid)}timeid=setTimeout(function(){sendRequest(settings)},settings.delay)}else{if(key==8){$ul.html("").hide()}}}else{if(key==13&&$li){settings.opt=-1;settings.enter=true;if(settings.selectFuncFire){settings.selectFuncFire=false;settings.onSelect($li.data("data"),$li);setTimeout(function(){settings.selectFuncFire=true},1000)}$ul.hide()}else{if(key==38){if(settings.opt>0){settings.opt--;$li=$("li",$ul).removeClass(settings.rollover).eq(settings.opt).addClass(settings.rollover);$input.val($li.data("data").value||"");settings.onRollover($li.data("data"),$li)}else{settings.opt=-1;$input.val(settings.inputval);$ul.hide()}}else{if(key==40){if(settings.opt<$("li",$ul).length-1){settings.opt++;$li=$("li",$ul.show()).removeClass(settings.rollover).eq(settings.opt).addClass(settings.rollover);$input.val($li.data("data").value||"");settings.onRollover($li.data("data"),$li)}}}}}}).blur(function(){blurid=setTimeout(function(){if(settings.mouseClick){return false}settings.opt=-1;settings.onBlur(settings.inputval,$ul);$ul.hide()},150)}).parents("form").eq(0).submit(function(){return settings.preventEnterSubmit?settings.enter:true});function sendRequest(settings){if(settings.maxRequests&&settings.requests>settings.maxRequests){return settings.onMaxRequest()}else{if(settings.maxRequests){settings.requests++}}if(settings.useCache&&settings.cache[settings.inputval]){return loadResults(settings.cache[settings.inputval])}settings.postData[settings.postVar]=settings.inputval;$.post(settings.ajax,settings.postData,function(json){json=json&&json!=""?eval("("+json+")"):{};if(settings.useCache){settings.cacheLength++;settings.cache[settings.inputval]=json;if(settings.cacheLength>settings.cacheLimit){settings.cache={};settings.cacheLength=0}}if(json.length>0){loadResults(json)}else{$ul.html("").hide()}})}function loadResults(list){$ul.html("").css({top:settings.top,left:settings.left,width:settings.width});for(i in list){if(list[i].value){$("<li/>").appendTo($ul).html(list[i].display||list[i].value).data("data",list[i])}}$ul.show().children("li").mouseover(function(){$li=$(this);$("li."+settings.rollover,$ul).removeClass(settings.rollover);$input.val($li.addClass(settings.rollover).data("data").value);settings.onRollover($li.data("data"),$li)}).click(function(){settings.mouseClick=true;if(blurid){clearTimeout(blurid)}settings.onSelect($li.data("data"),$li);$ul.hide();$input.focus()});$ul.mouseout(function(){$("li."+settings.rollover,$ul).removeClass(settings.rollover);if(!settings.mouseClick){$input.val(settings.inputval)}})}})}})(jQuery);
