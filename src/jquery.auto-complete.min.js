/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */
(function(e,h,a){e.fn.autoComplete=function(){var o=j.call(arguments),n=this,q=o.shift(),p=typeof q==="string";if(p){q=q.replace(".","-")}o=q==="button-supply"||q==="direct-supply"?e.isArray(o[0])&&e.isArray(o[0][0])?o[0]:o:o[1]===a&&e.isArray(o[0])?o[0]:o;return p?n[q==="option"&&o.length<2?"triggerHandler":"trigger"]("autoComplete."+q,o):q&&q[e.expando]?n.trigger(q,o):n.each(function(){f(this,q)})};e.fn.bgiframe=e.fn.bgiframe?e.fn.bgiframe:e.fn.bgIframe?e.fn.bgIframe:function(){return this};function b(){if(b.flag!==true){b.flag=true;l.bind("click.autoComplete",function(n){e(g.getFocus()).trigger("autoComplete.document-click",[n])})}}function k(){if(b.flag===true&&g.length===0){b.flag=false;l.unbind("click.autoComplete")}}var c=true,i=false,j=Array.prototype.slice,l=e(h.document),m="autoComplete_"+e.expando,d={backspace:8,tab:9,enter:13,space:32,pageup:33,pagedown:34,up:38,down:40},g=e.autoComplete={version:"[VERSION]",counter:0,length:0,stack:{},order:[],hasFocus:i,getFocus:function(){return g.order[0]?g.stack[g.order[0]]:a},getPrevious:function(){for(var o=0,n=g.order.length;++o<n;){if(g.order[o]){return g.stack[g.order[o]]}}return a},remove:function(q){for(var p=-1,o=g.order.length;++p<o;){if(g.order[p]===q){g.order[p]=a}}g.stack[q]=a;g.length--;delete g.stack[q]},getAll:function(){for(var p=-1,o=g.counter,n=[];++p<o;){if(g.stack[p]){n.push(g.stack[p])}}return e(n)},defaults:{backwardsCompatible:i,ajax:"ajax.php",ajaxCache:e.ajaxSettings.cache,dataSupply:[],dataFn:a,formatSupply:a,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:a,striped:a,maxHeight:a,newList:i,postVar:"value",postData:{},postFormat:a,minChars:1,maxItems:-1,maxRequests:0,requestType:"POST",inputControl:a,autoFill:i,nonInput:a,multiple:i,multipleSeparator:" ",onBlur:a,onFocus:a,onHide:a,onLoad:a,onMaxRequest:a,onRollover:a,onSelect:a,onShow:a,onSubmit:function(){return c},spinner:a,onListFormat:a,preventEnterSubmit:c,delay:0,useCache:c,cacheLimit:50}},f=function(H,r){g.length++;g.counter++;var n=e(H).attr("autocomplete","off"),L=c,v={},D="",u=[],E={length:0},A,C,S,o,K,N=i,M,w,t=-1,s,q,G=g.counter,p=0,F={length:0,val:a,list:{}},P=e.extend({width:n.outerWidth()},g.defaults,r||{},e.metadata?n.metadata():{}),z=!P.newList&&e("ul."+P.list)[0]?e("ul."+P.list).eq(0).bgiframe().data("autoComplete",c):e("<ul/>").appendTo("body").addClass(P.list).bgiframe().hide().data({"ac-selfmade":c,autoComplete:c});n.data({autoComplete:c,"ac-input-index":G,"ac-active":L,"ac-initial-settings":e.extend(c,{},P),"ac-settings":P}).bind(h.opera?"keypress.autoComplete":"keydown.autoComplete",function(U){if(!L){return c}var T=(v=U).keyCode,V=i;if(T===d.tab&&N){J(U)}else{if(T===d.enter&&A){V=P.preventEnterSubmit&&N?i:c;J(U)}else{if(T===d.up){if(t>0){t--;y(U)}else{t=-1;n.val(D);z.hide(U)}}else{if(T===d.down){if(t<E.length-1){t++;B(U)}}else{if(T===d.pageup){if(t>0){t-=K;if(t<0){t=0}y(U)}}else{if(T===d.pagedown){if(t<E.length-1){t+=K;if(t>E.length-1){t=E.length-1}B(U)}}else{if(P.nonInput&&e.inArray(T,P.nonInput)){z.html("").hide(U)}else{return c}}}}}}}v["keydown_"+m]=c;return V}).bind({"keyup.autoComplete":function(U){if(!L||v["keydown_"+m]){return c}D=n.val();var T=(v=U).keyCode,V=q?D.split(q).pop():D;if(T!=d.enter){F.val=P.inputControl===a?V:P.inputControl.apply(H,P.backwardsCompatible?[V,T,z,U,P,F]:[U,{val:V,key:T,settings:P,cache:F,ul:z}]);if(F.val.length>=P.minChars){Q(U,P,F,(T===d.backspace||T===d.space))}else{if(T==d.backspace){z.html("").hide(U)}}}},"blur.autoComplete":function(T){if(!L||N){return c}v=T;n.data("ac-hasFocus",i);t=-1;if(g.order[0]!==a){g.order.unshift(a)}g.hasFocus=i;z.hide(T);if(P.onBlur){P.onBlur.apply(H,P.backwardsCompatible?[D,z,T,P,F]:[T,{val:D,settings:P,cache:F,ul:z}])}},"focus.autoComplete":function(U,T){if(!L||(g.focus===G&&T===m)||v["enter_"+m]){return c}v=U;if(G!=z.data("ac-input-index")){z.html("").hide(U)}if(g.order[0]===a){if(g.order[1]===G){g.order.shift()}else{g.order[0]=G}}else{if(g.order[0]!=G&&g.order[1]!=G){g.order.unshift(G)}}if(g.order.length>g.defaults.cacheLimit){g.order.pop()}g.hasFocus=c;n.data("ac-hasFocus",c);if(P.onFocus){P.onFocus.apply(H,P.backwardsCompatible?[z,U,P,F]:[U,{settings:P,cache:F,ul:z}])}},"autoComplete.document-click":function(V,U){var T;if(L&&N&&(!v||U.timeStamp-v.timeStamp>200)&&(T=e(U.target)).closest("ul").data("ac-input-index")!==G&&T.data("ac-input-index")!==G){z.hide(U);v=U;n.blur()}},"autoComplete.settings":function(V,T){if(!L){return c}if(e.isFunction(T)){var U=T.apply(H,P.backwardsCompatible?[P,F,z,V]:[V,{settings:P,cache:F,ul:z}]);if(e.isArray(U)&&U[0]!==a){P=e.extend(c,{},P,U[0]||P);F=e.extend(c,{},F,U[1]||F)}}else{P=e.extend(c,{},P,T||{})}z=!P.newList&&z.hasClass(P.list)?z:!P.newList&&e("ul."+P.list)[0]?e("ul."+P.list).bgiframe().data("autoComplete",c):e("<ul/>").appendTo("body").addClass(P.list).bgiframe().hide().data({"ac-selfmade":c,autoComplete:c});x();P.requestType=P.requestType.toUpperCase();q=P.multiple?P.multipleSeparator:a;n.data("ac-settings",P);return(v=V)},"autoComplete.flush":function(T,U){if(!L){return c}if(!U){p=0}F={length:0,val:a,list:{}};return(v=T)},"autoComplete.button-ajax":function(U,T,V){if(!L){return c}if(typeof T==="string"){V=T;T={}}v=U;n.trigger("focus",[m]);F.val=V||"button-ajax_"+m;return Q(U,e.extend(c,{},P,{maxItems:-1,postData:T||{}}),F)},"autoComplete.button-supply":function(T,U,V){if(!L){return c}if(typeof U==="string"){V=U;U=a}v=T;n.trigger("focus",[m]);F.val=V||"button-supply_"+m;U=e.isArray(U)&&U.length?U:P.dataSupply;return Q(T,e.extend(c,{},P,{maxItems:-1,dataSupply:U,dataFn:function(){return c}}),F)},"autoComplete.direct-supply":function(T,U,V){if(!L){return c}if(typeof U==="string"){V=U;U=a}v=T;n.trigger("focus",[m]);F.val=V||"direct-supply_"+m;U=e.isArray(U)&&U.length?U:P.dataSupply;return R(T,U,e.extend(c,{},P,{maxItems:-1,dataSupply:U,dataFn:function(){return c}}),F)},"autoComplete.search":function(T,U){if(!L){return c}F.val=U||"";return Q(v=T,P,F)},"autoComplete.option":function(V){if(!L){return c}var T=j.call(arguments),U=T.length;v=V;if(U===3){P[T[1]]=T[2];return T[2]}else{if(U===2){switch(T[1]){case"ul":return z;case"cache":return F;case"xhr":return w;case"input":return n;default:return P[T[1]]||a}}else{return P}}},"autoComplete.enable":function(T){n.data("ac-active",L=c);return(v=T)},"autoComplete.disable":function(T){n.data("ac-active",L=i);z.html("").hide(T);return(v=T)},"autoComplete.destroy":function(U){var V=z.html("").hide(U).data("ac-inputs"),T;n.removeData("autoComplete").removeData("ac-input-index").removeData("ac-initial-settings").removeData("ac-settings").removeData("ac-active").unbind(".autoComplete autoComplete").closest("form").unbind("submit.autoComplete-"+G);g.remove(G);k();L=i;V[G]=a;v=U;for(T in V){if(V.hasOwnProperty(T)&&V[T]===c){return v}}if(z.data("ac-selfmade")===c){z.remove()}return v}}).closest("form").bind("submit.autoComplete-"+G,function(T){if(!L){return c}v=T;return P.preventEnterSubmit&&(N||v["enter_"+m])?i:P.onSubmit.call(H,T,{form:this,settings:P,cache:F,ul:z})});function Q(V,U,T,X,W){if(U.spinner){U.spinner.call(H,V,{active:c,settings:U,cache:T,ul:z})}if(M){M=clearTimeout(M)}if(U.delay>0&&W===a){M=h.setTimeout(function(){Q(V,U,T,X,c);M=clearTimeout(M)},U.delay);return M}if(w){w.abort()}if(U.useCache&&T.list[T.val]){return R(V,T.list[T.val],U,T,X)}if(U.dataSupply.length){return O(V,U,T,X)}if(U.maxRequests&&++p>=U.maxRequests){z.html("").hide(V);if(U.spinner){U.spinner.call(H,V,{active:i,settings:U,cache:T,ul:z})}if(U.onMaxRequest&&p===U.maxRequests){return U.onMaxRequest.apply(H,U.backwardsCompatible?[T.val,z,V,D,U,T]:[V,{search:T.val,val:D,settings:U,cache:T,ul:z}])}return i}U.postData[U.postVar]=T.val;w=e.ajax({type:U.requestType,url:U.ajax,cache:U.ajaxCache,dataType:"json",data:U.postFormat?U.postFormat.call(H,V,{data:U.postData,search:T.val,val:D,settings:U,cache:T,ul:z}):U.postData,success:function(Y){R(V,Y,U,T,X)},error:function(){z.html("").hide(V);if(U.spinner){U.spinner.call(H,V,{active:i,settings:U,cache:T,ul:z})}}});return w}function O(U,X,T,W){var aa=[],ab=[],ac=e.isFunction(X.dataFn),ad=ac?a:new RegExp("^"+T.val,"i"),Y=0,ae,Z=-1,V=X.dataSupply.length;if(X.formatSupply){aa=X.formatSupply.call(H,U,{search:T.val,supply:X.dataSupply,settings:X,cache:T,ul:z})}else{for(;++Z<V;){ae=X.dataSupply[Z];ae=typeof ae==="object"&&ae.value?ae:{value:ae};ab=X.backwardsCompatible?[T.val,ae.value,aa,Z,X.dataSupply,z,U,X,T]:[U,{search:T.val,entry:ae.value,list:aa,i:Z,supply:X.dataSupply,settings:X,cache:T,ul:z}];if((ac&&X.dataFn.apply(H,ab))||(!ac&&ae.value.match(ad))){if(X.maxItems>-1&&++Y>X.maxItems){break}aa.push(ae)}}}return R(U,aa,X,T,W)}function J(T){if(N){if(P.onSelect){P.onSelect.apply(H,P.backwardsCompatible?[s,A,z,T,P,F]:[T,{data:s,li:A,settings:P,cache:F,ul:z}])}I();D=n.val();if(v.type==="keydown"){v["enter_"+m]=c}}z.hide(T);return A}function y(U){if(A){A.removeClass(P.rollover)}z.show(U);A=E.eq(t).addClass(P.rollover);s=u[t];if(!A.length||!s){return i}I(s.value);if(P.onRollover){P.onRollover.apply(H,P.backwardsCompatible?[s,A,z,U,P,F]:[U,{data:s,li:A,settings:P,cache:F,ul:z}])}var T=t*o;if(T<C-S){C=T+S;z.scrollTop(T)}return A}function B(U){if(A){A.removeClass(P.rollover)}z.show(U);A=E.eq(t).addClass(P.rollover);s=u[t];if(!A.length||!s){return i}I(s.value);var T=(t+1)*o;if(T>C){z.scrollTop((C=T)-S)}if(P.onRollover){P.onRollover.apply(H,P.backwardsCompatible?[s,A,z,U,P,F]:[U,{data:s,li:A,settings:P,cache:F,ul:z}])}return A}function x(){var U=z.hide,T=z.show,V=z.data("ac-inputs")||{};if(!z[m]){z.hide=function(W,X,Y){if(P.onHide&&N){P.onHide.call(H,W,{ul:z,settings:P,cache:F})}N=i;return U.call(z,X,Y)};z.show=function(W,X,Y){if(P.onShow&&!N){P.onShow.call(H,W,{ul:z,settings:P,cache:F})}N=c;return T.call(z,X,Y)};z[m]=c}V[G]=c;return z.data("ac-inputs",V)}function I(V){var W,T,U;if(V===a||V===""){W=T=n.val().length}else{if(q){V=D.substr(0,D.length-D.split(q).pop().length)+V+q}W=D.length;T=V.length;n.val(V)}if(!P.autoFill||W>T){return i}else{if(H.createTextRange){U=H.createTextRange();if(V===a){U.move("character",W);U.select()}else{U.collapse(c);U.moveStart("character",W);U.moveEnd("character",T);U.select()}}else{if(H.setSelectionRange){H.setSelectionRange(W,T)}else{if(H.selectionStart){H.selectionStart=W;H.selectionEnd=T}}}}return c}function R(U,ae,Z,T,Y){u=Z.onLoad?Z.onLoad.call(H,U,{list:ae,settings:Z,cache:T,ul:z}):ae;if(Z.spinner){Z.spinner.call(H,U,{active:i,settings:Z,cache:T,ul:z})}if(Z.useCache&&T.list[T.val]===a){T.length++;T.list[T.val]=ae;if(T.length>Z.cacheLimit){T.list={};T.length=0}}if(!u||u.length<1){return z.html("").hide(U)}t=-1;var ac=n.offset(),V=[],W=0,aa=0,ad=-1,ab=i,X=u.length;if(Z.onListFormat){Z.onListFormat.call(H,U,{list:u,settings:Z,cache:T,ul:z})}else{for(;++ad<X;){if(u[ad].value){if(Z.maxItems>-1&&++W>Z.maxItems){break}V.push(Z.striped&&ab?'<li class="'+Z.striped+'">':"<li>",u[ad].display||u[ad].value,"</li>");ab=!ab}}z.html(V.join(""))}E=z.children("li");if(Z.autoFill&&!Y){t=0;s=u[0];I(s.value);A=E.eq(0).addClass(Z.rollover)}z.unbind(".autoComplete").data("ac-input-index",G).delegate("li","mouseleave.autoComplete",function(){if(A){A.removeClass(Z.rollover)}}).delegate("li","mouseenter.autoComplete",function(af){A=e(this).addClass(Z.rollover);t=E.index(A[0]);s=u[t];if(Z.onRollover){Z.onRollover.apply(H,Z.backwardsCompatible?[s,A,z,af,Z,T]:[af,{data:s,li:A,settings:Z,cache:T,ul:z}])}}).bind("click.autoComplete",function(af){n.trigger("focus",[m]);n.val(D===q?D.substr(0,D.length-D.split(q).pop().length)+s.value+q:s.value);z.hide(af);I();if(Z.onSelect){Z.onSelect.apply(H,Z.backwardsCompatible?[s,A,z,af,Z,T]:[af,{data:s,li:A,settings:Z,cache:T,ul:z}])}}).css({top:ac.top+n.outerHeight(),left:ac.left,width:Z.width}).scrollTop(0);o=E.eq(0).outerHeight();if(Z.maxHeight){z.css({height:o*E.length>Z.maxHeight?Z.maxHeight:"auto",overflow:"auto"})}S=z.outerHeight();C=S;K=o===0?0:Math.floor(C/o);v.timeStamp=(new Date()).getTime();return z.show(U)}x();P.requestType=P.requestType.toUpperCase();q=P.multiple?P.multipleSeparator:a;g.stack[G]=H;b()}})(jQuery,window||this);