/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */ 
(function(j,h,e){j.fn.autoComplete=function(){var t=r.call(arguments),s=this,x=t.shift(),w=typeof x=="string",v,u;t=(p.arrayMethods[x]===f&&j.isArray(t[0])&&j.isArray(t[0][0]))||(t.length===1&&j.isArray(t[0]))?t[0]:t;v=w&&(p.handlerMethods[x]===-1||t.length<(p.handlerMethods[x]||0))?"triggerHandler":"trigger";return w?s[v]("autoComplete."+x,t):x&&x.preventDefault!==e?s.trigger(x,t):j.each(s,function(){if(j.data(u=this,"autoComplete")!==f){j.autoComplete(u,x)}})};function n(w,u){if(n.flag!==f){n.flag=f;i.bind("click.autoComplete",function(x){p.getFocus(f).trigger("autoComplete.document-click",[x])})}var s=w.closest("form"),v,t;if(s.length<1){return s}v=j.data(s[0],"ac-inputs")||{};v[u]=f;j.data(s[0],"ac-inputs",v);if(j.data(s[0],"autoComplete")!==f){j.data(s[0],"autoComplete",f);s.bind("submit.autoComplete",function(x){return(t=p.getFocus(f)).length?t.triggerHandler("autoComplete.form-submit",[x,this]):f})}}function a(w,u){p.remove(u);if(n.flag===f&&p.length===0){n.flag=q;i.unbind("click.autoComplete")}var s=w.closest("form"),v,t;if(s.length<1){return}v=s.data("ac-inputs")||{};v[u]=q;for(t in v){if(v.hasOwnProperty(t)&&v[t]===f){return}}s.unbind("submit.autoComplete")}function d(w,x){if(!j.isArray(x.supply)){return[]}for(var u=-1,s=x.supply.length,t=[],v;++u<s;){v=x.supply[u];v=v&&v.value?v:{value:v};t.push(v)}return t}function l(){return this}var f=true,q=false,r=Array.prototype.slice,o=h.document,i=j(o),m=j(),k=h.opera||(/macintosh/i.test(h.navigator.userAgent)&&j.browser.mozilla)?"keypress.autoComplete":"keydown.autoComplete",c="autoComplete_"+j.expando,b={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},g=j.autoComplete,p={version:"[VERSION]",expando:c,counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:q,keys:b,arrayMethods:{"button-supply":f,"direct-supply":f},handlerMethods:{option:2},focus:e,blur:e,getFocus:function(s){return !p.order[0]?s?m:e:s?p.jqStack[p.order[0]]:p.stack[p.order[0]]},getPrevious:function(u){for(var t=0,s=p.order.length;++t<s;){if(p.order[t]){return u?p.jqStack[p.order[t]]:p.stack[p.order[t]]}}return u?m:e},remove:function(u){for(var t=-1,s=p.order.length;++t<s;){if(p.order[t]===u){p.order[t]=e}}p.length--;delete p.stack[u]},getAll:function(){for(var u=-1,t=p.counter,s=[];++u<t;){if(p.stack[u]){s.push(p.stack[u])}}return j(s)},defaults:{ajax:"ajax.php",ajaxCache:j.ajaxSettings.cache,dataSupply:[],dataFn:e,formatSupply:e,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:e,striped:e,maxHeight:e,bgiframe:e,newList:q,postVar:"value",postData:{},postFormat:e,minChars:1,maxItems:-1,maxRequests:0,maxRequestsDeep:q,requestType:"POST",onChange:e,autoFill:q,nonInput:[b.shift,b.left,b.right],multiple:q,multipleSeparator:" ",onBlur:e,onFocus:e,onHide:e,onLoad:e,onMaxRequest:e,onRollover:e,onSelect:e,onShow:e,onListFormat:e,onSubmit:e,spinner:e,preventEnterSubmit:f,delay:0,useCache:f,cacheLimit:50}};j.autoComplete=function(M,w){p.length++;p.counter++;var s=j(M).attr("autocomplete","off"),F,Y,V={},A={},I="",z=[],J={length:0},E,H,Z,t,P,S=q,R,B,y=-1,x,v,L=p.counter,u=0,Q=j.fn.bgiframe||j.fn.bgIframe||l,K={length:0,val:e,list:{}},U=j.extend({width:s.outerWidth()},p.defaults,w||{},j.metadata?s.metadata():{});j.data(M,"autoComplete",V={index:L,hasFocus:q,active:f,settings:U,initialSettings:j.extend(f,{},U)});if(o.attachEvent){s.bind("keypress.autoComplete",function(aa){if(!V.active){return f}if(aa.keyCode===b.enter){var ab=f;if(E&&E.hasClass(U.rollover)){ab=U.preventEnterSubmit&&S?q:f;O(aa)}else{if(S){F.hide(aa)}}return ab}})}s.bind(k,function(ab){if(!V.active){return f}var aa=(A=ab).keyCode,ac=q;if(aa===b.tab&&S){O(ab)}else{if(aa===b.enter){ac=f;if(E&&E.hasClass(U.rollover)){ac=U.preventEnterSubmit&&S?q:f;O(ab)}else{if(S){F.hide(ab)}}}else{if(aa===b.up&&S){if(y>0){y--;D(ab)}else{y=-1;s.val(I);F.hide(ab)}}else{if(aa===b.down&&S){if(y<J.length-1){y++;G(ab)}}else{if(aa===b.pageup&&S){if(y>0){y-=P;if(y<0){y=0}D(ab)}}else{if(aa===b.pagedown&&S){if(y<J.length-1){y+=P;if(y>J.length-1){y=J.length-1}G(ab)}}else{if(U.nonInput&&j.inArray(aa,U.nonInput)>-1){F.html("").hide(ab);ac=f}else{return f}}}}}}}A["keydown_"+c]=f;return ac}).bind({"keyup.autoComplete":function(ab){if(!V.active||A["keydown_"+c]){return f}I=s.val();var aa=(A=ab).keyCode,ac=v?I.split(v).pop():I;if(aa!=b.enter){K.val=U.onChange===e?ac:U.onChange.call(M,ab,{val:ac,key:aa,settings:U,cache:K,ul:F});if(K.val.length>=U.minChars){W(ab,U,K,(aa===b.backspace||aa===b.space))}else{if(aa==b.backspace){F.html("").hide(ab)}}}},"blur.autoComplete":function(aa){if(!V.active||S){return f}if(p.order[0]!==e){p.order.unshift(e)}p.hasFocus=q;V.hasFocus=q;y=-1;F.hide(A=aa);if(p.blur){p.blur.call(M,aa,{settings:U,cache:K,ul:F})}if(U.onBlur){U.onBlur.call(M,aa,{val:I,settings:U,cache:K,ul:F})}},"focus.autoComplete":function(ab,aa){if(!V.active||(V.hasFocus&&aa===c)||A["enter_"+c]){return f}if(L!==j.data(F[0],"ac-input-index")){F.html("").hide(ab)}if(p.order[0]===e){if(p.order[1]===L){p.order.shift()}else{p.order[0]=L}}else{if(p.order[0]!=L&&p.order[1]!=L){p.order.unshift(L)}}if(p.defaults.cacheLimit!==-1&&p.order.length>p.defaults.cacheLimit){p.order.pop()}p.hasFocus=f;V.hasFocus=f;A=ab;if(p.focus){p.focus.call(M,ab,{settings:U,cache:K,ul:F})}if(U.onFocus){U.onFocus.call(M,ab,{settings:U,cache:K,ul:F})}},"autoComplete.document-click":function(ab,aa){if(V.active&&S&&(!A||aa.timeStamp-A.timeStamp>200)&&j.data(j(aa.target).closest("ul")[0],"ac-input-index")!==L){F.hide(A=aa);s.trigger("blur")}},"autoComplete.form-submit":function(ac,ab,aa){if(!V.active){return f}A=ab;return U.preventEnterSubmit&&(S||A["enter_"+c])?q:U.onSubmit===e?f:U.onSubmit.call(M,ab,{form:aa,settings:U,cache:K,ul:F})},"autoComplete.ul-mouseenter":function(ac,ab,aa){if(E){E.removeClass(U.rollover)}E=j(aa).addClass(U.rollover);y=J.index(aa);x=z[y];H=F.scrollTop()+Z;A=ab;if(U.onRollover){U.onRollover.call(M,ab,{data:x,li:E,settings:U,cache:K,ul:F})}},"autoComplete.ul-click":function(ab,aa){s.trigger("focus",[c]);s.val(I===v?I.substr(0,I.length-I.split(v).pop().length)+x.value+v:x.value);F.hide(A=aa);N();if(U.onSelect){U.onSelect.call(M,aa,{data:x,li:E,settings:U,cache:K,ul:F})}},"autoComplete.settings":function(ad,aa){if(!V.active){return f}var ab,ac;A=ad;if(j.isFunction(aa)){ab=aa.call(M,ad,{settings:U,cache:K,ul:F});if(j.isArray(ab)&&ab[0]!==e){j.extend(f,U,ab[0]||U);j.extend(f,K,ab[1]||K)}}else{j.extend(f,U,aa||{})}Q=j.fn.bgiframe||j.fn.bgIframe||l;F=C();U.requestType=U.requestType.toUpperCase();if(U.inputControl!==e&&U.onChange===e){U.onChange=U.inputControl}v=U.multiple?U.multipleSeparator:e;V.settings=U},"autoComplete.flush":function(aa,ab){if(!V.active){return f}if(!ab){u=0}K={length:0,val:e,list:{}};A=aa},"autoComplete.button-ajax":function(ab,aa,ac){if(!V.active){return f}if(typeof aa=="string"){ac=aa;aa={}}A=ab;s.trigger("focus",[c]);K.val=ac||"button-ajax_"+c;return W(ab,j.extend(f,{},U,{maxItems:-1,postData:aa||{}}),K)},"autoComplete.button-supply":function(aa,ab,ac){if(!V.active){return f}if(typeof ab=="string"){ac=ab;ab=e}A=aa;s.trigger("focus",[c]);K.val=ac||"button-supply_"+c;ab=j.isArray(ab)?ab:U.dataSupply;return W(aa,j.extend(f,{},U,{maxItems:-1,dataSupply:ab,formatSupply:d}),K)},"autoComplete.direct-supply":function(aa,ab,ac){if(!V.active){return f}if(typeof ab=="string"){ac=ab;ab=e}A=aa;s.trigger("focus",[c]);K.val=ac||"direct-supply_"+c;ab=j.isArray(ab)&&ab.length?ab:U.dataSupply;return X(aa,ab,j.extend(f,{},U,{maxItems:-1,dataSupply:ab,formatSupply:d}),K)},"autoComplete.search":function(aa,ab){if(!V.active){return f}K.val=ab||"";return W(A=aa,U,K)},"autoComplete.option":function(ab,aa,ac){if(!V.active){return f}A=ab;switch(r.call(arguments).length){case 3:U[aa]=ac;return ac;case 2:return aa==="ul"?F:aa==="cache"?K:aa==="xhr"?B:aa==="input"?s:U[aa]||e;default:return U}},"autoComplete.enable":function(aa){V.active=f;A=aa},"autoComplete.disable":function(aa){V.active=q;F.html("").hide(A=aa)},"autoComplete.destroy":function(ab){var ac=j.data(F.html("").hide(A=ab)[0],"ac-inputs")||{},aa;s.removeData("autoComplete").unbind(".autoComplete autoComplete");a(s,L);ac[L]=e;for(aa in ac){if(ac.hasOwnProperty(aa)&&ac[aa]===f){return A}}if(j.data(F[0],"ac-selfmade")===f){F.remove()}else{F.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}}});function W(ac,ab,aa,ae,ad){if(ab.maxRequestsDeep===f&&u>=ab.maxRequests){return q}if(ab.spinner){ab.spinner.call(M,ac,{active:f,settings:ab,cache:aa,ul:F})}if(R){R=clearTimeout(R)}if(ab.delay>0&&ad===e){R=h.setTimeout(function(){W(ac,ab,aa,ae,f)},ab.delay);return R}if(B){B.abort()}if(ab.useCache&&j.isArray(aa.list[aa.val])){return X(ac,aa.list[aa.val],ab,aa,ae)}if(ab.dataSupply.length){return T(ac,ab,aa,ae)}if(ab.maxRequests&&++u>=ab.maxRequests){F.html("").hide(ac);if(ab.spinner){ab.spinner.call(M,ac,{active:q,settings:ab,cache:aa,ul:F})}if(ab.onMaxRequest&&u===ab.maxRequests){return ab.onMaxRequest.call(M,ac,{search:aa.val,val:I,settings:ab,cache:aa,ul:F})}return q}ab.postData[ab.postVar]=aa.val;B=j.ajax({type:ab.requestType,url:ab.ajax,cache:ab.ajaxCache,dataType:"json",data:ab.postFormat?ab.postFormat.call(M,ac,{data:ab.postData,search:aa.val,val:I,settings:ab,cache:aa,ul:F}):ab.postData,success:function(af){X(ac,af,ab,aa,ae)},error:function(){F.html("").hide(ac);if(ab.spinner){ab.spinner.call(M,ac,{active:q,settings:ab,cache:aa,ul:F})}}});return B}function T(ab,ae,aa,ad){var ag=[],ai={},aj=j.isFunction(ae.dataFn),ak=aj?e:new RegExp("^"+aa.val,"i"),ah=0,al,af=-1,ac=ae.dataSupply.length;if(ae.formatSupply){ag=ae.formatSupply.call(M,ab,{search:aa.val,supply:ae.dataSupply,settings:ae,cache:aa,ul:F})}else{for(;++af<ac;){al=ae.dataSupply[af];al=al&&typeof al.value=="string"?al:{value:al};ai={search:aa.val,entry:al.value,list:ag,i:af,supply:ae.dataSupply,settings:ae,cache:aa,ul:F};if((aj&&ae.dataFn.call(M,ab,ai))||(!aj&&al.value.match(ak))){if(ae.maxItems>-1&&++ah>ae.maxItems){break}ag.push(al)}}}return X(ab,ag,ae,aa,ad)}function O(aa){if(S){if(U.onSelect){U.onSelect.call(M,aa,{data:x,li:E,settings:U,cache:K,ul:F})}N();I=s.val();if(A.type==="keydown"){A["enter_"+c]=f}F.hide(aa)}E=e}function D(ab){if(E){E.removeClass(U.rollover)}F.show(ab);E=J.eq(y).addClass(U.rollover);x=z[y];if(!E.length||!x){return q}N(x.value);if(U.onRollover){U.onRollover.call(M,ab,{data:x,li:E,settings:U,cache:K,ul:F})}var aa=y*t;if(aa<H-Z){H=aa+Z;F.scrollTop(aa)}}function G(ab){if(E){E.removeClass(U.rollover)}F.show(ab);E=J.eq(y).addClass(U.rollover);x=z[y];if(!E.length||!x){return q}N(x.value);var aa=(y+1)*t;if(aa>H){F.scrollTop((H=aa)-Z)}if(U.onRollover){U.onRollover.call(M,ab,{data:x,li:E,settings:U,cache:K,ul:F})}}function C(){if(!U.newList&&!F){F=U.list.jquery?U.list:U.list.nodeName?j(U.list):typeof U.list=="string"&&(Y=i.find("ul."+U.list).eq(0)).length?Q.call(Y,U.bgiframe):e}if(!F){F=Q.call(j("<ul/>").appendTo("body").addClass(U.list).hide().data("ac-selfmade",f),U.bgiframe)}var ab=F.hide,aa=F.show,ac=j.data(F[0],"ac-inputs")||{};if(!F[c]){F.hide=function(ad,ae,af){if(U.onHide&&S){U.onHide.call(M,ad,{ul:F,settings:U,cache:K})}S=q;return ab.call(F,ae,af)};F.show=function(ad,ae,af){if(U.onShow&&!S){U.onShow.call(M,ad,{ul:F,settings:U,cache:K})}S=f;return aa.call(F,ae,af)};F[c]=f}if(j.data(F[0],"autoComplete")!==f){j.data(F[0],"autoComplete",f);F.delegate("li","mouseenter.autoComplete",function(ad){p.getFocus(f).trigger("autoComplete.ul-mouseenter",[ad,this])}).bind("click.autoComplete",function(ad){p.getFocus(f).trigger("autoComplete.ul-click",[ad]);return q})}ac[L]=f;j.data(F[0],"ac-inputs",ac);return F}function N(ac){var ad,aa,ab;if(ac===e||ac===""){ad=aa=s.val().length}else{if(v){ac=I.substr(0,I.length-I.split(v).pop().length)+ac+v}ad=I.length;aa=ac.length;s.val(ac)}if(!U.autoFill||ad>aa){return q}else{if(M.createTextRange){ab=M.createTextRange();if(ac===e){ab.move("character",ad);ab.select()}else{ab.collapse(f);ab.moveStart("character",ad);ab.moveEnd("character",aa);ab.select()}}else{if(M.setSelectionRange){M.setSelectionRange(ad,aa)}else{if(M.selectionStart){M.selectionStart=ad;M.selectionEnd=aa}}}}}function X(ab,ai,af,aa,ae){z=af.onLoad?af.onLoad.call(M,ab,{list:ai,settings:af,cache:aa,ul:F}):ai;if(af.spinner){af.spinner.call(M,ab,{active:q,settings:af,cache:aa,ul:F})}if(af.useCache&&!j.isArray(aa.list[aa.val])){aa.length++;aa.list[aa.val]=ai;if(af.cacheLimit!==-1&&aa.length>af.cacheLimit){aa.list={};aa.length=0}}if(!z||z.length<1){return F.html("").hide(ab)}y=-1;var ag=s.offset(),ac=[],ak=0,ah=-1,aj=q,ad=z.length;if(af.onListFormat){af.onListFormat.call(M,ab,{list:z,settings:af,cache:aa,ul:F})}else{for(;++ah<ad;){if(z[ah].value){if(af.maxItems>-1&&++ak>af.maxItems){break}ac.push(af.striped&&aj?'<li class="'+af.striped+'">':"<li>",z[ah].display||z[ah].value,"</li>");aj=!aj}}F.html(ac.join(""))}J=F.children("li");j.data(F[0],"ac-input-index",L);if(af.autoFill&&!ae){y=0;x=z[0];N(x.value);E=J.eq(0).addClass(af.rollover)}F.scrollTop(0).css({top:ag.top+s.outerHeight(),left:ag.left,width:af.width}).show(ab);t=J.eq(0).outerHeight();if(af.maxHeight){F.css({height:t*J.length>af.maxHeight?af.maxHeight:"auto",overflow:"auto"})}Z=F.outerHeight();H=Z;P=t===0?0:Math.floor(H/t);A.timeStamp=(new Date()).getTime()}F=C();U.requestType=U.requestType.toUpperCase();if(U.inputControl!==e&&U.onChange===e){U.onChange=U.inputControl}v=U.multiple?U.multipleSeparator:e;p.stack[L]=M;p.jqStack[L]=s;n(s,L)};p=j.extend(j.autoComplete,p)})(jQuery,this);