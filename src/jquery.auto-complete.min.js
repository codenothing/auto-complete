/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */ 
(function(j,R,h){function N(e,n){if(N.flag!==g){N.flag=g;W.bind("click.autoComplete",function(v){i.getFocus(g).trigger("autoComplete.document-click",[v])})}e=e.closest("form");var m=e.data("ac-inputs")||{},H;m[n]=g;e.data("ac-inputs",m);e.data("autoComplete")!==g&&e.data("autoComplete",g).bind("submit.autoComplete",function(v){return(H=i.getFocus(g)).length?H.triggerHandler("autoComplete.form-submit",[v,this]):g})}function ha(e,n){i.remove(n);if(N.flag===g&&i.length===0){N.flag=o;W.unbind("click.autoComplete")}e=
e.closest("form");var m=e.data("ac-inputs")||{},H;m[n]=o;for(H in m)if(m[H]===g)return;e.unbind("submit.autoComplete")}function aa(e,n){if(!n.supply||!j.isArray(n.supply))return[];e=-1;for(var m=n.supply.length,H=[],v;++e<m;){v=(v=n.supply[e])&&v.value?v:{value:v};H.push(v)}return H}function ba(){return this}j.fn.autoComplete=function(){var e=ca.call(arguments),n=this,m=e.shift(),H=m===g,v=typeof m=="string",O=m&&m.preventDefault!==h,P;if(v||O){e=i.arrayMethods[m]===g&&j.isArray(e[0])&&j.isArray(e[0][0])||
e.length===1&&j.isArray(e[0])?e[0]:e;P=v&&(i.handlerMethods[m]===-1||e.length<(i.handlerMethods[m]||0))?"triggerHandler":"trigger"}return n.length<1?H?h:n:v?n[P]("autoComplete."+m,e):O?n.trigger(m,e):H?j.autoComplete(n[0],e.shift()):j.each(n,function(X,K){j.data(K,"autoComplete")!==g&&j.autoComplete(K,m)})};var g=true,o=false,ca=Array.prototype.slice,ia=Object.prototype.toString,da=R.document,W=j(da),ea=j(),ja=ia.call(R.opera)==="[object Opera]"||/macintosh/i.test(R.navigator.userAgent)&&j.browser.mozilla?
"keypress.autoComplete":"keydown.autoComplete",y="autoComplete_"+j.expando,D={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},ka=Date.now||function(){return(new Date).getTime()},i={version:"[VERSION]",expando:y,_autoComplete:j.autoComplete,counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:o,keys:D,arrayMethods:{"button-supply":g,"direct-supply":g},handlerMethods:{option:2},focus:h,blur:h,getFocus:function(e){return!i.order[0]?e?ea:h:e?i.jqStack[i.order[0]]:
i.stack[i.order[0]]},getPrevious:function(e){for(var n=0,m=i.order.length;++n<m;)if(i.order[n])return e?i.jqStack[i.order[n]]:i.stack[i.order[n]];return e?ea:h},remove:function(e){for(var n=-1,m=i.order.length;++n<m;)if(i.order[n]===e)i.order[n]=h;i.length--;delete i.stack[e]},getAll:function(){for(var e=-1,n=i.counter,m=[];++e<n;)i.stack[e]&&m.push(i.stack[e]);return j(m)},defaults:{ajax:"ajax.php",ajaxCache:j.ajaxSettings.cache,dataSupply:[],dataFn:h,formatSupply:h,list:"auto-complete-list",rollover:"auto-complete-list-rollover",
width:h,striped:h,maxHeight:h,bgiframe:h,newList:o,template:h,templateStripe:"striped",pattern:/(^|.|\r|\n)(#\{(.*?)\})/,postVar:"value",postData:{},postFormat:h,minChars:1,maxItems:-1,maxRequests:0,maxRequestsDeep:o,requestType:"POST",onChange:h,autoFill:o,blacklist:[D.shift,D.left,D.right],whitelist:h,multiple:o,multipleSeparator:" ",onBlur:h,onFocus:h,onHide:h,onLoad:h,onMaxRequest:h,onRollover:h,onSelect:h,onShow:h,onListFormat:h,onSubmit:h,spinner:h,preventEnterSubmit:g,delay:0,useCache:g,forceFormat:o,
cacheLimit:50}};j.autoComplete=function(e,n){function m(b,a,d,k,w){if(a.maxRequestsDeep===g&&S>=a.maxRequests)return o;a.spinner&&a.spinner.call(e,b,{active:g,settings:a,cache:d,ul:f});if(T)T=clearTimeout(T);if(a.delay>0&&w===h)return T=R.setTimeout(function(){m(b,a,d,k,g)},a.delay);U&&U.abort();if(a.useCache&&d.list[d.val]&&d.list[d.val].built!=="")return V(b,d.list[d.val].src,a,d,k);if(a.dataSupply.length)return H(b,a,d,k);if(a.maxRequests&&++S>=a.maxRequests){f.html("").hide(b);a.spinner&&a.spinner.call(e,
b,{active:o,settings:a,cache:d,ul:f});if(a.onMaxRequest&&S===a.maxRequests)return a.onMaxRequest.call(e,b,{search:d.val,val:z,settings:a,cache:d,ul:f});return o}a.postData[a.postVar]=d.val;return U=j.ajax({type:a.requestType,url:a.ajax,cache:a.ajaxCache,dataType:"json",data:a.postFormat?a.postFormat.call(e,b,{data:a.postData,search:d.val,val:z,settings:a,cache:d,ul:f}):a.postData,success:function(u){V(b,u,a,d,k)},error:function(){f.html("").hide(b);a.spinner&&a.spinner.call(e,b,{active:o,settings:a,
cache:d,ul:f})}})}function H(b,a,d,k){var w=[];if(a.formatSupply)w=a.formatSupply.call(e,b,{search:d.val,supply:a.dataSupply,settings:a,cache:d,ul:f});else for(var u=-1,A=a.dataSupply.length,B,E,Y=j.isFunction(a.dataFn),la=Y?h:new RegExp("^"+d.val,"i");++u<A;){E=(E=a.dataSupply[u])&&typeof E.value=="string"?E:{value:E};B={search:d.val,entry:E.value,list:w,i:u,supply:a.dataSupply,settings:a,cache:d,ul:f};if(Y&&a.dataFn.call(e,b,B)||!Y&&E.value.match(la)){w.push(E);if(a.maxItems>-1&&w.length>a.maxItems)break}}return V(b,
w,a,d,k)}function v(b){if(x){c.onSelect&&c.onSelect.call(e,b,{data:C,li:r,settings:c,cache:l,ul:f});K();z=q.val();if(p.type==="keydown")p["enter_"+y]=g;f.hide(b)}r=h}function O(b){r&&r.removeClass(c.rollover);f.show(b);r=I.eq(s).addClass(c.rollover);C=F[s];if(!r.length||!C)return o;K(C.value);c.onRollover&&c.onRollover.call(e,b,{data:C,li:r,settings:c,cache:l,ul:f});b=s*M;if(b<L-Q){L=b+Q;f.scrollTop(b)}}function P(b){r&&r.removeClass(c.rollover);f.show(b);r=I.eq(s).addClass(c.rollover);C=F[s];if(!r.length||
!C)return o;K(C.value);var a=(s+1)*M;if(a>L)f.scrollTop((L=a)-Q);c.onRollover&&c.onRollover.call(e,b,{data:C,li:r,settings:c,cache:l,ul:f})}function X(){if(!c.newList&&!f)f=c.list.jquery?c.list:c.list.nodeName?j(c.list):typeof c.list=="string"&&(fa=W.find("ul."+c.list).eq(0)).length?Z.call(fa,c.bgiframe):h;f||(f=Z.call(j("<ul/>").appendTo(da.body).addClass(c.list).hide().data("ac-selfmade",g),c.bgiframe));var b=f.hide,a=f.show,d=f.data("ac-inputs")||{};if(!f[y]){f.hide=function(k,w,u){c.onHide&&x&&
c.onHide.call(e,k,{ul:f,settings:c,cache:l});x=o;return b.call(f,w,u)};f.show=function(k,w,u){c.onShow&&!x&&c.onShow.call(e,k,{ul:f,settings:c,cache:l});x=g;return a.call(f,w,u)};f[y]=g}f.data("autoComplete")!==g&&f.data("autoComplete",g).delegate("li","mouseenter.autoComplete",function(k){i.getFocus(g).trigger("autoComplete.ul-mouseenter",[k,this])}).bind("click.autoComplete",function(k){i.getFocus(g).trigger("autoComplete.ul-click",[k]);return o});d[G]=g;f.data("ac-inputs",d);return f}function K(b){var a,
d,k;if(b===h||b==="")a=d=q.val().length;else{if(J)b=z.substr(0,z.length-z.split(J).pop().length)+b+J;a=z.length;d=b.length;q.val(b)}if(!c.autoFill||a>d)return o;else if(e.createTextRange){k=e.createTextRange();if(b===h)k.move("character",a);else{k.collapse(g);k.moveStart("character",a);k.moveEnd("character",d)}k.select()}else if(e.setSelectionRange)e.setSelectionRange(a,d);else if(e.selectionStart){e.selectionStart=a;e.selectionEnd=d}}function ma(){for(var b=-1,a=F.length,d=[],k=o,w,u,A,B,E;++b<a;){u=
F[b];A=c.template;w=0;if(c.striped)u[c.templateStripe]=k?c.striped:"";for(;B=c.pattern.exec(A.substr(w));)if(B[1]==="\\"){w=A.indexOf(B[0])+B[0].length;A=A.replace(B[0],B[0].substr(1))}else{E=B[3];w=A.indexOf(B[0])+(u[E]?u[E].length:0);A=A.replace(B[2],u[E]||"")}k=!k;d.push(A)}f.html(l.list[l.val].built=d.join(""))}function V(b,a,d,k,w){F=d.onLoad?d.onLoad.call(e,b,{list:a,settings:d,cache:k,ul:f}):a;d.spinner&&d.spinner.call(e,b,{active:o,settings:d,cache:k,ul:f});if(d.useCache&&(!k.list[k.val]||
!j.isArray(k.list[k.val].src))){k.length++;k.list[k.val]={src:F,built:""};if(d.cacheLimit!==-1&&k.length>d.cacheLimit){k.list={};k.length=0}}if(!F||F.length<1)return f.html("").hide(b);s=-1;r=h;a=q.offset();var u=[],A=-1,B=o,E=F.length;if(d.onListFormat)d.onListFormat.call(e,b,{list:F,settings:d,cache:k,ul:f});else if(k.list[k.val].built!==""&&!d.forceFormat)f.html(k.list[k.val].built);else if(d.template)ma();else{for(;++A<E;)if(F[A].value){u.push(d.striped&&B?'<li class="'+d.striped+'">':"<li>",
F[A].display||F[A].value,"</li>");B=!B;if(d.maxItems>-1&&u.length>d.maxItems)break}f.html(k.list[k.val].built=u.join(""))}I=f.data("ac-input-index",G).children("li");if(d.autoFill&&!w){s=0;C=F[0];K(C.value);r=I.eq(0).addClass(d.rollover)}f.scrollTop(0).css({top:a.top+q.outerHeight(),left:a.left,width:d.width}).show(b);M=I.eq(0).outerHeight();if(d.maxHeight)f.css({height:M*I.length>d.maxHeight?d.maxHeight:"auto",overflow:"auto"});L=Q=f.outerHeight();$=M===0?0:Math.floor(L/M);p.timeStamp=ka()}function ga(){c.requestType=
c.requestType.toUpperCase();J=c.multiple?c.multipleSeparator:h;if(c.inputControl!==h&&c.onChange===h)c.onChange=c.inputControl;if(c.nonInput!==h&&c.blacklist===h)c.blacklist=c.nonInput}function na(){var b=this;j.each({"button-ajax":"buttonAjax","button-supply":"buttonSupply","direct-supply":"directSupply",destroy:"destroy",disable:"disable",enable:"enable",flush:"flush",search:"search"},function(a,d){b[d]=function(){q.trigger("autoComplete."+a,arguments);return b}});b.settings=c;b.cache=l}i.length++;
i.counter++;var q=j(e).attr("autocomplete","off"),f,fa,t={},p={},z="",F=[],I={length:0},r,L,Q,M,$,x=o,T,U,s=-1,C,J,G=i.counter,S=0,Z=j.fn.bgiframe||j.fn.bgIframe||ba,l={length:0,val:h,list:{}},c=j.extend({width:q.outerWidth()},i.defaults,n||{},j.metadata?q.metadata():{});j.data(e,"autoComplete",t={index:G,hasFocus:o,active:g,cache:l,settings:c,initialSettings:j.extend(g,{},c)});e.attachEvent&&q.bind("keypress.autoComplete",function(b){if(!t.active)return g;if(b.keyCode===D.enter){var a=g;if(r&&r.hasClass(c.rollover)){a=
c.preventEnterSubmit&&x?o:g;v(b)}else x&&f.hide(b);return a}});q.bind(ja,function(b){if(!t.active)return g;var a=(p=b).keyCode,d=o;if(a===D.tab&&x)v(b);else if(a===D.enter){d=g;if(r&&r.hasClass(c.rollover)){d=c.preventEnterSubmit&&x?o:g;v(b)}else x&&f.hide(b)}else if(a===D.up&&x)if(s>0){s--;O(b)}else{s=-1;r=h;q.val(z);f.hide(b)}else if(a===D.down&&x){if(s<I.length-1){s++;P(b)}}else if(a===D.pageup&&x){if(s>0){s-=$;if(s<0)s=0;O(b)}}else if(a===D.pagedown&&x){if(s<I.length-1){s+=$;if(s>I.length-1)s=
I.length-1;P(b)}}else if(c.whitelist&&j.inArray(a,c.whitelist)===-1||c.blacklist&&j.inArray(a,c.blacklist)>-1){f.html("").hide(b);d=g}else return g;p["keydown_"+y]=g;return d}).bind({"keyup.autoComplete":function(b){if(!t.active||p["keydown_"+y])return g;z=q.val();var a=(p=b).keyCode,d=J?z.split(J).pop():z;if(a!=D.enter){l.val=c.onChange===h?d:c.onChange.call(e,b,{val:d,key:a,settings:c,cache:l,ul:f});if(l.val.length>=c.minChars)m(b,c,l,a===D.backspace||a===D.space);else a==D.backspace&&f.html("").hide(b)}},
"blur.autoComplete":function(b){if(!t.active||x)return g;i.order[0]!==h&&i.order.unshift(h);i.hasFocus=o;t.hasFocus=o;s=-1;r=h;f.hide(p=b);i.blur&&i.blur.call(e,b,{settings:c,cache:l,ul:f});c.onBlur&&c.onBlur.call(e,b,{val:z,settings:c,cache:l,ul:f})},"focus.autoComplete":function(b,a){if(!t.active||t.hasFocus&&a===y||p["enter_"+y])return g;G!==f.data("ac-input-index")&&f.html("").hide(b);if(i.order[0]===h)if(i.order[1]===G)i.order.shift();else i.order[0]=G;else i.order[0]!=G&&i.order[1]!=G&&i.order.unshift(G);
i.defaults.cacheLimit!==-1&&i.order.length>i.defaults.cacheLimit&&i.order.pop();i.hasFocus=g;t.hasFocus=g;p=b;i.focus&&i.focus.call(e,b,{settings:c,cache:l,ul:f});c.onFocus&&c.onFocus.call(e,b,{settings:c,cache:l,ul:f})},"autoComplete.document-click":function(b,a){if(t.active&&x&&(!p||a.timeStamp-p.timeStamp>200)&&j(a.target).closest("ul").data("ac-input-index")!==G){f.hide(p=a);q.trigger("blur")}},"autoComplete.form-submit":function(b,a,d){if(!t.active)return g;p=a;return c.preventEnterSubmit&&(x||
p["enter_"+y])?o:c.onSubmit===h?g:c.onSubmit.call(e,a,{form:d,settings:c,cache:l,ul:f})},"autoComplete.ul-mouseenter":function(b,a,d){r&&r.removeClass(c.rollover);r=j(d).addClass(c.rollover);s=I.index(d);C=F[s];L=f.scrollTop()+Q;p=a;c.onRollover&&c.onRollover.call(e,a,{data:C,li:r,settings:c,cache:l,ul:f})},"autoComplete.ul-click":function(b,a){q.trigger("focus",[y]);q.val(z===J?z.substr(0,z.length-z.split(J).pop().length)+C.value+J:C.value);f.hide(p=a);K();c.onSelect&&c.onSelect.call(e,a,{data:C,
li:r,settings:c,cache:l,ul:f})},"autoComplete.settings":function(b,a){if(!t.active)return g;p=b;if(j.isFunction(a)){if((b=a.call(e,b,{settings:c,cache:l,ul:f}))&&j.isArray(b)&&b[0]!==h){j.extend(g,c,b[0]||c);j.extend(g,l,b[1]||l)}}else j.extend(g,c,a||{});Z=j.fn.bgiframe||j.fn.bgIframe||ba;f=X();ga();t.settings=c},"autoComplete.clear":function(b){if(!t.active)return g;f.html("").hide(p=b);q.val("")},"autoComplete.flush":function(b,a){if(!t.active)return g;a||(S=0);l={length:0,val:h,list:{}};p=b},
"autoComplete.button-ajax":function(b,a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a={}}p=b;q.trigger("focus",[y]);l.val=d||"button-ajax_"+y;return m(b,j.extend(g,{},c,{maxItems:-1,postData:a||{}}),l)},"autoComplete.button-supply":function(b,a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a=h}p=b;q.trigger("focus",[y]);l.val=d||"button-supply_"+y;a=j.isArray(a)?a:c.dataSupply;return m(b,j.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSupply:aa}),l)},"autoComplete.direct-supply":function(b,
a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a=h}p=b;q.trigger("focus",[y]);l.val=d||"direct-supply_"+y;a=j.isArray(a)&&a.length?a:c.dataSupply;return V(b,a,j.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSupply:aa}),l)},"autoComplete.search":function(b,a){if(!t.active)return g;l.val=a||"";return m(p=b,c,l)},"autoComplete.option":function(b,a,d){if(!t.active)return g;p=b;switch(ca.call(arguments).length){case 3:return c[a]=d;case 2:return a==="ul"?f:a==="cache"?l:a==="xhr"?U:a==="input"?
q:c[a]||h;default:return c}},"autoComplete.active":function(b,a){p=b;if(a===h)return t.active;(t.active=a)||f.html("").hide(b)},"autoComplete.enable":function(){return q.trigger("autoComplete.active",[true])},"autoComplete.disable":function(){return q.trigger("autoComplete.active",[false])},"autoComplete.destroy":function(b){b=f.html("").hide(p=b).data("ac-inputs")||{};var a;q.removeData("autoComplete").unbind(".autoComplete autoComplete");ha(q,G);b[G]=h;for(a in b)if(b[a]===g)return p;f.data("ac-selfmade")===
g?f.remove():f.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}});f=X();ga();i.stack[G]=e;i.jqStack[G]=q;N(q,G);return t.instance=new na};i=j.extend(j.autoComplete,i)})(jQuery,this);
