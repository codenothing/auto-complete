/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */
(function(f,k,a){f.fn.autoComplete=function(){var r=j.call(arguments),q=this,v=r.shift(),u=typeof v==="string",t,s;if(u){v=v.replace(c,"-")}r=(h.arrayMethods[v]===d&&f.isArray(r[0])&&f.isArray(r[0][0]))||(r.length===1&&f.isArray(r[0]))?r[0]:r;t=u&&(h.handlerMethods[v]===-1||r.length<(h.handlerMethods[v]||0))?"triggerHandler":"trigger";return u?q[t]("autoComplete."+v,r):v&&v.preventDefault!==a?q.trigger(v,r):q.each(function(){if(f(s=this).data("autoComplete")!==d){g(s,v)}})};f.fn.bgiframe=f.fn.bgiframe?f.fn.bgiframe:f.fn.bgIframe?f.fn.bgIframe:function(){return this};function b(u,s){if(b.flag!==d){b.flag=d;o.bind("click.autoComplete",function(v){h.getFocus(d).trigger("autoComplete.document-click",[v])})}var q=u.closest("form"),t=q.data("ac-inputs")||{},r;t[s]=d;q.data("ac-inputs",t);if(q.data("autoComplete")!==d){q.data("autoComplete",d).bind("submit.autoComplete",function(v){return(r=h.getFocus(d)).length?r.triggerHandler("autoComplete.form-submit",[v,this]):d})}}function n(u,s){h.remove(s);if(b.flag===d&&h.length===0){b.flag=l;o.unbind("click.autoComplete")}var q=u.closest("form"),t=q.data("ac-inputs")||{},r;t[s]=l;for(r in t){if(t.hasOwnProperty(r)&&t[r]===d){return}}q.unbind("submit.autoComplete")}function m(u,v){if(!f.isArray(v.supply)){return[]}for(var s=-1,q=v.supply.length,r=[],t;++s<q;){t=v.supply[s];t=t&&t.value?t:{value:t};r.push(t)}return r}var d=true,l=false,j=Array.prototype.slice,o=f(k.document),i=f(),c=/\./,p="autoComplete_"+f.expando,e={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},h=f.autoComplete={version:"[VERSION]",counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:l,keys:e,arrayMethods:{"button-supply":d,"direct-supply":d},handlerMethods:{option:2},focus:a,blur:a,getFocus:function(q){return !h.order[0]?q?i:a:q?h.jqStack[h.order[0]]:h.stack[h.order[0]]},getPrevious:function(s){for(var r=0,q=h.order.length;++r<q;){if(h.order[r]){return s?h.jqStack[h.order[r]]:h.stack[h.order[r]]}}return s?i:a},remove:function(s){for(var r=-1,q=h.order.length;++r<q;){if(h.order[r]===s){h.order[r]=a}}h.length--;delete h.stack[s]},getAll:function(){for(var s=-1,r=h.counter,q=[];++s<r;){if(h.stack[s]){q.push(h.stack[s])}}return f(q)},defaults:{backwardsCompatible:l,ajax:"ajax.php",ajaxCache:f.ajaxSettings.cache,dataSupply:[],dataFn:a,formatSupply:a,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:a,striped:a,maxHeight:a,bgiframe:a,newList:l,postVar:"value",postData:{},postFormat:a,minChars:1,maxItems:-1,maxRequests:0,requestType:"POST",inputControl:a,autoFill:l,nonInput:[e.shift,e.left,e.right],multiple:l,multipleSeparator:" ",onBlur:a,onFocus:a,onHide:a,onLoad:a,onMaxRequest:a,onRollover:a,onSelect:a,onShow:a,onListFormat:a,onSubmit:a,spinner:a,preventEnterSubmit:d,delay:0,useCache:d,cacheLimit:50}},g=function(K,u){h.length++;h.counter++;var q=f(K).attr("autocomplete","off"),S={},y={},G="",x=[],H={length:0},D,F,V,r,N,P=l,O,z,w=-1,v,t,J=h.counter,s=0,I={length:0,val:a,list:{}},R=f.extend({width:q.outerWidth()},h.defaults,u||{},f.metadata?q.metadata():{}),C=!R.newList&&o.find("ul."+R.list)[0]?o.find("ul."+R.list).eq(0).bgiframe(R.bgiframe):f("<ul/>").appendTo("body").addClass(R.list).bgiframe(R.bgiframe).hide().data("ac-selfmade",d);q.data("autoComplete",S={index:J,hasFocus:l,active:d,settings:R,initialSettings:f.extend(d,{},R)});if(f.browser.msie){q.bind("keypress.autoComplete",function(W){if(!S.active){return d}if(W.keyCode===e.enter){var X=d;if(D&&D.hasClass(R.rollover)){X=R.preventEnterSubmit&&P?l:d;M(W)}else{if(P){C.hide(W)}}return X}})}q.bind(k.opera?"keypress.autoComplete":"keydown.autoComplete",function(X){if(!S.active){return d}var W=(y=X).keyCode,Y=l;if(W===e.tab&&P){M(X)}else{if(W===e.enter){Y=d;if(D&&D.hasClass(R.rollover)){Y=R.preventEnterSubmit&&P?l:d;M(X)}else{if(P){C.hide(X)}}}else{if(W===e.up&&P){if(w>0){w--;B(X)}else{w=-1;q.val(G);C.hide(X)}}else{if(W===e.down&&P){if(w<H.length-1){w++;E(X)}}else{if(W===e.pageup&&P){if(w>0){w-=N;if(w<0){w=0}B(X)}}else{if(W===e.pagedown&&P){if(w<H.length-1){w+=N;if(w>H.length-1){w=H.length-1}E(X)}}else{if(R.nonInput&&f.inArray(W,R.nonInput)>-1){C.html("").hide(X);Y=d}else{return d}}}}}}}y["keydown_"+p]=d;return Y}).bind({"keyup.autoComplete":function(X){if(!S.active||y["keydown_"+p]){return d}G=q.val();var W=(y=X).keyCode,Y=t?G.split(t).pop():G;if(W!=e.enter){I.val=R.inputControl===a?Y:R.inputControl.apply(K,R.backwardsCompatible?[Y,W,C,X,R,I]:[X,{val:Y,key:W,settings:R,cache:I,ul:C}]);if(I.val.length>=R.minChars){T(X,R,I,(W===e.backspace||W===e.space))}else{if(W==e.backspace){C.html("").hide(X)}}}},"blur.autoComplete":function(W){if(!S.active||P){return d}if(h.order[0]!==a){h.order.unshift(a)}h.hasFocus=l;S.hasFocus=l;w=-1;C.hide(y=W);if(h.blur){h.blur.call(K,W,{settings:R,cache:I,ul:C})}if(R.onBlur){R.onBlur.apply(K,R.backwardsCompatible?[G,C,W,R,I]:[W,{val:G,settings:R,cache:I,ul:C}])}},"focus.autoComplete":function(X,W){if(!S.active||(S.hasFocus&&W===p)||y["enter_"+p]){return d}if(J!==C.data("ac-input-index")){C.html("").hide(X)}if(h.order[0]===a){if(h.order[1]===J){h.order.shift()}else{h.order[0]=J}}else{if(h.order[0]!=J&&h.order[1]!=J){h.order.unshift(J)}}if(h.defaults.cacheLimit!==-1&&h.order.length>h.defaults.cacheLimit){h.order.pop()}h.hasFocus=d;S.hasFocus=d;y=X;if(h.focus){h.focus.call(K,X,{settings:R,cache:I,ul:C})}if(R.onFocus){R.onFocus.apply(K,R.backwardsCompatible?[C,X,R,I]:[X,{settings:R,cache:I,ul:C}])}},"autoComplete.document-click":function(X,W){if(S.active&&P&&(!y||W.timeStamp-y.timeStamp>200)&&f(W.target).closest("ul").data("ac-input-index")!==J){C.hide(y=W);q.blur()}},"autoComplete.form-submit":function(Y,X,W){if(!S.active){return d}y=X;return R.preventEnterSubmit&&(P||y["enter_"+p])?l:R.onSubmit===a?d:R.onSubmit.call(K,X,{form:W,settings:R,cache:I,ul:C})},"autoComplete.ul-mouseenter":function(Y,X,W){if(D){D.removeClass(R.rollover)}D=f(W).addClass(R.rollover);w=H.index(W);v=x[w];if(R.onRollover){R.onRollover.apply(K,R.backwardsCompatible?[v,D,C,X,R,I]:[X,{data:v,li:D,settings:R,cache:I,ul:C}])}return(y=X)},"autoComplete.ul-click":function(X,W){q.trigger("focus",[p]);q.val(G===t?G.substr(0,G.length-G.split(t).pop().length)+v.value+t:v.value);C.hide(W);L();if(R.onSelect){R.onSelect.apply(K,R.backwardsCompatible?[v,D,C,W,R,I]:[W,{data:v,li:D,settings:R,cache:I,ul:C}])}return(y=W)},"autoComplete.settings":function(Z,W){if(!S.active){return d}var X,Y;if(f.isFunction(W)){X=W.apply(K,R.backwardsCompatible?[R,I,C,Z]:[Z,{settings:R,cache:I,ul:C}]);if(f.isArray(X)&&X[0]!==a){f.extend(d,R,X[0]||R);f.extend(d,I,X[1]||I)}}else{f.extend(d,R,W||{})}C=!R.newList&&C.hasClass(R.list)?C:!R.newList&&(Y=o.find("ul."+R.list).eq(0)).length?Y.bgiframe(R.bgiframe):f("<ul/>").appendTo("body").addClass(R.list).bgiframe(R.bgiframe).hide().data("ac-selfmade",d);A();R.requestType=R.requestType.toUpperCase();t=R.multiple?R.multipleSeparator:a;S.settings=R;return(y=Z)},"autoComplete.flush":function(W,X){if(!S.active){return d}if(!X){s=0}I={length:0,val:a,list:{}};return(y=W)},"autoComplete.button-ajax":function(X,W,Y){if(!S.active){return d}if(typeof W==="string"){Y=W;W={}}y=X;q.trigger("focus",[p]);I.val=Y||"button-ajax_"+p;return T(X,f.extend(d,{},R,{maxItems:-1,postData:W||{}}),I)},"autoComplete.button-supply":function(W,X,Y){if(!S.active){return d}if(typeof X==="string"){Y=X;X=a}y=W;q.trigger("focus",[p]);I.val=Y||"button-supply_"+p;X=f.isArray(X)?X:R.dataSupply;return T(W,f.extend(d,{},R,{maxItems:-1,dataSupply:X,formatSupply:m}),I)},"autoComplete.direct-supply":function(W,X,Y){if(!S.active){return d}if(typeof X==="string"){Y=X;X=a}y=W;q.trigger("focus",[p]);I.val=Y||"direct-supply_"+p;X=f.isArray(X)&&X.length?X:R.dataSupply;return U(W,X,f.extend(d,{},R,{maxItems:-1,dataSupply:X,formatSupply:m}),I)},"autoComplete.search":function(W,X){if(!S.active){return d}I.val=X||"";return T(y=W,R,I)},"autoComplete.option":function(Y,W,Z){if(!S.active){return d}var X=j.call(arguments).length;y=Y;if(X===3){R[W]=Z;return Z}else{if(X===2){switch(W){case"ul":return C;case"cache":return I;case"xhr":return z;case"input":return q;default:return R[W]||a}}else{return R}}},"autoComplete.enable":function(W){S.active=d;return(y=W)},"autoComplete.disable":function(W){S.active=l;C.html("").hide(W);return(y=W)},"autoComplete.destroy":function(X){var Y=C.html("").hide(y=X).data("ac-inputs")||{},W;q.removeData("autoComplete").unbind(".autoComplete autoComplete");n(q,J);Y[J]=a;for(W in Y){if(Y.hasOwnProperty(W)&&Y[W]===d){return y}}if(C.data("ac-selfmade")===d){C.remove()}else{C.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}return y}});function T(Y,X,W,aa,Z){if(X.spinner){X.spinner.call(K,Y,{active:d,settings:X,cache:W,ul:C})}if(O){O=clearTimeout(O)}if(X.delay>0&&Z===a){O=k.setTimeout(function(){T(Y,X,W,aa,d)},X.delay);return O}if(z){z.abort()}if(X.useCache&&f.isArray(W.list[W.val])){return U(Y,W.list[W.val],X,W,aa)}if(X.dataSupply.length){return Q(Y,X,W,aa)}if(X.maxRequests&&++s>=X.maxRequests){C.html("").hide(Y);if(X.spinner){X.spinner.call(K,Y,{active:l,settings:X,cache:W,ul:C})}if(X.onMaxRequest&&s===X.maxRequests){return X.onMaxRequest.apply(K,X.backwardsCompatible?[W.val,C,Y,G,X,W]:[Y,{search:W.val,val:G,settings:X,cache:W,ul:C}])}return l}X.postData[X.postVar]=W.val;z=f.ajax({type:X.requestType,url:X.ajax,cache:X.ajaxCache,dataType:"json",data:X.postFormat?X.postFormat.call(K,Y,{data:X.postData,search:W.val,val:G,settings:X,cache:W,ul:C}):X.postData,success:function(ab){U(Y,ab,X,W,aa)},error:function(){C.html("").hide(Y);if(X.spinner){X.spinner.call(K,Y,{active:l,settings:X,cache:W,ul:C})}}});return z}function Q(X,aa,W,Z){var ac=[],ae=[],af=f.isFunction(aa.dataFn),ag=af?a:new RegExp("^"+W.val,"i"),ad=0,ah,ab=-1,Y=aa.dataSupply.length;if(aa.formatSupply){ac=aa.formatSupply.call(K,X,{search:W.val,supply:aa.dataSupply,settings:aa,cache:W,ul:C})}else{for(;++ab<Y;){ah=aa.dataSupply[ab];ah=ah&&typeof ah.value==="string"?ah:{value:ah};ae=aa.backwardsCompatible?[W.val,ah.value,ac,ab,aa.dataSupply,C,X,aa,W]:[X,{search:W.val,entry:ah.value,list:ac,i:ab,supply:aa.dataSupply,settings:aa,cache:W,ul:C}];if((af&&aa.dataFn.apply(K,ae))||(!af&&ah.value.match(ag))){if(aa.maxItems>-1&&++ad>aa.maxItems){break}ac.push(ah)}}}return U(X,ac,aa,W,Z)}function M(W){if(P){if(R.onSelect){R.onSelect.apply(K,R.backwardsCompatible?[v,D,C,W,R,I]:[W,{data:v,li:D,settings:R,cache:I,ul:C}])}L();G=q.val();if(y.type==="keydown"){y["enter_"+p]=d}C.hide(W)}return(D=a)}function B(X){if(D){D.removeClass(R.rollover)}C.show(X);D=H.eq(w).addClass(R.rollover);v=x[w];if(!D.length||!v){return l}L(v.value);if(R.onRollover){R.onRollover.apply(K,R.backwardsCompatible?[v,D,C,X,R,I]:[X,{data:v,li:D,settings:R,cache:I,ul:C}])}var W=w*r;if(W<F-V){F=W+V;C.scrollTop(W)}return D}function E(X){if(D){D.removeClass(R.rollover)}C.show(X);D=H.eq(w).addClass(R.rollover);v=x[w];if(!D.length||!v){return l}L(v.value);var W=(w+1)*r;if(W>F){C.scrollTop((F=W)-V)}if(R.onRollover){R.onRollover.apply(K,R.backwardsCompatible?[v,D,C,X,R,I]:[X,{data:v,li:D,settings:R,cache:I,ul:C}])}return D}function A(){var X=C.hide,W=C.show,Y=C.data("ac-inputs")||{};if(!C[p]){C.hide=function(Z,aa,ab){if(R.onHide&&P){R.onHide.call(K,Z,{ul:C,settings:R,cache:I})}P=l;return X.call(C,aa,ab)};C.show=function(Z,aa,ab){if(R.onShow&&!P){R.onShow.call(K,Z,{ul:C,settings:R,cache:I})}P=d;return W.call(C,aa,ab)};C[p]=d}if(C.data("autoComplete")!==d){C.data("autoComplete",d).delegate("li","mouseenter.autoComplete",function(Z){h.getFocus(d).trigger("autoComplete.ul-mouseenter",[Z,this])}).bind("click.autoComplete",function(Z){h.getFocus(d).trigger("autoComplete.ul-click",[Z]);return l})}Y[J]=d;return C.data("ac-inputs",Y)}function L(Y){var Z,W,X;if(Y===a||Y===""){Z=W=q.val().length}else{if(t){Y=G.substr(0,G.length-G.split(t).pop().length)+Y+t}Z=G.length;W=Y.length;q.val(Y)}if(!R.autoFill||Z>W){return l}else{if(K.createTextRange){X=K.createTextRange();if(Y===a){X.move("character",Z);X.select()}else{X.collapse(d);X.moveStart("character",Z);X.moveEnd("character",W);X.select()}}else{if(K.setSelectionRange){K.setSelectionRange(Z,W)}else{if(K.selectionStart){K.selectionStart=Z;K.selectionEnd=W}}}}return d}function U(X,af,ab,W,aa){x=ab.onLoad?ab.onLoad.call(K,X,{list:af,settings:ab,cache:W,ul:C}):af;if(ab.spinner){ab.spinner.call(K,X,{active:l,settings:ab,cache:W,ul:C})}if(ab.useCache&&!f.isArray(W.list[W.val])){W.length++;W.list[W.val]=af;if(ab.cacheLimit!==-1&&W.length>ab.cacheLimit){W.list={};W.length=0}}if(!x||x.length<1){return C.html("").hide(X)}w=-1;var ad=q.offset(),Y=[],ag=0,ae=-1,ac=l,Z=x.length;if(ab.onListFormat){ab.onListFormat.call(K,X,{list:x,settings:ab,cache:W,ul:C})}else{for(;++ae<Z;){if(x[ae].value){if(ab.maxItems>-1&&++ag>ab.maxItems){break}Y.push(ab.striped&&ac?'<li class="'+ab.striped+'">':"<li>",x[ae].display||x[ae].value,"</li>");ac=!ac}}C.html(Y.join(""))}H=C.children("li");if(ab.autoFill&&!aa){w=0;v=x[0];L(v.value);D=H.eq(0).addClass(ab.rollover)}C.data("ac-input-index",J).scrollTop(0).css({top:ad.top+q.outerHeight(),left:ad.left,width:ab.width}).show(X);r=H.eq(0).outerHeight();if(ab.maxHeight){C.css({height:r*H.length>ab.maxHeight?ab.maxHeight:"auto",overflow:"auto"})}V=C.outerHeight();F=V;N=r===0?0:Math.floor(F/r);y.timeStamp=(new Date()).getTime()}A();R.requestType=R.requestType.toUpperCase();t=R.multiple?R.multipleSeparator:a;h.stack[J]=K;h.jqStack[J]=q;b(q,J)}})(jQuery,window||this);