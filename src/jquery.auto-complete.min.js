/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */ 
(function(j,h,e){j.fn.autoComplete=function(){var t=r.call(arguments),s=this,x=t.shift(),w=typeof x=="string",v,u;t=(p.arrayMethods[x]===f&&j.isArray(t[0])&&j.isArray(t[0][0]))||(t.length===1&&j.isArray(t[0]))?t[0]:t;v=w&&(p.handlerMethods[x]===-1||t.length<(p.handlerMethods[x]||0))?"triggerHandler":"trigger";return w?s[v]("autoComplete."+x,t):x&&x.preventDefault!==e?s.trigger(x,t):j.each(s,function(){if(j.data(u=this,"autoComplete")!==f){j.autoComplete(u,x)}})};function n(w,u){if(n.flag!==f){n.flag=f;i.bind("click.autoComplete",function(x){p.getFocus(f).trigger("autoComplete.document-click",[x])})}var s=w.closest("form"),v,t;if(s.length<1){return s}v=j.data(s[0],"ac-inputs")||{};v[u]=f;j.data(s[0],"ac-inputs",v);if(j.data(s[0],"autoComplete")!==f){j.data(s[0],"autoComplete",f);s.bind("submit.autoComplete",function(x){return(t=p.getFocus(f)).length?t.triggerHandler("autoComplete.form-submit",[x,this]):f})}}function a(w,u){p.remove(u);if(n.flag===f&&p.length===0){n.flag=q;i.unbind("click.autoComplete")}var s=w.closest("form"),v,t;if(s.length<1){return}v=j.data(s[0],"ac-inputs")||{};v[u]=q;for(t in v){if(v.hasOwnProperty(t)&&v[t]===f){return}}s.unbind("submit.autoComplete")}function d(w,x){if(!j.isArray(x.supply)){return[]}for(var u=-1,s=x.supply.length,t=[],v;++u<s;){v=x.supply[u];v=v&&v.value?v:{value:v};t.push(v)}return t}function l(){return this}var f=true,q=false,r=Array.prototype.slice,o=h.document,i=j(o),m=j(),k=h.opera||(/macintosh/i.test(h.navigator.userAgent)&&j.browser.mozilla)?"keypress.autoComplete":"keydown.autoComplete",c="autoComplete_"+j.expando,b={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},g=j.autoComplete,p={version:"[VERSION]",expando:c,counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:q,keys:b,arrayMethods:{"button-supply":f,"direct-supply":f},handlerMethods:{option:2},focus:e,blur:e,getFocus:function(s){return !p.order[0]?s?m:e:s?p.jqStack[p.order[0]]:p.stack[p.order[0]]},getPrevious:function(u){for(var t=0,s=p.order.length;++t<s;){if(p.order[t]){return u?p.jqStack[p.order[t]]:p.stack[p.order[t]]}}return u?m:e},remove:function(u){for(var t=-1,s=p.order.length;++t<s;){if(p.order[t]===u){p.order[t]=e}}p.length--;delete p.stack[u]},getAll:function(){for(var u=-1,t=p.counter,s=[];++u<t;){if(p.stack[u]){s.push(p.stack[u])}}return j(s)},defaults:{ajax:"ajax.php",ajaxCache:j.ajaxSettings.cache,dataSupply:[],dataFn:e,formatSupply:e,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:e,striped:e,maxHeight:e,bgiframe:e,newList:q,postVar:"value",postData:{},postFormat:e,minChars:1,maxItems:-1,maxRequests:0,maxRequestsDeep:q,requestType:"POST",onChange:e,autoFill:q,nonInput:[b.shift,b.left,b.right],multiple:q,multipleSeparator:" ",onBlur:e,onFocus:e,onHide:e,onLoad:e,onMaxRequest:e,onRollover:e,onSelect:e,onShow:e,onListFormat:e,onSubmit:e,spinner:e,preventEnterSubmit:f,delay:0,useCache:f,cacheLimit:50}};j.autoComplete=function(N,x){p.length++;p.counter++;var s=j(N).attr("autocomplete","off"),G,Z,t,W={},B={},J="",A=[],K={length:0},F,I,aa,u,Q,T=q,S,C,z=-1,y,w,M=p.counter,v=0,R=j.fn.bgiframe||j.fn.bgIframe||l,L={length:0,val:e,list:{}},V=j.extend({width:s.outerWidth()},p.defaults,x||{},j.metadata?s.metadata():{});j.data(N,"autoComplete",W={index:M,hasFocus:q,active:f,settings:V,initialSettings:j.extend(f,{},V)});if(N.attachEvent){s.bind("keypress.autoComplete",function(ab){if(!W.active){return f}if(ab.keyCode===b.enter){var ac=f;if(F&&F.hasClass(V.rollover)){ac=V.preventEnterSubmit&&T?q:f;P(ab)}else{if(T){G.hide(ab)}}return ac}})}s.bind(k,function(ac){if(!W.active){return f}var ab=(B=ac).keyCode,ad=q;if(ab===b.tab&&T){P(ac)}else{if(ab===b.enter){ad=f;if(F&&F.hasClass(V.rollover)){ad=V.preventEnterSubmit&&T?q:f;P(ac)}else{if(T){G.hide(ac)}}}else{if(ab===b.up&&T){if(z>0){z--;E(ac)}else{z=-1;F=e;s.val(J);G.hide(ac)}}else{if(ab===b.down&&T){if(z<K.length-1){z++;H(ac)}}else{if(ab===b.pageup&&T){if(z>0){z-=Q;if(z<0){z=0}E(ac)}}else{if(ab===b.pagedown&&T){if(z<K.length-1){z+=Q;if(z>K.length-1){z=K.length-1}H(ac)}}else{if(V.nonInput&&j.inArray(ab,V.nonInput)>-1){G.html("").hide(ac);ad=f}else{return f}}}}}}}B["keydown_"+c]=f;return ad}).bind({"keyup.autoComplete":function(ac){if(!W.active||B["keydown_"+c]){return f}J=s.val();var ab=(B=ac).keyCode,ad=w?J.split(w).pop():J;if(ab!=b.enter){L.val=V.onChange===e?ad:V.onChange.call(N,ac,{val:ad,key:ab,settings:V,cache:L,ul:G});if(L.val.length>=V.minChars){X(ac,V,L,(ab===b.backspace||ab===b.space))}else{if(ab==b.backspace){G.html("").hide(ac)}}}},"blur.autoComplete":function(ab){if(!W.active||T){return f}if(p.order[0]!==e){p.order.unshift(e)}p.hasFocus=q;W.hasFocus=q;z=-1;F=e;G.hide(B=ab);if(p.blur){p.blur.call(N,ab,{settings:V,cache:L,ul:G})}if(V.onBlur){V.onBlur.call(N,ab,{val:J,settings:V,cache:L,ul:G})}},"focus.autoComplete":function(ac,ab){if(!W.active||(W.hasFocus&&ab===c)||B["enter_"+c]){return f}if(M!==j.data(G[0],"ac-input-index")){G.html("").hide(ac)}if(p.order[0]===e){if(p.order[1]===M){p.order.shift()}else{p.order[0]=M}}else{if(p.order[0]!=M&&p.order[1]!=M){p.order.unshift(M)}}if(p.defaults.cacheLimit!==-1&&p.order.length>p.defaults.cacheLimit){p.order.pop()}p.hasFocus=f;W.hasFocus=f;B=ac;if(p.focus){p.focus.call(N,ac,{settings:V,cache:L,ul:G})}if(V.onFocus){V.onFocus.call(N,ac,{settings:V,cache:L,ul:G})}},"autoComplete.document-click":function(ac,ab){if(W.active&&T&&(!B||ab.timeStamp-B.timeStamp>200)&&j(ab.target).closest("ul").data("ac-input-index")!==M){G.hide(B=ab);s.trigger("blur")}},"autoComplete.form-submit":function(ad,ac,ab){if(!W.active){return f}B=ac;return V.preventEnterSubmit&&(T||B["enter_"+c])?q:V.onSubmit===e?f:V.onSubmit.call(N,ac,{form:ab,settings:V,cache:L,ul:G})},"autoComplete.ul-mouseenter":function(ad,ac,ab){if(F){F.removeClass(V.rollover)}F=j(ab).addClass(V.rollover);z=K.index(ab);y=A[z];I=G.scrollTop()+aa;B=ac;if(V.onRollover){V.onRollover.call(N,ac,{data:y,li:F,settings:V,cache:L,ul:G})}},"autoComplete.ul-click":function(ac,ab){s.trigger("focus",[c]);s.val(J===w?J.substr(0,J.length-J.split(w).pop().length)+y.value+w:y.value);G.hide(B=ab);O();if(V.onSelect){V.onSelect.call(N,ab,{data:y,li:F,settings:V,cache:L,ul:G})}},"autoComplete.settings":function(ae,ab){if(!W.active){return f}var ac,ad;B=ae;if(j.isFunction(ab)){ac=ab.call(N,ae,{settings:V,cache:L,ul:G});if(j.isArray(ac)&&ac[0]!==e){j.extend(f,V,ac[0]||V);j.extend(f,L,ac[1]||L)}}else{j.extend(f,V,ab||{})}R=j.fn.bgiframe||j.fn.bgIframe||l;G=D();V.requestType=V.requestType.toUpperCase();if(V.inputControl!==e&&V.onChange===e){V.onChange=V.inputControl}w=V.multiple?V.multipleSeparator:e;W.settings=V},"autoComplete.flush":function(ab,ac){if(!W.active){return f}if(!ac){v=0}L={length:0,val:e,list:{}};B=ab},"autoComplete.button-ajax":function(ac,ab,ad){if(!W.active){return f}if(typeof ab=="string"){ad=ab;ab={}}B=ac;s.trigger("focus",[c]);L.val=ad||"button-ajax_"+c;return X(ac,j.extend(f,{},V,{maxItems:-1,postData:ab||{}}),L)},"autoComplete.button-supply":function(ab,ac,ad){if(!W.active){return f}if(typeof ac=="string"){ad=ac;ac=e}B=ab;s.trigger("focus",[c]);L.val=ad||"button-supply_"+c;ac=j.isArray(ac)?ac:V.dataSupply;return X(ab,j.extend(f,{},V,{maxItems:-1,dataSupply:ac,formatSupply:d}),L)},"autoComplete.direct-supply":function(ab,ac,ad){if(!W.active){return f}if(typeof ac=="string"){ad=ac;ac=e}B=ab;s.trigger("focus",[c]);L.val=ad||"direct-supply_"+c;ac=j.isArray(ac)&&ac.length?ac:V.dataSupply;return Y(ab,ac,j.extend(f,{},V,{maxItems:-1,dataSupply:ac,formatSupply:d}),L)},"autoComplete.search":function(ab,ac){if(!W.active){return f}L.val=ac||"";return X(B=ab,V,L)},"autoComplete.option":function(ac,ab,ad){if(!W.active){return f}B=ac;switch(r.call(arguments).length){case 3:V[ab]=ad;return ad;case 2:return ab==="ul"?G:ab==="cache"?L:ab==="xhr"?C:ab==="input"?s:V[ab]||e;default:return V}},"autoComplete.enable":function(ab){W.active=f;B=ab},"autoComplete.disable":function(ab){W.active=q;G.html("").hide(B=ab)},"autoComplete.destroy":function(ac){var ad=j.data(G.html("").hide(B=ac)[0],"ac-inputs")||{},ab;s.removeData("autoComplete").unbind(".autoComplete autoComplete");a(s,M);ad[M]=e;for(ab in ad){if(ad.hasOwnProperty(ab)&&ad[ab]===f){return B}}if(j.data(G[0],"ac-selfmade")===f){G.remove()}else{G.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}}});function X(ad,ac,ab,af,ae){if(ac.maxRequestsDeep===f&&v>=ac.maxRequests){return q}if(ac.spinner){ac.spinner.call(N,ad,{active:f,settings:ac,cache:ab,ul:G})}if(S){S=clearTimeout(S)}if(ac.delay>0&&ae===e){S=h.setTimeout(function(){X(ad,ac,ab,af,f)},ac.delay);return S}if(C){C.abort()}if(ac.useCache&&j.isArray(ab.list[ab.val])){return Y(ad,ab.list[ab.val],ac,ab,af)}if(ac.dataSupply.length){return U(ad,ac,ab,af)}if(ac.maxRequests&&++v>=ac.maxRequests){G.html("").hide(ad);if(ac.spinner){ac.spinner.call(N,ad,{active:q,settings:ac,cache:ab,ul:G})}if(ac.onMaxRequest&&v===ac.maxRequests){return ac.onMaxRequest.call(N,ad,{search:ab.val,val:J,settings:ac,cache:ab,ul:G})}return q}ac.postData[ac.postVar]=ab.val;C=j.ajax({type:ac.requestType,url:ac.ajax,cache:ac.ajaxCache,dataType:"json",data:ac.postFormat?ac.postFormat.call(N,ad,{data:ac.postData,search:ab.val,val:J,settings:ac,cache:ab,ul:G}):ac.postData,success:function(ag){Y(ad,ag,ac,ab,af)},error:function(){G.html("").hide(ad);if(ac.spinner){ac.spinner.call(N,ad,{active:q,settings:ac,cache:ab,ul:G})}}});return C}function U(ac,af,ab,ae){var ah=[],aj={},ak=j.isFunction(af.dataFn),al=ak?e:new RegExp("^"+ab.val,"i"),ai=0,am,ag=-1,ad=af.dataSupply.length;if(af.formatSupply){ah=af.formatSupply.call(N,ac,{search:ab.val,supply:af.dataSupply,settings:af,cache:ab,ul:G})}else{for(;++ag<ad;){am=af.dataSupply[ag];am=am&&typeof am.value=="string"?am:{value:am};aj={search:ab.val,entry:am.value,list:ah,i:ag,supply:af.dataSupply,settings:af,cache:ab,ul:G};if((ak&&af.dataFn.call(N,ac,aj))||(!ak&&am.value.match(al))){if(af.maxItems>-1&&++ai>af.maxItems){break}ah.push(am)}}}return Y(ac,ah,af,ab,ae)}function P(ab){if(T){if(V.onSelect){V.onSelect.call(N,ab,{data:y,li:F,settings:V,cache:L,ul:G})}O();J=s.val();if(B.type==="keydown"){B["enter_"+c]=f}G.hide(ab)}F=e}function E(ac){if(F){F.removeClass(V.rollover)}G.show(ac);F=K.eq(z).addClass(V.rollover);y=A[z];if(!F.length||!y){return q}O(y.value);if(V.onRollover){V.onRollover.call(N,ac,{data:y,li:F,settings:V,cache:L,ul:G})}var ab=z*u;if(ab<I-aa){I=ab+aa;G.scrollTop(ab)}}function H(ac){if(F){F.removeClass(V.rollover)}G.show(ac);F=K.eq(z).addClass(V.rollover);y=A[z];if(!F.length||!y){return q}O(y.value);var ab=(z+1)*u;if(ab>I){G.scrollTop((I=ab)-aa)}if(V.onRollover){V.onRollover.call(N,ac,{data:y,li:F,settings:V,cache:L,ul:G})}}function D(){if(!V.newList&&!G){G=V.list.jquery?V.list:V.list.nodeName?j(V.list):typeof V.list=="string"&&(Z=i.find("ul."+V.list).eq(0)).length?R.call(Z,V.bgiframe):e}if(!G){G=R.call(j("<ul/>").appendTo("body").addClass(V.list).hide().data("ac-selfmade",f),V.bgiframe)}var ac=G.hide,ab=G.show,ad=j.data(G[0],"ac-inputs")||{};if(!G[c]){G.hide=function(ae,af,ag){if(V.onHide&&T){V.onHide.call(N,ae,{ul:G,settings:V,cache:L})}T=q;return ac.call(G,af,ag)};G.show=function(ae,af,ag){if(V.onShow&&!T){V.onShow.call(N,ae,{ul:G,settings:V,cache:L})}T=f;return ab.call(G,af,ag)};G[c]=f}if(j.data(G[0],"autoComplete")!==f){j.data(G[0],"autoComplete",f);G.delegate("li","mouseenter.autoComplete",function(ae){p.getFocus(f).trigger("autoComplete.ul-mouseenter",[ae,this])}).bind("click.autoComplete",function(ae){p.getFocus(f).trigger("autoComplete.ul-click",[ae]);return q})}ad[M]=f;j.data(G[0],"ac-inputs",ad);return G}function O(ad){var ae,ab,ac;if(ad===e||ad===""){ae=ab=s.val().length}else{if(w){ad=J.substr(0,J.length-J.split(w).pop().length)+ad+w}ae=J.length;ab=ad.length;s.val(ad)}if(!V.autoFill||ae>ab){return q}else{if(N.createTextRange){ac=N.createTextRange();if(ad===e){ac.move("character",ae);ac.select()}else{ac.collapse(f);ac.moveStart("character",ae);ac.moveEnd("character",ab);ac.select()}}else{if(N.setSelectionRange){N.setSelectionRange(ae,ab)}else{if(N.selectionStart){N.selectionStart=ae;N.selectionEnd=ab}}}}}function Y(ac,aj,ag,ab,af){A=ag.onLoad?ag.onLoad.call(N,ac,{list:aj,settings:ag,cache:ab,ul:G}):aj;if(ag.spinner){ag.spinner.call(N,ac,{active:q,settings:ag,cache:ab,ul:G})}if(ag.useCache&&!j.isArray(ab.list[ab.val])){ab.length++;ab.list[ab.val]=aj;if(ag.cacheLimit!==-1&&ab.length>ag.cacheLimit){ab.list={};ab.length=0}}if(!A||A.length<1){return G.html("").hide(ac)}z=-1;F=e;var ah=s.offset(),ad=[],al=0,ai=-1,ak=q,ae=A.length;if(ag.onListFormat){ag.onListFormat.call(N,ac,{list:A,settings:ag,cache:ab,ul:G})}else{for(;++ai<ae;){if(A[ai].value){if(ag.maxItems>-1&&++al>ag.maxItems){break}ad.push(ag.striped&&ak?'<li class="'+ag.striped+'">':"<li>",A[ai].display||A[ai].value,"</li>");ak=!ak}}G.html(ad.join(""))}K=G.children("li");j.data(G[0],"ac-input-index",M);if(ag.autoFill&&!af){z=0;y=A[0];O(y.value);F=K.eq(0).addClass(ag.rollover)}G.scrollTop(0).css({top:ah.top+s.outerHeight(),left:ah.left,width:ag.width}).show(ac);u=K.eq(0).outerHeight();if(ag.maxHeight){G.css({height:u*K.length>ag.maxHeight?ag.maxHeight:"auto",overflow:"auto"})}aa=G.outerHeight();I=aa;Q=u===0?0:Math.floor(I/u);B.timeStamp=(new Date()).getTime()}G=D();V.requestType=V.requestType.toUpperCase();if(V.inputControl!==e&&V.onChange===e){V.onChange=V.inputControl}w=V.multiple?V.multipleSeparator:e;p.stack[M]=N;p.jqStack[M]=s;n(s,M)};p=j.extend(j.autoComplete,p)})(jQuery,this);