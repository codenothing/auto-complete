/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */
(function(f,k,a){f.fn.autoComplete=function(){var r=j.call(arguments),q=this,v=r.shift(),u=typeof v==="string",t,s;if(u){v=v.replace(c,"-")}r=(h.arrayMethods[v]===d&&f.isArray(r[0])&&f.isArray(r[0][0]))||(r.length===1&&f.isArray(r[0]))?r[0]:r;t=u&&(h.handlerMethods[v]===-1||r.length<(h.handlerMethods[v]||0))?"triggerHandler":"trigger";return u?q[t]("autoComplete."+v,r):v&&v.preventDefault!==a?q.trigger(v,r):q.each(function(){if(f(s=this).data("autoComplete")!==d){g(s,v)}})};f.fn.bgiframe=f.fn.bgiframe?f.fn.bgiframe:f.fn.bgIframe?f.fn.bgIframe:function(){return this};function b(u,s){if(b.flag!==d){b.flag=d;o.bind("click.autoComplete",function(v){h.getFocus(d).trigger("autoComplete.document-click",[v])})}var q=u.closest("form"),t=q.data("ac-inputs")||[],r;t[s]=d;q.data("ac-inputs",t);if(q.data("autoComplete")!==d){q.data("autoComplete",d).bind("submit.autoComplete",function(v){return(r=h.getFocus(d)).length?r.triggerHandler("autoComplete.form-submit",[v]):d})}}function n(v,t){h.remove(t);if(b.flag===d&&h.length===0){b.flag=l;o.unbind("click.autoComplete")}var r=v.closest("form"),u=r.data("ac-inputs"),s=-1,q=(u||[]).length;u[t]=l;for(;++s<q;){if(u[s]===d){return}}r.unbind("submit.autoComplete")}function m(u,v){if(!f.isArray(v.supply)){return[]}for(var s=-1,q=v.supply.length,r=[],t;++s<q;){t=v.supply[s];t=t&&t.value?t:{value:t};r.push(t)}return r}var d=true,l=false,j=Array.prototype.slice,o=f(k.document),i=f(),c=/\./,p="autoComplete_"+f.expando,e={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},h=f.autoComplete={version:"[VERSION]",counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:l,keys:e,arrayMethods:{"button-supply":d,"direct-supply":d},handlerMethods:{option:2},focus:a,blur:a,getFocus:function(q){return !h.order[0]?q?i:a:q?h.jqStack[h.order[0]]:h.stack[h.order[0]]},getPrevious:function(s){for(var r=0,q=h.order.length;++r<q;){if(h.order[r]){return s?h.jqStack[h.order[r]]:h.stack[h.order[r]]}}return s?i:a},remove:function(s){for(var r=-1,q=h.order.length;++r<q;){if(h.order[r]===s){h.order[r]=a}}h.length--;delete h.stack[s]},getAll:function(){for(var s=-1,r=h.counter,q=[];++s<r;){if(h.stack[s]){q.push(h.stack[s])}}return f(q)},defaults:{backwardsCompatible:l,ajax:"ajax.php",ajaxCache:f.ajaxSettings.cache,dataSupply:[],dataFn:a,formatSupply:a,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:a,striped:a,maxHeight:a,newList:l,postVar:"value",postData:{},postFormat:a,minChars:1,maxItems:-1,maxRequests:0,requestType:"POST",inputControl:a,autoFill:l,nonInput:[e.right,e.left,e.shift],multiple:l,multipleSeparator:" ",onBlur:a,onFocus:a,onHide:a,onLoad:a,onMaxRequest:a,onRollover:a,onSelect:a,onShow:a,onSubmit:function(){return d},spinner:a,onListFormat:a,preventEnterSubmit:d,delay:0,useCache:d,cacheLimit:50}},g=function(K,u){h.length++;h.counter++;var q=f(K).attr("autocomplete","off"),O=d,y={},G="",x=[],H={length:0},D,F,V,r,N,Q=l,P,z,w=-1,v,t,J=h.counter,s=0,I={length:0,val:a,list:{}},S=f.extend({width:q.outerWidth()},h.defaults,u||{},f.metadata?q.metadata():{}),C=!S.newList&&f("ul."+S.list)[0]?f("ul."+S.list).eq(0).bgiframe():f("<ul/>").appendTo("body").addClass(S.list).bgiframe().hide().data("ac-selfmade",d);q.data({autoComplete:d,"ac-input-index":J,"ac-active":O,"ac-initial-settings":f.extend(d,{},S),"ac-settings":S}).bind(k.opera?"keypress.autoComplete":"keydown.autoComplete",function(X){if(!O){return d}var W=(y=X).keyCode,Y=l;if(W===e.tab&&Q){M(X)}else{if(W===e.enter){Y=d;if(D&&D.hasClass(S.rollover)){Y=S.preventEnterSubmit&&Q?l:d;M(X)}else{if(Q){C.hide(X)}}}else{if(W===e.up){if(w>0){w--;B(X)}else{w=-1;q.val(G);C.hide(X)}}else{if(W===e.down){if(w<H.length-1){w++;E(X)}}else{if(W===e.pageup){if(w>0){w-=N;if(w<0){w=0}B(X)}}else{if(W===e.pagedown){if(w<H.length-1){w+=N;if(w>H.length-1){w=H.length-1}E(X)}}else{if(S.nonInput&&f.inArray(W,S.nonInput)>-1){C.html("").hide(X);Y=d}else{return d}}}}}}}y["keydown_"+p]=d;return Y}).bind({"keyup.autoComplete":function(X){if(!O||y["keydown_"+p]){return d}G=q.val();var W=(y=X).keyCode,Y=t?G.split(t).pop():G;if(W!=e.enter){I.val=S.inputControl===a?Y:S.inputControl.apply(K,S.backwardsCompatible?[Y,W,C,X,S,I]:[X,{val:Y,key:W,settings:S,cache:I,ul:C}]);if(I.val.length>=S.minChars){T(X,S,I,(W===e.backspace||W===e.space))}else{if(W==e.backspace){C.html("").hide(X)}}}},"blur.autoComplete":function(W){if(!O||Q){return d}y=W;q.data("ac-hasFocus",l);w=-1;if(h.order[0]!==a){h.order.unshift(a)}h.hasFocus=l;C.hide(W);if(h.blur){h.blur.call(K,W,{settings:S,cache:I,ul:C})}if(S.onBlur){S.onBlur.apply(K,S.backwardsCompatible?[G,C,W,S,I]:[W,{val:G,settings:S,cache:I,ul:C}])}},"focus.autoComplete":function(X,W){if(!O||(h.focus===J&&W===p)||y["enter_"+p]){return d}y=X;if(J!==C.data("ac-input-index")){C.html("").hide(X)}if(h.order[0]===a){if(h.order[1]===J){h.order.shift()}else{h.order[0]=J}}else{if(h.order[0]!=J&&h.order[1]!=J){h.order.unshift(J)}}if(h.order.length>h.defaults.cacheLimit){h.order.pop()}h.hasFocus=d;q.data("ac-hasFocus",d);if(h.focus){h.focus.call(K,X,{settings:S,cache:I,ul:C})}if(S.onFocus){S.onFocus.apply(K,S.backwardsCompatible?[C,X,S,I]:[X,{settings:S,cache:I,ul:C}])}},"autoComplete.document-click":function(X,W){if(O&&Q&&(!y||W.timeStamp-y.timeStamp>200)&&f(W.target).closest("ul").data("ac-input-index")!==J){C.hide(y=W);q.blur()}},"autoComplete.form-submit":function(X,W){if(!O){return d}y=W;return S.preventEnterSubmit&&(Q||y["enter_"+p])?l:S.onSubmit.call(K,W,{form:this,settings:S,cache:I,ul:C})},"autoComplete.ul-mouseenter":function(Y,X,W){if(D){D.removeClass(S.rollover)}D=f(W).addClass(S.rollover);w=H.index(W);v=x[w];if(S.onRollover){S.onRollover.apply(K,S.backwardsCompatible?[v,D,C,X,S,I]:[X,{data:v,li:D,settings:S,cache:I,ul:C}])}return(y=X)},"autoComplete.ul-click":function(X,W){q.trigger("focus",[p]);q.val(G===t?G.substr(0,G.length-G.split(t).pop().length)+v.value+t:v.value);C.hide(W);L();if(S.onSelect){S.onSelect.apply(K,S.backwardsCompatible?[v,D,C,W,S,I]:[W,{data:v,li:D,settings:S,cache:I,ul:C}])}return(y=W)},"autoComplete.settings":function(Z,W){if(!O){return d}var X,Y;if(f.isFunction(W)){X=W.apply(K,S.backwardsCompatible?[S,I,C,Z]:[Z,{settings:S,cache:I,ul:C}]);if(f.isArray(X)&&X[0]!==a){f.extend(d,S,X[0]||S);f.extend(d,I,X[1]||I)}}else{f.extend(d,S,W||{})}C=!S.newList&&C.hasClass(S.list)?C:!S.newList&&(Y=f("ul."+S.list).eq(0)).length?Y.bgiframe():f("<ul/>").appendTo("body").addClass(S.list).bgiframe().hide().data("ac-selfmade",d);A();S.requestType=S.requestType.toUpperCase();t=S.multiple?S.multipleSeparator:a;q.data("ac-settings",S);return(y=Z)},"autoComplete.flush":function(W,X){if(!O){return d}if(!X){s=0}I={length:0,val:a,list:{}};return(y=W)},"autoComplete.button-ajax":function(X,W,Y){if(!O){return d}if(typeof W==="string"){Y=W;W={}}y=X;q.trigger("focus",[p]);I.val=Y||"button-ajax_"+p;return T(X,f.extend(d,{},S,{maxItems:-1,postData:W||{}}),I)},"autoComplete.button-supply":function(W,X,Y){if(!O){return d}if(typeof X==="string"){Y=X;X=a}y=W;q.trigger("focus",[p]);I.val=Y||"button-supply_"+p;X=f.isArray(X)&&X.length?X:S.dataSupply;return T(W,f.extend(d,{},S,{maxItems:-1,dataSupply:X,formatSupply:m}),I)},"autoComplete.direct-supply":function(W,X,Y){if(!O){return d}if(typeof X==="string"){Y=X;X=a}y=W;q.trigger("focus",[p]);I.val=Y||"direct-supply_"+p;X=f.isArray(X)&&X.length?X:S.dataSupply;return U(W,X,f.extend(d,{},S,{maxItems:-1,dataSupply:X,formatSupply:m}),I)},"autoComplete.search":function(W,X){if(!O){return d}I.val=X||"";return T(y=W,S,I)},"autoComplete.option":function(Y,W,Z){if(!O){return d}var X=j.call(arguments).length;y=Y;if(X===3){S[W]=Z;return Z}else{if(X===2){switch(W){case"ul":return C;case"cache":return I;case"xhr":return z;case"input":return q;default:return S[W]||a}}else{return S}}},"autoComplete.enable":function(W){q.data("ac-active",O=d);return(y=W)},"autoComplete.disable":function(W){q.data("ac-active",O=l);C.html("").hide(W);return(y=W)},"autoComplete.destroy":function(X){var Y=C.html("").hide(X).data("ac-inputs"),W;q.removeData("autoComplete").removeData("ac-input-index").removeData("ac-initial-settings").removeData("ac-settings").removeData("ac-active").unbind(".autoComplete autoComplete");n(q,J);O=l;Y[J]=a;y=X;for(W in Y){if(Y.hasOwnProperty(W)&&Y[W]===d){return y}}if(C.data("ac-selfmade")===d){C.remove()}else{C.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}return y}});function T(Y,X,W,aa,Z){if(X.spinner){X.spinner.call(K,Y,{active:d,settings:X,cache:W,ul:C})}if(P){P=clearTimeout(P)}if(X.delay>0&&Z===a){P=k.setTimeout(function(){T(Y,X,W,aa,d)},X.delay);return P}if(z){z.abort()}if(X.useCache&&W.list[W.val]){return U(Y,W.list[W.val],X,W,aa)}if(X.dataSupply.length){return R(Y,X,W,aa)}if(X.maxRequests&&++s>=X.maxRequests){C.html("").hide(Y);if(X.spinner){X.spinner.call(K,Y,{active:l,settings:X,cache:W,ul:C})}if(X.onMaxRequest&&s===X.maxRequests){return X.onMaxRequest.apply(K,X.backwardsCompatible?[W.val,C,Y,G,X,W]:[Y,{search:W.val,val:G,settings:X,cache:W,ul:C}])}return l}X.postData[X.postVar]=W.val;z=f.ajax({type:X.requestType,url:X.ajax,cache:X.ajaxCache,dataType:"json",data:X.postFormat?X.postFormat.call(K,Y,{data:X.postData,search:W.val,val:G,settings:X,cache:W,ul:C}):X.postData,success:function(ab){U(Y,ab,X,W,aa)},error:function(){C.html("").hide(Y);if(X.spinner){X.spinner.call(K,Y,{active:l,settings:X,cache:W,ul:C})}}});return z}function R(X,aa,W,Z){var ad=[],ae=[],af=f.isFunction(aa.dataFn),ag=af?a:new RegExp("^"+W.val,"i"),ab=0,ah,ac=-1,Y=aa.dataSupply.length;if(aa.formatSupply){ad=aa.formatSupply.call(K,X,{search:W.val,supply:aa.dataSupply,settings:aa,cache:W,ul:C})}else{for(;++ac<Y;){ah=aa.dataSupply[ac];ah=typeof ah==="object"&&ah.value?ah:{value:ah};ae=aa.backwardsCompatible?[W.val,ah.value,ad,ac,aa.dataSupply,C,X,aa,W]:[X,{search:W.val,entry:ah.value,list:ad,i:ac,supply:aa.dataSupply,settings:aa,cache:W,ul:C}];if((af&&aa.dataFn.apply(K,ae))||(!af&&ah.value.match(ag))){if(aa.maxItems>-1&&++ab>aa.maxItems){break}ad.push(ah)}}}return U(X,ad,aa,W,Z)}function M(W){if(Q){if(S.onSelect){S.onSelect.apply(K,S.backwardsCompatible?[v,D,C,W,S,I]:[W,{data:v,li:D,settings:S,cache:I,ul:C}])}L();G=q.val();if(y.type==="keydown"){y["enter_"+p]=d}C.hide(W)}return(D=a)}function B(X){if(D){D.removeClass(S.rollover)}C.show(X);D=H.eq(w).addClass(S.rollover);v=x[w];if(!D.length||!v){return l}L(v.value);if(S.onRollover){S.onRollover.apply(K,S.backwardsCompatible?[v,D,C,X,S,I]:[X,{data:v,li:D,settings:S,cache:I,ul:C}])}var W=w*r;if(W<F-V){F=W+V;C.scrollTop(W)}return D}function E(X){if(D){D.removeClass(S.rollover)}C.show(X);D=H.eq(w).addClass(S.rollover);v=x[w];if(!D.length||!v){return l}L(v.value);var W=(w+1)*r;if(W>F){C.scrollTop((F=W)-V)}if(S.onRollover){S.onRollover.apply(K,S.backwardsCompatible?[v,D,C,X,S,I]:[X,{data:v,li:D,settings:S,cache:I,ul:C}])}return D}function A(){var X=C.hide,W=C.show,Y=C.data("ac-inputs")||{};if(!C[p]){C.hide=function(Z,aa,ab){if(S.onHide&&Q){S.onHide.call(K,Z,{ul:C,settings:S,cache:I})}Q=l;return X.call(C,aa,ab)};C.show=function(Z,aa,ab){if(S.onShow&&!Q){S.onShow.call(K,Z,{ul:C,settings:S,cache:I})}Q=d;return W.call(C,aa,ab)};C[p]=d}if(C.data("autoComplete")!==d){C.data("autoComplete",d).delegate("li","mouseenter.autoComplete",function(Z){h.getFocus(d).trigger("autoComplete.ul-mouseenter",[Z,this])}).bind("click.autoComplete",function(Z){h.getFocus(d).trigger("autoComplete.ul-click",[Z]);return l})}Y[J]=d;return C.data("ac-inputs",Y)}function L(Y){var Z,W,X;if(Y===a||Y===""){Z=W=q.val().length}else{if(t){Y=G.substr(0,G.length-G.split(t).pop().length)+Y+t}Z=G.length;W=Y.length;q.val(Y)}if(!S.autoFill||Z>W){return l}else{if(K.createTextRange){X=K.createTextRange();if(Y===a){X.move("character",Z);X.select()}else{X.collapse(d);X.moveStart("character",Z);X.moveEnd("character",W);X.select()}}else{if(K.setSelectionRange){K.setSelectionRange(Z,W)}else{if(K.selectionStart){K.selectionStart=Z;K.selectionEnd=W}}}}return d}function U(X,ah,ac,W,ab){x=ac.onLoad?ac.onLoad.call(K,X,{list:ah,settings:ac,cache:W,ul:C}):ah;if(ac.spinner){ac.spinner.call(K,X,{active:l,settings:ac,cache:W,ul:C})}if(ac.useCache&&W.list[W.val]===a){W.length++;W.list[W.val]=ah;if(W.length>ac.cacheLimit){W.list={};W.length=0}}if(!x||x.length<1){return C.html("").hide(X)}w=-1;var af=q.offset(),Y=[],Z=0,ad=0,ag=-1,ae=l,aa=x.length;if(ac.onListFormat){ac.onListFormat.call(K,X,{list:x,settings:ac,cache:W,ul:C})}else{for(;++ag<aa;){if(x[ag].value){if(ac.maxItems>-1&&++Z>ac.maxItems){break}Y.push(ac.striped&&ae?'<li class="'+ac.striped+'">':"<li>",x[ag].display||x[ag].value,"</li>");ae=!ae}}C.html(Y.join(""))}H=C.children("li");if(ac.autoFill&&!ab){w=0;v=x[0];L(v.value);D=H.eq(0).addClass(ac.rollover)}C.data("ac-input-index",J).scrollTop(0).css({top:af.top+q.outerHeight(),left:af.left,width:ac.width});r=H.eq(0).outerHeight();if(ac.maxHeight){C.css({height:r*H.length>ac.maxHeight?ac.maxHeight:"auto",overflow:"auto"})}V=C.outerHeight();F=V;N=r===0?0:Math.floor(F/r);y.timeStamp=(new Date()).getTime();return C.show(X)}A();S.requestType=S.requestType.toUpperCase();t=S.multiple?S.multipleSeparator:a;h.stack[J]=K;h.jqStack[J]=q;b(q,J)}})(jQuery,window||this);