/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */ 
(function(j,S,i){function O(e,n){if(O.flag!==g){O.flag=g;X.bind("click.autoComplete",function(u){h.getFocus(g).trigger("autoComplete.document-click",[u])})}e=e.closest("form");var m=e.data("ac-inputs")||{},G;m[n]=g;e.data("ac-inputs",m);e.data("autoComplete")!==g&&e.data("autoComplete",g).bind("submit.autoComplete",function(u){return(G=h.getFocus(g)).length?G.triggerHandler("autoComplete.form-submit",[u,this]):g})}function ha(e,n){h.remove(n);if(O.flag===g&&h.length===0){O.flag=o;X.unbind("click.autoComplete")}e=
e.closest("form");var m=e.data("ac-inputs")||{},G;m[n]=o;for(G in m)if(m[G]===g)return;e.unbind("submit.autoComplete")}function ba(e,n){if(!n.supply||!j.isArray(n.supply))return[];e=-1;for(var m=n.supply.length,G=[],u;++e<m;){u=(u=n.supply[e])&&u.value?u:{value:u};G.push(u)}return G}function ca(){return this}j.fn.autoComplete=function(){var e=da.call(arguments),n=this,m=e.shift(),G=m===g,u=typeof m=="string",P=m&&m.preventDefault!==i,Q;if(u||P){e=h.arrayMethods[m]===g&&j.isArray(e[0])&&j.isArray(e[0][0])||
e.length===1&&j.isArray(e[0])?e[0]:e;Q=u&&(h.handlerMethods[m]===-1||e.length<(h.handlerMethods[m]||0))?"triggerHandler":"trigger"}return n.length<1?G?i:n:u?n[Q]("autoComplete."+m,e):P?n.trigger(m,e):G?j.autoComplete(n[0],e.shift()):j.each(n,function(Y,L){j.data(L,"autoComplete")!==g&&j.autoComplete(L,m)})};var g=true,o=false,da=Array.prototype.slice,ea=S.document,X=j(ea),fa=j(),ia=Object.prototype.toString.call(S.opera)==="[object Opera]"||/macintosh/i.test(S.navigator.userAgent)&&j.browser.mozilla?
"keypress.autoComplete":"keydown.autoComplete",x="autoComplete_"+j.expando,C={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},ja=Date.now||function(){return(new Date).getTime()},h={version:"[VERSION]",expando:x,_autoComplete:j.autoComplete,counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:o,keys:C,arrayMethods:{"button-supply":g,"direct-supply":g},handlerMethods:{option:2},focus:i,blur:i,getFocus:function(e){return!h.order[0]?e?fa:i:e?h.jqStack[h.order[0]]:
h.stack[h.order[0]]},getPrevious:function(e){for(var n=0,m=h.order.length;++n<m;)if(h.order[n])return e?h.jqStack[h.order[n]]:h.stack[h.order[n]];return e?fa:i},remove:function(e){for(var n=-1,m=h.order.length;++n<m;)if(h.order[n]===e)h.order[n]=i;h.length--;delete h.stack[e]},getAll:function(){for(var e=-1,n=h.counter,m=[];++e<n;)h.stack[e]&&m.push(h.stack[e]);return j(m)},defaults:{ajax:"ajax.php",ajaxCache:j.ajaxSettings.cache,dataSupply:[],dataFn:i,formatSupply:i,list:"auto-complete-list",rollover:"auto-complete-list-rollover",
width:i,striped:i,maxHeight:i,bgiframe:i,newList:o,template:i,templateStripe:"striped",pattern:/(^|.|\r|\n)(#\{(.*?)\})/,postVar:"value",postData:{},postFormat:i,minChars:1,maxItems:-1,maxRequests:0,maxRequestsDeep:o,requestType:"POST",onChange:i,autoFill:o,nonInput:[C.shift,C.left,C.right],multiple:o,multipleSeparator:" ",onBlur:i,onFocus:i,onHide:i,onLoad:i,onMaxRequest:i,onRollover:i,onSelect:i,onShow:i,onListFormat:i,onSubmit:i,spinner:i,preventEnterSubmit:g,delay:0,useCache:g,forceFormat:o,cacheLimit:50}};
j.autoComplete=function(e,n){function m(b,a,d,k,v){if(a.maxRequestsDeep===g&&T>=a.maxRequests)return o;a.spinner&&a.spinner.call(e,b,{active:g,settings:a,cache:d,ul:f});if(U)U=clearTimeout(U);if(a.delay>0&&v===i)return U=S.setTimeout(function(){m(b,a,d,k,g)},a.delay);V&&V.abort();if(a.useCache&&d.list[d.val]&&d.list[d.val].built!=="")return W(b,d.list[d.val].src,a,d,k);if(a.dataSupply.length)return G(b,a,d,k);if(a.maxRequests&&++T>=a.maxRequests){f.html("").hide(b);a.spinner&&a.spinner.call(e,b,{active:o,
settings:a,cache:d,ul:f});if(a.onMaxRequest&&T===a.maxRequests)return a.onMaxRequest.call(e,b,{search:d.val,val:y,settings:a,cache:d,ul:f});return o}a.postData[a.postVar]=d.val;return V=j.ajax({type:a.requestType,url:a.ajax,cache:a.ajaxCache,dataType:"json",data:a.postFormat?a.postFormat.call(e,b,{data:a.postData,search:d.val,val:y,settings:a,cache:d,ul:f}):a.postData,success:function(z){W(b,z,a,d,k)},error:function(){f.html("").hide(b);a.spinner&&a.spinner.call(e,b,{active:o,settings:a,cache:d,ul:f})}})}
function G(b,a,d,k){var v=[];if(a.formatSupply)v=a.formatSupply.call(e,b,{search:d.val,supply:a.dataSupply,settings:a,cache:d,ul:f});else for(var z=0,D=-1,A=a.dataSupply.length,H,J,Z=j.isFunction(a.dataFn),ka=Z?i:new RegExp("^"+d.val,"i");++D<A;){J=(J=a.dataSupply[D])&&typeof J.value=="string"?J:{value:J};H={search:d.val,entry:J.value,list:v,i:D,supply:a.dataSupply,settings:a,cache:d,ul:f};if(Z&&a.dataFn.call(e,b,H)||!Z&&J.value.match(ka)){if(a.maxItems>-1&&++z>a.maxItems)break;v.push(J)}}return W(b,
v,a,d,k)}function u(b){if(w){c.onSelect&&c.onSelect.call(e,b,{data:B,li:q,settings:c,cache:l,ul:f});L();y=s.val();if(p.type==="keydown")p["enter_"+x]=g;f.hide(b)}q=i}function P(b){q&&q.removeClass(c.rollover);f.show(b);q=I.eq(r).addClass(c.rollover);B=E[r];if(!q.length||!B)return o;L(B.value);c.onRollover&&c.onRollover.call(e,b,{data:B,li:q,settings:c,cache:l,ul:f});b=r*N;if(b<M-R){M=b+R;f.scrollTop(b)}}function Q(b){q&&q.removeClass(c.rollover);f.show(b);q=I.eq(r).addClass(c.rollover);B=E[r];if(!q.length||
!B)return o;L(B.value);var a=(r+1)*N;if(a>M)f.scrollTop((M=a)-R);c.onRollover&&c.onRollover.call(e,b,{data:B,li:q,settings:c,cache:l,ul:f})}function Y(){if(!c.newList&&!f)f=c.list.jquery?c.list:c.list.nodeName?j(c.list):typeof c.list=="string"&&(ga=X.find("ul."+c.list).eq(0)).length?$.call(ga,c.bgiframe):i;f||(f=$.call(j("<ul/>").appendTo(ea.body).addClass(c.list).hide().data("ac-selfmade",g),c.bgiframe));var b=f.hide,a=f.show,d=f.data("ac-inputs")||{};if(!f[x]){f.hide=function(k,v,z){c.onHide&&w&&
c.onHide.call(e,k,{ul:f,settings:c,cache:l});w=o;return b.call(f,v,z)};f.show=function(k,v,z){c.onShow&&!w&&c.onShow.call(e,k,{ul:f,settings:c,cache:l});w=g;return a.call(f,v,z)};f[x]=g}f.data("autoComplete")!==g&&f.data("autoComplete",g).delegate("li","mouseenter.autoComplete",function(k){h.getFocus(g).trigger("autoComplete.ul-mouseenter",[k,this])}).bind("click.autoComplete",function(k){h.getFocus(g).trigger("autoComplete.ul-click",[k]);return o});d[F]=g;f.data("ac-inputs",d);return f}function L(b){var a,
d,k;if(b===i||b==="")a=d=s.val().length;else{if(K)b=y.substr(0,y.length-y.split(K).pop().length)+b+K;a=y.length;d=b.length;s.val(b)}if(!c.autoFill||a>d)return o;else if(e.createTextRange){k=e.createTextRange();if(b===i)k.move("character",a);else{k.collapse(g);k.moveStart("character",a);k.moveEnd("character",d)}k.select()}else if(e.setSelectionRange)e.setSelectionRange(a,d);else if(e.selectionStart){e.selectionStart=a;e.selectionEnd=d}}function la(){for(var b=-1,a=E.length,d=[],k=o,v,z,D,A,H;++b<a;){z=
E[b];D=c.template;v=0;if(c.striped)z[c.templateStripe]=k?c.striped:"";for(;A=c.pattern.exec(D.substr(v));)if(A[1]==="\\"){v=D.indexOf(A[0])+A[0].length;D=D.replace(A[0],A[0].substr(1))}else{H=A[3];v=D.indexOf(A[0])+(z[H]?z[H].length:0);D=D.replace(A[2],z[H]||"")}k=!k;d.push(D)}f.html(l.list[l.val].built=d.join(""))}function W(b,a,d,k,v){E=d.onLoad?d.onLoad.call(e,b,{list:a,settings:d,cache:k,ul:f}):a;d.spinner&&d.spinner.call(e,b,{active:o,settings:d,cache:k,ul:f});if(d.useCache&&(!k.list[k.val]||
!j.isArray(k.list[k.val].src))){k.length++;k.list[k.val]={src:E,built:""};if(d.cacheLimit!==-1&&k.length>d.cacheLimit){k.list={};k.length=0}}if(!E||E.length<1)return f.html("").hide(b);r=-1;q=i;a=s.offset();var z=[],D=0,A=-1,H=o,J=E.length;if(d.onListFormat)d.onListFormat.call(e,b,{list:E,settings:d,cache:k,ul:f});else if(k.list[k.val].built!==""&&!d.forceFormat)f.html(k.list[k.val].built);else if(d.template)la();else{for(;++A<J;)if(E[A].value){if(d.maxItems>-1&&++D>d.maxItems)break;z.push(d.striped&&
H?'<li class="'+d.striped+'">':"<li>",E[A].display||E[A].value,"</li>");H=!H}f.html(k.list[k.val].built=z.join(""))}I=f.data("ac-input-index",F).children("li");if(d.autoFill&&!v){r=0;B=E[0];L(B.value);q=I.eq(0).addClass(d.rollover)}f.scrollTop(0).css({top:a.top+s.outerHeight(),left:a.left,width:d.width}).show(b);N=I.eq(0).outerHeight();if(d.maxHeight)f.css({height:N*I.length>d.maxHeight?d.maxHeight:"auto",overflow:"auto"});M=R=f.outerHeight();aa=N===0?0:Math.floor(M/N);p.timeStamp=ja()}function ma(){var b=
this;j.each({"button-ajax":"buttonAjax","button-supply":"buttonSupply","direct-supply":"directSupply",destroy:"destroy",disable:"disable",enable:"enable",flush:"flush",search:"search"},function(a,d){b[d]=function(){s.trigger("autoComplete."+a,arguments);return b}});b.settings=c;b.cache=l}h.length++;h.counter++;var s=j(e).attr("autocomplete","off"),f,ga,t={},p={},y="",E=[],I={length:0},q,M,R,N,aa,w=o,U,V,r=-1,B,K,F=h.counter,T=0,$=j.fn.bgiframe||j.fn.bgIframe||ca,l={length:0,val:i,list:{}},c=j.extend({width:s.outerWidth()},
h.defaults,n||{},j.metadata?s.metadata():{});j.data(e,"autoComplete",t={index:F,hasFocus:o,active:g,cache:l,settings:c,initialSettings:j.extend(g,{},c)});e.attachEvent&&s.bind("keypress.autoComplete",function(b){if(!t.active)return g;if(b.keyCode===C.enter){var a=g;if(q&&q.hasClass(c.rollover)){a=c.preventEnterSubmit&&w?o:g;u(b)}else w&&f.hide(b);return a}});s.bind(ia,function(b){if(!t.active)return g;var a=(p=b).keyCode,d=o;if(a===C.tab&&w)u(b);else if(a===C.enter){d=g;if(q&&q.hasClass(c.rollover)){d=
c.preventEnterSubmit&&w?o:g;u(b)}else w&&f.hide(b)}else if(a===C.up&&w)if(r>0){r--;P(b)}else{r=-1;q=i;s.val(y);f.hide(b)}else if(a===C.down&&w){if(r<I.length-1){r++;Q(b)}}else if(a===C.pageup&&w){if(r>0){r-=aa;if(r<0)r=0;P(b)}}else if(a===C.pagedown&&w){if(r<I.length-1){r+=aa;if(r>I.length-1)r=I.length-1;Q(b)}}else if(c.nonInput&&j.inArray(a,c.nonInput)>-1){f.html("").hide(b);d=g}else return g;p["keydown_"+x]=g;return d}).bind({"keyup.autoComplete":function(b){if(!t.active||p["keydown_"+x])return g;
y=s.val();var a=(p=b).keyCode,d=K?y.split(K).pop():y;if(a!=C.enter){l.val=c.onChange===i?d:c.onChange.call(e,b,{val:d,key:a,settings:c,cache:l,ul:f});if(l.val.length>=c.minChars)m(b,c,l,a===C.backspace||a===C.space);else a==C.backspace&&f.html("").hide(b)}},"blur.autoComplete":function(b){if(!t.active||w)return g;h.order[0]!==i&&h.order.unshift(i);h.hasFocus=o;t.hasFocus=o;r=-1;q=i;f.hide(p=b);h.blur&&h.blur.call(e,b,{settings:c,cache:l,ul:f});c.onBlur&&c.onBlur.call(e,b,{val:y,settings:c,cache:l,
ul:f})},"focus.autoComplete":function(b,a){if(!t.active||t.hasFocus&&a===x||p["enter_"+x])return g;F!==f.data("ac-input-index")&&f.html("").hide(b);if(h.order[0]===i)if(h.order[1]===F)h.order.shift();else h.order[0]=F;else h.order[0]!=F&&h.order[1]!=F&&h.order.unshift(F);h.defaults.cacheLimit!==-1&&h.order.length>h.defaults.cacheLimit&&h.order.pop();h.hasFocus=g;t.hasFocus=g;p=b;h.focus&&h.focus.call(e,b,{settings:c,cache:l,ul:f});c.onFocus&&c.onFocus.call(e,b,{settings:c,cache:l,ul:f})},"autoComplete.document-click":function(b,
a){if(t.active&&w&&(!p||a.timeStamp-p.timeStamp>200)&&j(a.target).closest("ul").data("ac-input-index")!==F){f.hide(p=a);s.trigger("blur")}},"autoComplete.form-submit":function(b,a,d){if(!t.active)return g;p=a;return c.preventEnterSubmit&&(w||p["enter_"+x])?o:c.onSubmit===i?g:c.onSubmit.call(e,a,{form:d,settings:c,cache:l,ul:f})},"autoComplete.ul-mouseenter":function(b,a,d){q&&q.removeClass(c.rollover);q=j(d).addClass(c.rollover);r=I.index(d);B=E[r];M=f.scrollTop()+R;p=a;c.onRollover&&c.onRollover.call(e,
a,{data:B,li:q,settings:c,cache:l,ul:f})},"autoComplete.ul-click":function(b,a){s.trigger("focus",[x]);s.val(y===K?y.substr(0,y.length-y.split(K).pop().length)+B.value+K:B.value);f.hide(p=a);L();c.onSelect&&c.onSelect.call(e,a,{data:B,li:q,settings:c,cache:l,ul:f})},"autoComplete.settings":function(b,a){if(!t.active)return g;p=b;if(j.isFunction(a)){if((b=a.call(e,b,{settings:c,cache:l,ul:f}))&&j.isArray(b)&&b[0]!==i){j.extend(g,c,b[0]||c);j.extend(g,l,b[1]||l)}}else j.extend(g,c,a||{});$=j.fn.bgiframe||
j.fn.bgIframe||ca;f=Y();c.requestType=c.requestType.toUpperCase();if(c.inputControl!==i&&c.onChange===i)c.onChange=c.inputControl;K=c.multiple?c.multipleSeparator:i;t.settings=c},"autoComplete.flush":function(b,a){if(!t.active)return g;a||(T=0);l={length:0,val:i,list:{}};p=b},"autoComplete.button-ajax":function(b,a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a={}}p=b;s.trigger("focus",[x]);l.val=d||"button-ajax_"+x;return m(b,j.extend(g,{},c,{maxItems:-1,postData:a||{}}),l)},"autoComplete.button-supply":function(b,
a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a=i}p=b;s.trigger("focus",[x]);l.val=d||"button-supply_"+x;a=j.isArray(a)?a:c.dataSupply;return m(b,j.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSupply:ba}),l)},"autoComplete.direct-supply":function(b,a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a=i}p=b;s.trigger("focus",[x]);l.val=d||"direct-supply_"+x;a=j.isArray(a)&&a.length?a:c.dataSupply;return W(b,a,j.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSupply:ba}),l)},"autoComplete.search":function(b,
a){if(!t.active)return g;l.val=a||"";return m(p=b,c,l)},"autoComplete.option":function(b,a,d){if(!t.active)return g;p=b;switch(da.call(arguments).length){case 3:return c[a]=d;case 2:return a==="ul"?f:a==="cache"?l:a==="xhr"?V:a==="input"?s:c[a]||i;default:return c}},"autoComplete.enable":function(b){t.active=g;p=b},"autoComplete.disable":function(b){t.active=o;f.html("").hide(p=b)},"autoComplete.destroy":function(b){b=f.html("").hide(p=b).data("ac-inputs")||{};var a;s.removeData("autoComplete").unbind(".autoComplete autoComplete");
ha(s,F);b[F]=i;for(a in b)if(b[a]===g)return p;f.data("ac-selfmade")===g?f.remove():f.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}});f=Y();c.requestType=c.requestType.toUpperCase();if(c.inputControl!==i&&c.onChange===i)c.onChange=c.inputControl;K=c.multiple?c.multipleSeparator:i;h.stack[F]=e;h.jqStack[F]=s;O(s,F);return t.instance=new ma};h=j.extend(j.autoComplete,h)})(jQuery,this);
