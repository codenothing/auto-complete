/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */ 
(function(q,j,a){q.fn.autoComplete=function(){var s=h.call(arguments),r=this,w=s.shift(),v=typeof w==="string",u,t;s=(f.arrayMethods[w]===c&&q.isArray(s[0])&&q.isArray(s[0][0]))||(s.length===1&&q.isArray(s[0]))?s[0]:s;u=v&&(f.handlerMethods[w]===-1||s.length<(f.handlerMethods[w]||0))?"triggerHandler":"trigger";return v?r[u]("autoComplete."+w,s):w&&w.preventDefault!==a?r.trigger(w,s):q.each(r,function(){if(q.data(t=this,"autoComplete")!==c){q.autoComplete(t,w)}})};function b(v,t){if(b.flag!==c){b.flag=c;m.bind("click.autoComplete",function(w){f.getFocus(c).trigger("autoComplete.document-click",[w])})}var r=v.closest("form"),u,s;if(r.length<1){return r}u=q.data(r[0],"ac-inputs")||{};u[t]=c;q.data(r[0],"ac-inputs",u);if(q.data(r[0],"autoComplete")!==c){q.data(r[0],"autoComplete",c);r.bind("submit.autoComplete",function(w){return(s=f.getFocus(c)).length?s.triggerHandler("autoComplete.form-submit",[w,this]):c})}}function l(v,t){f.remove(t);if(b.flag===c&&f.length===0){b.flag=i;m.unbind("click.autoComplete")}var r=v.closest("form"),u,s;if(r.length<1){return}u=r.data("ac-inputs")||{};u[t]=i;for(s in u){if(u.hasOwnProperty(s)&&u[s]===c){return}}r.unbind("submit.autoComplete")}function k(v,w){if(!q.isArray(w.supply)){return[]}for(var t=-1,r=w.supply.length,s=[],u;++t<r;){u=w.supply[t];u=u&&u.value?u:{value:u};s.push(u)}return s}function d(){return this}var c=true,i=false,h=Array.prototype.slice,m=q(j.document),g=q(),o=j.opera||(/macintosh/i.test(j.navigator.userAgent)&&q.browser.mozilla)?"keypress.autoComplete":"keydown.autoComplete",p="autoComplete_"+q.expando,e={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},n=q.autoComplete,f={version:"[VERSION]",expando:p,counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:i,keys:e,arrayMethods:{"button-supply":c,"direct-supply":c},handlerMethods:{option:2},focus:a,blur:a,getFocus:function(r){return !f.order[0]?r?g:a:r?f.jqStack[f.order[0]]:f.stack[f.order[0]]},getPrevious:function(t){for(var s=0,r=f.order.length;++s<r;){if(f.order[s]){return t?f.jqStack[f.order[s]]:f.stack[f.order[s]]}}return t?g:a},remove:function(t){for(var s=-1,r=f.order.length;++s<r;){if(f.order[s]===t){f.order[s]=a}}f.length--;delete f.stack[t]},getAll:function(){for(var t=-1,s=f.counter,r=[];++t<s;){if(f.stack[t]){r.push(f.stack[t])}}return q(r)},defaults:{ajax:"ajax.php",ajaxCache:q.ajaxSettings.cache,dataSupply:[],dataFn:a,formatSupply:a,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:a,striped:a,maxHeight:a,bgiframe:a,newList:i,postVar:"value",postData:{},postFormat:a,minChars:1,maxItems:-1,maxRequests:0,maxRequestsDeep:i,requestType:"POST",onChange:a,autoFill:i,nonInput:[e.shift,e.left,e.right],multiple:i,multipleSeparator:" ",onBlur:a,onFocus:a,onHide:a,onLoad:a,onMaxRequest:a,onRollover:a,onSelect:a,onShow:a,onListFormat:a,onSubmit:a,spinner:a,preventEnterSubmit:c,delay:0,useCache:c,cacheLimit:50}};q.autoComplete=function(L,v){f.length++;f.counter++;var r=q(L).attr("autocomplete","off"),X,U={},z={},H="",y=[],I={length:0},E,G,Y,s,O,R=i,Q,A,x=-1,w,u,K=f.counter,t=0,P=q.fn.bgiframe||q.fn.bgIframe||d,J={length:0,val:a,list:{}},T=q.extend({width:r.outerWidth()},f.defaults,v||{},q.metadata?r.metadata():{}),D=!T.newList&&(X=m.find("ul."+T.list).eq(0)).length?P.call(X,T.bgiframe):P.call(q("<ul/>").appendTo("body").addClass(T.list).hide().data("ac-selfmade",c),T.bgiframe);q.data(L,"autoComplete",U={index:K,hasFocus:i,active:c,settings:T,initialSettings:q.extend(c,{},T)});if(j.attachEvent){r.bind("keypress.autoComplete",function(Z){if(!U.active){return c}if(Z.keyCode===e.enter){var aa=c;if(E&&E.hasClass(T.rollover)){aa=T.preventEnterSubmit&&R?i:c;N(Z)}else{if(R){D.hide(Z)}}return aa}})}r.bind(o,function(aa){if(!U.active){return c}var Z=(z=aa).keyCode,ab=i;if(Z===e.tab&&R){N(aa)}else{if(Z===e.enter){ab=c;if(E&&E.hasClass(T.rollover)){ab=T.preventEnterSubmit&&R?i:c;N(aa)}else{if(R){D.hide(aa)}}}else{if(Z===e.up&&R){if(x>0){x--;C(aa)}else{x=-1;r.val(H);D.hide(aa)}}else{if(Z===e.down&&R){if(x<I.length-1){x++;F(aa)}}else{if(Z===e.pageup&&R){if(x>0){x-=O;if(x<0){x=0}C(aa)}}else{if(Z===e.pagedown&&R){if(x<I.length-1){x+=O;if(x>I.length-1){x=I.length-1}F(aa)}}else{if(T.nonInput&&q.inArray(Z,T.nonInput)>-1){D.html("").hide(aa);ab=c}else{return c}}}}}}}z["keydown_"+p]=c;return ab}).bind({"keyup.autoComplete":function(aa){if(!U.active||z["keydown_"+p]){return c}H=r.val();var Z=(z=aa).keyCode,ab=u?H.split(u).pop():H;if(Z!=e.enter){J.val=T.onChange===a?ab:T.onChange.call(L,aa,{val:ab,key:Z,settings:T,cache:J,ul:D});if(J.val.length>=T.minChars){V(aa,T,J,(Z===e.backspace||Z===e.space))}else{if(Z==e.backspace){D.html("").hide(aa)}}}},"blur.autoComplete":function(Z){if(!U.active||R){return c}if(f.order[0]!==a){f.order.unshift(a)}f.hasFocus=i;U.hasFocus=i;x=-1;D.hide(z=Z);if(f.blur){f.blur.call(L,Z,{settings:T,cache:J,ul:D})}if(T.onBlur){T.onBlur.call(L,Z,{val:H,settings:T,cache:J,ul:D})}},"focus.autoComplete":function(aa,Z){if(!U.active||(U.hasFocus&&Z===p)||z["enter_"+p]){return c}if(K!==q.data(D[0],"ac-input-index")){D.html("").hide(aa)}if(f.order[0]===a){if(f.order[1]===K){f.order.shift()}else{f.order[0]=K}}else{if(f.order[0]!=K&&f.order[1]!=K){f.order.unshift(K)}}if(f.defaults.cacheLimit!==-1&&f.order.length>f.defaults.cacheLimit){f.order.pop()}f.hasFocus=c;U.hasFocus=c;z=aa;if(f.focus){f.focus.call(L,aa,{settings:T,cache:J,ul:D})}if(T.onFocus){T.onFocus.call(L,aa,{settings:T,cache:J,ul:D})}},"autoComplete.document-click":function(aa,Z){if(U.active&&R&&(!z||Z.timeStamp-z.timeStamp>200)&&q.data(q(Z.target).closest("ul")[0],"ac-input-index")!==K){D.hide(z=Z);r.blur()}},"autoComplete.form-submit":function(ab,aa,Z){if(!U.active){return c}z=aa;return T.preventEnterSubmit&&(R||z["enter_"+p])?i:T.onSubmit===a?c:T.onSubmit.call(L,aa,{form:Z,settings:T,cache:J,ul:D})},"autoComplete.ul-mouseenter":function(ab,aa,Z){if(E){E.removeClass(T.rollover)}E=q(Z).addClass(T.rollover);x=I.index(Z);w=y[x];G=D.scrollTop()+Y;z=aa;if(T.onRollover){T.onRollover.call(L,aa,{data:w,li:E,settings:T,cache:J,ul:D})}},"autoComplete.ul-click":function(aa,Z){r.trigger("focus",[p]);r.val(H===u?H.substr(0,H.length-H.split(u).pop().length)+w.value+u:w.value);D.hide(z=Z);M();if(T.onSelect){T.onSelect.call(L,Z,{data:w,li:E,settings:T,cache:J,ul:D})}},"autoComplete.settings":function(ac,Z){if(!U.active){return c}var aa,ab;z=ac;if(q.isFunction(Z)){aa=Z.call(L,ac,{settings:T,cache:J,ul:D});if(q.isArray(aa)&&aa[0]!==a){q.extend(c,T,aa[0]||T);q.extend(c,J,aa[1]||J)}}else{q.extend(c,T,Z||{})}P=q.fn.bgiframe||q.fn.bgIframe||d;D=!T.newList&&D.hasClass(T.list)?D:!T.newList&&(ab=m.find("ul."+T.list).eq(0)).length?P.call(ab,T.bgiframe):P.call(q("<ul/>").appendTo("body").addClass(T.list).hide().data("ac-selfmade",c),T.bgiframe);B();T.requestType=T.requestType.toUpperCase();if(T.inputControl!==a){T.onChange=T.inputControl}u=T.multiple?T.multipleSeparator:a;U.settings=T},"autoComplete.flush":function(Z,aa){if(!U.active){return c}if(!aa){t=0}J={length:0,val:a,list:{}};z=Z},"autoComplete.button-ajax":function(aa,Z,ab){if(!U.active){return c}if(typeof Z==="string"){ab=Z;Z={}}z=aa;r.trigger("focus",[p]);J.val=ab||"button-ajax_"+p;return V(aa,q.extend(c,{},T,{maxItems:-1,postData:Z||{}}),J)},"autoComplete.button-supply":function(Z,aa,ab){if(!U.active){return c}if(typeof aa==="string"){ab=aa;aa=a}z=Z;r.trigger("focus",[p]);J.val=ab||"button-supply_"+p;aa=q.isArray(aa)?aa:T.dataSupply;return V(Z,q.extend(c,{},T,{maxItems:-1,dataSupply:aa,formatSupply:k}),J)},"autoComplete.direct-supply":function(Z,aa,ab){if(!U.active){return c}if(typeof aa==="string"){ab=aa;aa=a}z=Z;r.trigger("focus",[p]);J.val=ab||"direct-supply_"+p;aa=q.isArray(aa)&&aa.length?aa:T.dataSupply;return W(Z,aa,q.extend(c,{},T,{maxItems:-1,dataSupply:aa,formatSupply:k}),J)},"autoComplete.search":function(Z,aa){if(!U.active){return c}J.val=aa||"";return V(z=Z,T,J)},"autoComplete.option":function(aa,Z,ab){if(!U.active){return c}z=aa;switch(h.call(arguments).length){case 3:T[Z]=ab;return ab;case 2:return Z==="ul"?D:Z==="cache"?J:Z==="xhr"?A:Z==="input"?r:T[Z]||a;default:return T}},"autoComplete.enable":function(Z){U.active=c;z=Z},"autoComplete.disable":function(Z){U.active=i;D.html("").hide(z=Z)},"autoComplete.destroy":function(aa){var ab=q.data(D.html("").hide(z=aa)[0],"ac-inputs")||{},Z;r.removeData("autoComplete").unbind(".autoComplete autoComplete");l(r,K);ab[K]=a;for(Z in ab){if(ab.hasOwnProperty(Z)&&ab[Z]===c){return z}}if(q.data(D[0],"ac-selfmade")===c){D.remove()}else{D.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}}});function V(ab,aa,Z,ad,ac){if(aa.maxRequestsDeep===c&&t>=aa.maxRequests){return i}if(aa.spinner){aa.spinner.call(L,ab,{active:c,settings:aa,cache:Z,ul:D})}if(Q){Q=clearTimeout(Q)}if(aa.delay>0&&ac===a){Q=j.setTimeout(function(){V(ab,aa,Z,ad,c)},aa.delay);return Q}if(A){A.abort()}if(aa.useCache&&q.isArray(Z.list[Z.val])){return W(ab,Z.list[Z.val],aa,Z,ad)}if(aa.dataSupply.length){return S(ab,aa,Z,ad)}if(aa.maxRequests&&++t>=aa.maxRequests){D.html("").hide(ab);if(aa.spinner){aa.spinner.call(L,ab,{active:i,settings:aa,cache:Z,ul:D})}if(aa.onMaxRequest&&t===aa.maxRequests){return aa.onMaxRequest.call(L,ab,{search:Z.val,val:H,settings:aa,cache:Z,ul:D})}return i}aa.postData[aa.postVar]=Z.val;A=q.ajax({type:aa.requestType,url:aa.ajax,cache:aa.ajaxCache,dataType:"json",data:aa.postFormat?aa.postFormat.call(L,ab,{data:aa.postData,search:Z.val,val:H,settings:aa,cache:Z,ul:D}):aa.postData,success:function(ae){W(ab,ae,aa,Z,ad)},error:function(){D.html("").hide(ab);if(aa.spinner){aa.spinner.call(L,ab,{active:i,settings:aa,cache:Z,ul:D})}}});return A}function S(aa,ad,Z,ac){var af=[],ah={},ai=q.isFunction(ad.dataFn),aj=ai?a:new RegExp("^"+Z.val,"i"),ag=0,ak,ae=-1,ab=ad.dataSupply.length;if(ad.formatSupply){af=ad.formatSupply.call(L,aa,{search:Z.val,supply:ad.dataSupply,settings:ad,cache:Z,ul:D})}else{for(;++ae<ab;){ak=ad.dataSupply[ae];ak=ak&&typeof ak.value==="string"?ak:{value:ak};ah={search:Z.val,entry:ak.value,list:af,i:ae,supply:ad.dataSupply,settings:ad,cache:Z,ul:D};if((ai&&ad.dataFn.call(L,aa,ah))||(!ai&&ak.value.match(aj))){if(ad.maxItems>-1&&++ag>ad.maxItems){break}af.push(ak)}}}return W(aa,af,ad,Z,ac)}function N(Z){if(R){if(T.onSelect){T.onSelect.call(L,Z,{data:w,li:E,settings:T,cache:J,ul:D})}M();H=r.val();if(z.type==="keydown"){z["enter_"+p]=c}D.hide(Z)}E=a}function C(aa){if(E){E.removeClass(T.rollover)}D.show(aa);E=I.eq(x).addClass(T.rollover);w=y[x];if(!E.length||!w){return i}M(w.value);if(T.onRollover){T.onRollover.call(L,aa,{data:w,li:E,settings:T,cache:J,ul:D})}var Z=x*s;if(Z<G-Y){G=Z+Y;D.scrollTop(Z)}}function F(aa){if(E){E.removeClass(T.rollover)}D.show(aa);E=I.eq(x).addClass(T.rollover);w=y[x];if(!E.length||!w){return i}M(w.value);var Z=(x+1)*s;if(Z>G){D.scrollTop((G=Z)-Y)}if(T.onRollover){T.onRollover.call(L,aa,{data:w,li:E,settings:T,cache:J,ul:D})}}function B(){var aa=D.hide,Z=D.show,ab=q.data(D[0],"ac-inputs")||{};if(!D[p]){D.hide=function(ac,ad,ae){if(T.onHide&&R){T.onHide.call(L,ac,{ul:D,settings:T,cache:J})}R=i;return aa.call(D,ad,ae)};D.show=function(ac,ad,ae){if(T.onShow&&!R){T.onShow.call(L,ac,{ul:D,settings:T,cache:J})}R=c;return Z.call(D,ad,ae)};D[p]=c}if(q.data(D[0],"autoComplete")!==c){q.data(D[0],"autoComplete",c);D.delegate("li","mouseenter.autoComplete",function(ac){f.getFocus(c).trigger("autoComplete.ul-mouseenter",[ac,this])}).bind("click.autoComplete",function(ac){f.getFocus(c).trigger("autoComplete.ul-click",[ac]);return i})}ab[K]=c;q.data(D[0],"ac-inputs",ab)}function M(ab){var ac,Z,aa;if(ab===a||ab===""){ac=Z=r.val().length}else{if(u){ab=H.substr(0,H.length-H.split(u).pop().length)+ab+u}ac=H.length;Z=ab.length;r.val(ab)}if(!T.autoFill||ac>Z){return i}else{if(L.createTextRange){aa=L.createTextRange();if(ab===a){aa.move("character",ac);aa.select()}else{aa.collapse(c);aa.moveStart("character",ac);aa.moveEnd("character",Z);aa.select()}}else{if(L.setSelectionRange){L.setSelectionRange(ac,Z)}else{if(L.selectionStart){L.selectionStart=ac;L.selectionEnd=Z}}}}}function W(aa,ah,ae,Z,ad){y=ae.onLoad?ae.onLoad.call(L,aa,{list:ah,settings:ae,cache:Z,ul:D}):ah;if(ae.spinner){ae.spinner.call(L,aa,{active:i,settings:ae,cache:Z,ul:D})}if(ae.useCache&&!q.isArray(Z.list[Z.val])){Z.length++;Z.list[Z.val]=ah;if(ae.cacheLimit!==-1&&Z.length>ae.cacheLimit){Z.list={};Z.length=0}}if(!y||y.length<1){return D.html("").hide(aa)}x=-1;var af=r.offset(),ab=[],aj=0,ag=-1,ai=i,ac=y.length;if(ae.onListFormat){ae.onListFormat.call(L,aa,{list:y,settings:ae,cache:Z,ul:D})}else{for(;++ag<ac;){if(y[ag].value){if(ae.maxItems>-1&&++aj>ae.maxItems){break}ab.push(ae.striped&&ai?'<li class="'+ae.striped+'">':"<li>",y[ag].display||y[ag].value,"</li>");ai=!ai}}D.html(ab.join(""))}I=D.children("li");q.data(D[0],"ac-input-index",K);if(ae.autoFill&&!ad){x=0;w=y[0];M(w.value);E=I.eq(0).addClass(ae.rollover)}D.scrollTop(0).css({top:af.top+r.outerHeight(),left:af.left,width:ae.width}).show(aa);s=I.eq(0).outerHeight();if(ae.maxHeight){D.css({height:s*I.length>ae.maxHeight?ae.maxHeight:"auto",overflow:"auto"})}Y=D.outerHeight();G=Y;O=s===0?0:Math.floor(G/s);z.timeStamp=(new Date()).getTime()}B();T.requestType=T.requestType.toUpperCase();if(T.inputControl!==a){T.onChange=T.inputControl}u=T.multiple?T.multipleSeparator:a;f.stack[K]=L;f.jqStack[K]=r;b(r,K)};f=q.extend(q.autoComplete,f)})(jQuery,window||this);