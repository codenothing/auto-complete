/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */
(function(c,g,a){c.fn.autoComplete=function(){var l=i.call(arguments),k=this,n=l.shift(),m=typeof n==="string";if(m){n=n.replace(".","-")}l=n==="button-supply"||n==="direct-supply"?c.isArray(l[0])&&c.isArray(l[0][0])?l[0]:l:l[1]===a&&c.isArray(l[0])?l[0]:l;return m?k[n==="option"&&l.length<2?"triggerHandler":"trigger"]("autoComplete."+n,l):n&&n[c.expando]?k.trigger(n,l):k.each(function(){e(this,n)})};c.fn.bgiframe=c.fn.bgiframe?c.fn.bgiframe:c.fn.bgIframe?c.fn.bgIframe:function(){return this};var b=true,h=false,i=Array.prototype.slice,j=c.expando+"_autoComplete",d={backspace:8,tab:9,enter:13,space:32,pageup:33,pagedown:34,up:38,down:40},f=c.autoComplete={version:"[VERSION]",counter:0,length:0,stack:{},order:[],hasFocus:h,getFocus:function(){return f.order[0]?f.stack[f.order[0]]:a},getPrevious:function(){for(var m=0,k=f.order.length;++m<k;){if(f.order[m]){return f.stack[f.order[m]]}}return a},remove:function(p){for(var o=-1,m=f.order.length;++o<m;){if(f.order[o]===p){f.order[o]=a}}f.stack[p]=a;f.length--;delete f.stack[p]},getAll:function(){for(var n=-1,m=f.counter,k=[];++n<m;){if(f.stack[n]){k.push(f.stack[n])}}return c(k)},defaults:{backwardsCompatible:h,ajax:"ajax.php",ajaxCache:c.ajaxSettings.cache,dataSupply:[],dataFn:a,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:a,striped:a,maxHeight:a,newList:h,postVar:"value",postData:{},postFormat:a,minChars:1,maxItems:-1,maxRequests:0,requestType:"POST",inputControl:a,autoFill:h,nonInput:a,multiple:h,multipleSeparator:" ",onBlur:a,onFocus:a,onHide:a,onLoad:a,onMaxRequest:a,onRollover:a,onSelect:a,onShow:a,onSubmit:function(){return b},spinner:a,onListFormat:a,preventEnterSubmit:b,delay:0,useCache:b,cacheLimit:50}},e=function(F,o){f.length++;f.counter++;var k=c(F).attr("autocomplete","off"),J=b,s={},B="",r=[],C={length:0},y,A,Q,l,I,L=h,K,u,q=-1,p,n,E=f.counter,m=0,D={length:0,val:a,list:{}},N=c.extend({width:k.outerWidth()},f.defaults,o||{},c.metadata?k.metadata():{}),x=!N.newList&&c("ul."+N.list)[0]?c("ul."+N.list).eq(0).bgiframe().data("autoComplete",b):c("<ul/>").appendTo("body").addClass(N.list).bgiframe().hide().data({"ac-selfmade":b,autoComplete:b}),t=c(document).bind("click.autoComplete-"+E,function(S){var R;if(J&&L&&(!s||S.timeStamp-s.timeStamp>200)&&(R=c(S.target)).closest("ul").data("ac-input-index")!==E&&R.data("ac-input-index")!==E){x.hide(S);k.blur()}s=S});k.data({autoComplete:b,"ac-input-index":E,"ac-active":J,"ac-initial-settings":c.extend(b,{},N),"ac-settings":N}).bind(g.opera?"keypress.autoComplete":"keydown.autoComplete",function(S){if(!J){return b}var R=(s=S).keyCode,T=h;if(R===d.tab&&L){H(S)}else{if(R===d.enter&&y){T=N.preventEnterSubmit&&L?h:b;H(S)}else{if(R===d.up){if(q>0){q--;w(S)}else{q=-1;k.val(B);x.hide(S)}}else{if(R===d.down){if(q<C.length-1){q++;z(S)}}else{if(R===d.pageup){if(q>0){q-=I;if(q<0){q=0}w(S)}}else{if(R===d.pagedown){if(q<C.length-1){q+=I;if(q>C.length-1){q=C.length-1}z(S)}}else{if(N.nonInput&&c.inArray(R,N.nonInput)){x.html("").hide(S)}else{return b}}}}}}}s[j+"_keydown"]=b;return T}).bind({"keyup.autoComplete":function(S){if(!J||s[j+"_keydown"]){return b}B=k.val();var R=(s=S).keyCode,T=n?B.split(n).pop():B;if(R!=d.enter){D.val=N.inputControl===a?T:N.inputControl.apply(F,N.backwardsCompatible?[T,R,x,S]:[S,{val:T,key:R,ul:x}]);if(D.val.length>=N.minChars){O(S,N,D,(R===d.backspace||R===d.space))}else{if(R==d.backspace){x.html("").hide(S)}}}},"blur.autoComplete":function(R){if(!J||L){return b}s=R;k.data("ac-hasFocus",h);q=-1;if(f.order[0]!==a){f.order.unshift(a)}f.hasFocus=h;x.hide(R);if(N.onBlur){N.onBlur.apply(F,N.backwardsCompatible?[B,x,R]:[R,{val:B,ul:x}])}},"focus.autoComplete":function(S,R){if(!J||(f.focus===E&&R===j)||s[j+"_enter"]){return b}s=S;if(E!=x.data("ac-input-index")){x.html("").hide(S)}if(f.order[0]===a){if(f.order[1]===E){f.order.shift()}else{f.order[0]=E}}else{if(f.order[0]!=E&&f.order[1]!=E){f.order.unshift(E)}}if(f.order.length>f.defaults.cacheLimit){f.order.pop()}f.hasFocus=b;k.data("ac-hasFocus",b);if(N.onFocus){N.onFocus.apply(F,N.backwardsCompatible?[x,S]:[S,{ul:x}])}},"autoComplete.settings":function(T,R){if(!J){return b}if(c.isFunction(R)){var S=R.apply(F,N.backwardsCompatible?[N,D,x,T]:[T,{settings:N,cache:D,ul:x}]);if(c.isArray(S)&&S[0]!==a){N=c.extend(b,{},N,S[0]||N);D=c.extend(b,{},D,S[1]||D)}}else{N=c.extend(b,{},N,R||{})}x=!N.newList&&x.hasClass(N.list)?x:!N.newList&&c("ul."+N.list)[0]?c("ul."+N.list).bgiframe().data("autoComplete",b):c("<ul/>").appendTo("body").addClass(N.list).bgiframe().hide().data({"ac-selfmade":b,autoComplete:b});v();N.requestType=N.requestType.toUpperCase();n=N.multiple?N.multipleSeparator:a;k.data("ac-settings",N);return(s=T)},"autoComplete.flush":function(R,S){if(!J){return b}if(!S){m=0}D={length:0,val:a,list:{}};return(s=R)},"autoComplete.button-ajax":function(S,R,T){if(!J){return b}if(typeof R==="string"){T=R;R={}}s=S;k.trigger("focus",[j]);D.val=T||j+"_button-ajax";return O(S,c.extend(b,{},N,{maxItems:-1,postData:R||{}}),D)},"autoComplete.button-supply":function(R,S,T){if(!J){return b}if(typeof S==="string"){T=S;S=a}s=R;k.trigger("focus",[j]);D.val=T||j+"_button-supply";S=c.isArray(S)&&S.length?S:N.dataSupply;return O(R,c.extend(b,{},N,{maxItems:-1,dataSupply:S,dataFn:function(){return b}}),D)},"autoComplete.direct-supply":function(R,S,T){if(!J){return b}if(typeof S==="string"){T=S;S=a}s=R;k.trigger("focus",[j]);D.val=T||j+"_direct-supply";S=c.isArray(S)&&S.length?S:N.dataSupply;return P(R,S,c.extend(b,{},N,{maxItems:-1,dataSupply:S,dataFn:function(){return b}}),D)},"autoComplete.search":function(R,S){if(!J){return b}D.val=S||"";return O(s=R,N,D)},"autoComplete.option":function(T){if(!J){return b}var R=i.call(arguments),S=R.length;s=T;if(S===3){N[R[1]]=R[2];return R[2]}else{if(S===2){switch(R[1]){case"ul":return x;case"cache":return D;case"xhr":return u;case"input":return k;default:return N[R[1]]||a}}else{return N}}},"autoComplete.enable":function(R){k.data("ac-active",J=b);return(s=R)},"autoComplete.disable":function(R){k.data("ac-active",J=h);x.html("").hide(R);return(s=R)},"autoComplete.destroy":function(S){var T=x.html("").hide(S).data("ac-inputs"),R;k.removeData("autoComplete").removeData("ac-input-index").removeData("ac-initial-settings").removeData("ac-settings").removeData("ac-active").unbind(".autoComplete autoComplete").closest("form").unbind("submit.autoComplete-"+E);t.unbind("click.autoComplete-"+E);f.remove(E);J=h;T[E]=a;s=S;for(R in T){if(T.hasOwnProperty(R)&&T[R]===b){return s}}if(x.data("ac-selfmade")===b){x.remove()}return s}}).closest("form").bind("submit.autoComplete-"+E,function(S){if(!J){return b}var R=s[j+"_enter"]||h;s=S;return N.preventEnterSubmit?(L||R)?h:N.onSubmit.call(F,S,{form:this,ul:x}):N.onSubmit.call(F,S,{form:this,ul:x})});function O(T,S,R,V,U){if(S.spinner){S.spinner.call(F,T,{active:b,ul:x})}if(K){K=clearTimeout(K)}if(S.delay>0&&U===a){K=g.setTimeout(function(){O(T,S,R,V,b);K=clearTimeout(K)},S.delay);return K}if(u){u.abort()}if(S.useCache&&R.list[R.val]){return P(T,R.list[R.val],S,R,V)}if(S.dataSupply.length){return M(T,S,R,V)}if(S.maxRequests&&++m>=S.maxRequests){x.html("").hide(T);if(S.spinner){S.spinner.call(F,T,{active:h,ul:x})}if(S.onMaxRequest&&m===S.maxRequests){return S.onMaxRequest.apply(F,S.backwardsCompatible?[R.val,x,T,B]:[T,{search:R.val,val:B,ul:x}])}return h}S.postData[S.postVar]=R.val;u=c.ajax({type:S.requestType,url:S.ajax,cache:S.ajaxCache,dataType:"json",data:S.postFormat?S.postFormat.call(F,T,{data:S.postData,search:R.val,val:B,ul:x}):S.postData,success:function(W){P(T,W,S,R,V)},error:function(){x.html("").hide(T);if(S.spinner){S.spinner.call(F,T,{active:h,ul:x})}}});return u}function M(S,V,R,U){var Y=[],Z=[],aa=c.isFunction(V.dataFn),ab=aa?a:new RegExp("^"+R.val,"i"),W=0,ac,X=-1,T=V.dataSupply.length;for(;++X<T;){ac=V.dataSupply[X];ac=typeof ac==="object"&&ac.value?ac:{value:ac};Z=V.backwardsCompatible?[R.val,ac.value,Y,X,V.dataSupply,x,S]:[S,{val:R.val,entry:ac.value,list:Y,i:X,supply:V.dataSupply,ul:x}];if((aa&&V.dataFn.apply(F,Z))||(!aa&&ac.value.match(ab))){if(V.maxItems>-1&&++W>V.maxItems){break}Y.push(ac)}}return P(S,Y,V,R,U)}function H(R){if(L){if(N.onSelect){N.onSelect.apply(F,N.backwardsCompatible?[p,y,x,R]:[R,{data:p,li:y,ul:x}])}G();B=k.val();if(s.type==="keydown"){s[j+"_enter"]=b}}x.hide(R);return y}function w(S){if(y){y.removeClass(N.rollover)}x.show(S);y=C.eq(q).addClass(N.rollover);p=r[q];if(!y.length||!p){return h}G(p.value);if(N.onRollover){N.onRollover.apply(F,N.backwardsCompatible?[p,y,x,S]:[S,{data:p,li:y,ul:x}])}var R=q*l;if(R<A-Q){A=R+Q;x.scrollTop(R)}return y}function z(S){if(y){y.removeClass(N.rollover)}x.show(S);y=C.eq(q).addClass(N.rollover);p=r[q];if(!y.length||!p){return h}G(p.value);var R=(q+1)*l;if(R>A){x.scrollTop((A=R)-Q)}if(N.onRollover){N.onRollover.apply(F,N.backwardsCompatible?[p,y,x,S]:[S,{data:p,li:y,ul:x}])}return y}function v(){var S=x.hide,R=x.show,T=x.data("ac-inputs")||{};if(!x[j]){x.hide=function(U,V,W){if(N.onHide&&L){N.onHide.call(F,U,{ul:x});s[j+"_hide"]=b}L=h;return S.call(x,V,W)};x.show=function(U,V,W){if(N.onShow&&!L){N.onShow.call(F,U,{ul:x})}L=b;return R.call(x,V,W)};x[j]=b}T[E]=b;return x.data("ac-inputs",T)}function G(T){var U,R,S;if(T===a||T===""){U=R=k.val().length}else{if(n){T=B.substr(0,B.length-B.split(n).pop().length)+T+n}U=B.length;R=T.length;k.val(T)}if(!N.autoFill||U>R){return h}else{if(F.createTextRange){S=F.createTextRange();if(T===a){S.move("character",U);S.select()}else{S.collapse(b);S.moveStart("character",U);S.moveEnd("character",R);S.select()}}else{if(F.setSelectionRange){F.setSelectionRange(U,R)}else{if(F.selectionStart){F.selectionStart=U;F.selectionEnd=R}}}}return b}function P(S,ac,X,R,W){r=X.onLoad?X.onLoad.call(F,S,{list:ac,settings:X,cache:R,ul:x}):ac;if(X.spinner){X.spinner.call(F,S,{active:h,ul:x})}if(X.useCache&&R.list[R.val]===a){R.length++;R.list[R.val]=ac;if(R.length>X.cacheLimit){R.list={};R.length=0}}if(!r||r.length<1){return x.html("").hide(S)}q=-1;var aa=k.offset(),T=[],U=0,Y=0,ab=-1,Z=h,V=r.length;if(X.onListFormat){X.onListFormat.call(F,S,{list:r,settings:X,cache:R,ul:x})}else{for(;++ab<V;){if(r[ab].value){if(X.maxItems>-1&&++U>X.maxItems){break}T.push(X.striped&&Z?'<li class="'+X.striped+'">':"<li>",r[ab].display||r[ab].value,"</li>");Z=!Z}}x.html(T.join(""))}C=x.children("li");if(X.autoFill&&!W){q=0;p=r[0];G(p.value);y=C.eq(0).addClass(X.rollover)}x.unbind(".autoComplete").data("ac-input-index",E).delegate("li","mouseleave.autoComplete",function(){if(y){y.removeClass(X.rollover)}}).delegate("li","mouseenter.autoComplete",function(ad){if(y){y.removeClass(X.rollover)}y=c(this).addClass(X.rollover);q=C.index(y[0]);p=r[q];if(X.onRollover){X.onRollover.apply(F,X.backwardsCompatible?[p,y,x,ad]:[ad,{data:p,li:y,ul:x}])}}).bind("click.autoComplete",function(ad){k.trigger("focus",[j]);k.val(B=n?B.substr(0,B.length-B.split(n).pop().length)+p.value+n:p.value);x.hide(ad);G();if(X.onSelect){X.onSelect.apply(F,X.backwardsCompatible?[p,y,x,ad]:[ad,{data:p,li:y,ul:x}])}}).css({top:aa.top+k.outerHeight(),left:aa.left,width:X.width}).scrollTop(0);l=C.eq(0).outerHeight();if(X.maxHeight){x.css({height:l*C.length>X.maxHeight?X.maxHeight:"auto",overflow:"auto"})}Q=x.outerHeight();A=Q;I=l===0?0:Math.floor(A/l);s.timeStamp=(new Date()).getTime();return x.show(S)}v();N.requestType=N.requestType.toUpperCase();n=N.multiple?N.multipleSeparator:a;f.stack[E]=F}})(jQuery,window||this);