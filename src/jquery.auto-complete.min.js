/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */ 
(function(i,S,j){function N(e,n){if(N.flag!==g){N.flag=g;X.bind("click.autoComplete",function(u){h.getFocus(g).trigger("autoComplete.document-click",[u])})}e=e.closest("form");var l=e.data("ac-inputs")||{},B;l[n]=g;e.data("ac-inputs",l);e.data("autoComplete")!==g&&e.data("autoComplete",g).bind("submit.autoComplete",function(u){return(B=h.getFocus(g)).length?B.triggerHandler("autoComplete.form-submit",[u,this]):g})}function ha(e,n){h.remove(n);if(N.flag===g&&h.length===0){N.flag=o;X.unbind("click.autoComplete")}e=
e.closest("form");var l=e.data("ac-inputs")||{},B;l[n]=o;for(B in l)if(l[B]===g)return;e.unbind("submit.autoComplete")}function ca(e,n){if(!n.supply||!i.isArray(n.supply))return[];e=-1;for(var l=n.supply.length,B=[],u;++e<l;){u=(u=n.supply[e])&&u.value?u:{value:u};B.push(u)}return B}function da(){return this}i.fn.autoComplete=function(){var e=Y.call(arguments),n=this,l=e.shift(),B=l===g,u=typeof l=="string",O=l&&l.preventDefault!==j,P;if(u||O){e=h.arrayMethods[l]===g&&i.isArray(e[0])&&i.isArray(e[0][0])||
e.length===1&&i.isArray(e[0])?e[0]:e;P=u&&(h.handlerMethods[l]===-1||e.length<(h.handlerMethods[l]||0))?"triggerHandler":"trigger"}return n.length<1?B?j:n:u?n[P]("autoComplete."+l,e):O?n.trigger(l,e):B?i.autoComplete(n[0],e.shift()):i.each(n,function(Z,I){i.data(I,"autoComplete")!==g&&i.autoComplete(I,l)})};var g=true,o=false,Y=Array.prototype.slice,ea=S.document,X=i(ea),fa=i(),ia=Object.prototype.toString.call(S.opera)==="[object Opera]"||/macintosh/i.test(S.navigator.userAgent)&&i.browser.mozilla?
"keypress.autoComplete":"keydown.autoComplete",w="autoComplete_"+i.expando,z={backspace:8,tab:9,enter:13,shift:16,space:32,pageup:33,pagedown:34,left:37,up:38,right:39,down:40},h={version:"[VERSION]",expando:w,counter:0,length:0,stack:{},jqStack:{},order:[],hasFocus:o,keys:z,arrayMethods:{"button-supply":g,"direct-supply":g},handlerMethods:{option:2},focus:j,blur:j,getFocus:function(e){return!h.order[0]?e?fa:j:e?h.jqStack[h.order[0]]:h.stack[h.order[0]]},getPrevious:function(e){for(var n=0,l=h.order.length;++n<
l;)if(h.order[n])return e?h.jqStack[h.order[n]]:h.stack[h.order[n]];return e?fa:j},remove:function(e){for(var n=-1,l=h.order.length;++n<l;)if(h.order[n]===e)h.order[n]=j;h.length--;delete h.stack[e]},getAll:function(){for(var e=-1,n=h.counter,l=[];++e<n;)h.stack[e]&&l.push(h.stack[e]);return i(l)},defaults:{ajax:"ajax.php",ajaxCache:i.ajaxSettings.cache,dataSupply:[],dataFn:j,formatSupply:j,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:j,striped:j,maxHeight:j,bgiframe:j,newList:o,
postVar:"value",postData:{},postFormat:j,minChars:1,maxItems:-1,maxRequests:0,maxRequestsDeep:o,requestType:"POST",onChange:j,autoFill:o,nonInput:[z.shift,z.left,z.right],multiple:o,multipleSeparator:" ",onBlur:j,onFocus:j,onHide:j,onLoad:j,onMaxRequest:j,onRollover:j,onSelect:j,onShow:j,onListFormat:j,onSubmit:j,spinner:j,preventEnterSubmit:g,delay:0,useCache:g,forceFormat:o,cacheLimit:50}};i.autoComplete=function(e,n){function l(b,a,d,k,D){if(a.maxRequestsDeep===g&&T>=a.maxRequests)return o;a.spinner&&
a.spinner.call(e,b,{active:g,settings:a,cache:d,ul:f});if(U)U=clearTimeout(U);if(a.delay>0&&D===j)return U=S.setTimeout(function(){l(b,a,d,k,g)},a.delay);V&&V.abort();if(a.useCache&&d.list[d.val]&&d.list[d.val].built!=="")return W(b,d.list[d.val].src,a,d,k);if(a.dataSupply.length)return B(b,a,d,k);if(a.maxRequests&&++T>=a.maxRequests){f.html("").hide(b);a.spinner&&a.spinner.call(e,b,{active:o,settings:a,cache:d,ul:f});if(a.onMaxRequest&&T===a.maxRequests)return a.onMaxRequest.call(e,b,{search:d.val,
val:x,settings:a,cache:d,ul:f});return o}a.postData[a.postVar]=d.val;return V=i.ajax({type:a.requestType,url:a.ajax,cache:a.ajaxCache,dataType:"json",data:a.postFormat?a.postFormat.call(e,b,{data:a.postData,search:d.val,val:x,settings:a,cache:d,ul:f}):a.postData,success:function(F){W(b,F,a,d,k)},error:function(){f.html("").hide(b);a.spinner&&a.spinner.call(e,b,{active:o,settings:a,cache:d,ul:f})}})}function B(b,a,d,k){var D=[];if(a.formatSupply)D=a.formatSupply.call(e,b,{search:d.val,supply:a.dataSupply,
settings:a,cache:d,ul:f});else for(var F=0,Q=-1,K=a.dataSupply.length,L,G,$=i.isFunction(a.dataFn),ja=$?j:new RegExp("^"+d.val,"i");++Q<K;){G=(G=a.dataSupply[Q])&&typeof G.value=="string"?G:{value:G};L={search:d.val,entry:G.value,list:D,i:Q,supply:a.dataSupply,settings:a,cache:d,ul:f};if($&&a.dataFn.call(e,b,L)||!$&&G.value.match(ja)){if(a.maxItems>-1&&++F>a.maxItems)break;D.push(G)}}return W(b,D,a,d,k)}function u(b){if(v){c.onSelect&&c.onSelect.call(e,b,{data:y,li:q,settings:c,cache:m,ul:f});I();
x=r.val();if(p.type==="keydown")p["enter_"+w]=g;f.hide(b)}q=j}function O(b){q&&q.removeClass(c.rollover);f.show(b);q=E.eq(s).addClass(c.rollover);y=C[s];if(!q.length||!y)return o;I(y.value);c.onRollover&&c.onRollover.call(e,b,{data:y,li:q,settings:c,cache:m,ul:f});b=s*M;if(b<J-R){J=b+R;f.scrollTop(b)}}function P(b){q&&q.removeClass(c.rollover);f.show(b);q=E.eq(s).addClass(c.rollover);y=C[s];if(!q.length||!y)return o;I(y.value);var a=(s+1)*M;if(a>J)f.scrollTop((J=a)-R);c.onRollover&&c.onRollover.call(e,
b,{data:y,li:q,settings:c,cache:m,ul:f})}function Z(){if(!c.newList&&!f)f=c.list.jquery?c.list:c.list.nodeName?i(c.list):typeof c.list=="string"&&(ga=X.find("ul."+c.list).eq(0)).length?aa.call(ga,c.bgiframe):j;f||(f=aa.call(i("<ul/>").appendTo(ea.body).addClass(c.list).hide().data("ac-selfmade",g),c.bgiframe));var b=f.hide,a=f.show,d=i.data(f[0],"ac-inputs")||{};if(!f[w]){f.hide=function(k,D,F){c.onHide&&v&&c.onHide.call(e,k,{ul:f,settings:c,cache:m});v=o;return b.call(f,D,F)};f.show=function(k,D,
F){c.onShow&&!v&&c.onShow.call(e,k,{ul:f,settings:c,cache:m});v=g;return a.call(f,D,F)};f[w]=g}if(i.data(f[0],"autoComplete")!==g){i.data(f[0],"autoComplete",g);f.delegate("li","mouseenter.autoComplete",function(k){h.getFocus(g).trigger("autoComplete.ul-mouseenter",[k,this])}).bind("click.autoComplete",function(k){h.getFocus(g).trigger("autoComplete.ul-click",[k]);return o})}d[A]=g;i.data(f[0],"ac-inputs",d);return f}function I(b){var a,d,k;if(b===j||b==="")a=d=r.val().length;else{if(H)b=x.substr(0,
x.length-x.split(H).pop().length)+b+H;a=x.length;d=b.length;r.val(b)}if(!c.autoFill||a>d)return o;else if(e.createTextRange){k=e.createTextRange();if(b===j)k.move("character",a);else{k.collapse(g);k.moveStart("character",a);k.moveEnd("character",d)}k.select()}else if(e.setSelectionRange)e.setSelectionRange(a,d);else if(e.selectionStart){e.selectionStart=a;e.selectionEnd=d}}function W(b,a,d,k,D){C=d.onLoad?d.onLoad.call(e,b,{list:a,settings:d,cache:k,ul:f}):a;d.spinner&&d.spinner.call(e,b,{active:o,
settings:d,cache:k,ul:f});if(d.useCache&&(!k.list[k.val]||!i.isArray(k.list[k.val].src))){k.length++;k.list[k.val]={src:C,built:""};if(d.cacheLimit!==-1&&k.length>d.cacheLimit){k.list={};k.length=0}}if(!C||C.length<1)return f.html("").hide(b);s=-1;q=j;a=r.offset();var F=[],Q=0,K=-1,L=o,G=C.length;if(d.onListFormat)d.onListFormat.call(e,b,{list:C,settings:d,cache:k,ul:f});else if(k.list[k.val].built!==""&&!d.forceFormat)f.html(k.list[k.val].built);else{for(;++K<G;)if(C[K].value){if(d.maxItems>-1&&
++Q>d.maxItems)break;F.push(d.striped&&L?'<li class="'+d.striped+'">':"<li>",C[K].display||C[K].value,"</li>");L=!L}f.html(k.list[k.val].built=F.join(""))}E=f.children("li");i.data(f[0],"ac-input-index",A);if(d.autoFill&&!D){s=0;y=C[0];I(y.value);q=E.eq(0).addClass(d.rollover)}f.scrollTop(0).css({top:a.top+r.outerHeight(),left:a.left,width:d.width}).show(b);M=E.eq(0).outerHeight();if(d.maxHeight)f.css({height:M*E.length>d.maxHeight?d.maxHeight:"auto",overflow:"auto"});J=R=f.outerHeight();ba=M===0?
0:Math.floor(J/M);p.timeStamp=(new Date).getTime()}function ka(){var b=this;i.each({"button-ajax":"buttonAjax","button-supply":"buttonSupply",destroy:"destroy","direct-supply":"directSupply",disable:"disable",enable:"enable",flush:"flush",option:"option",search:"search",settings:"settings"},function(a,d){b[d]=function(){var k=Y.call(arguments);k.unshift(a);r.autoComplete.apply(r,k);return b}});b.settings=c;b.cache=m}h.length++;h.counter++;var r=i(e).attr("autocomplete","off"),f,ga,t={},p={},x="",
C=[],E={length:0},q,J,R,M,ba,v=o,U,V,s=-1,y,H,A=h.counter,T=0,aa=i.fn.bgiframe||i.fn.bgIframe||da,m={length:0,val:j,list:{}},c=i.extend({width:r.outerWidth()},h.defaults,n||{},i.metadata?r.metadata():{});i.data(e,"autoComplete",t={index:A,hasFocus:o,active:g,settings:c,initialSettings:i.extend(g,{},c)});e.attachEvent&&r.bind("keypress.autoComplete",function(b){if(!t.active)return g;if(b.keyCode===z.enter){var a=g;if(q&&q.hasClass(c.rollover)){a=c.preventEnterSubmit&&v?o:g;u(b)}else v&&f.hide(b);return a}});
r.bind(ia,function(b){if(!t.active)return g;var a=(p=b).keyCode,d=o;if(a===z.tab&&v)u(b);else if(a===z.enter){d=g;if(q&&q.hasClass(c.rollover)){d=c.preventEnterSubmit&&v?o:g;u(b)}else v&&f.hide(b)}else if(a===z.up&&v)if(s>0){s--;O(b)}else{s=-1;q=j;r.val(x);f.hide(b)}else if(a===z.down&&v){if(s<E.length-1){s++;P(b)}}else if(a===z.pageup&&v){if(s>0){s-=ba;if(s<0)s=0;O(b)}}else if(a===z.pagedown&&v){if(s<E.length-1){s+=ba;if(s>E.length-1)s=E.length-1;P(b)}}else if(c.nonInput&&i.inArray(a,c.nonInput)>
-1){f.html("").hide(b);d=g}else return g;p["keydown_"+w]=g;return d}).bind({"keyup.autoComplete":function(b){if(!t.active||p["keydown_"+w])return g;x=r.val();var a=(p=b).keyCode,d=H?x.split(H).pop():x;if(a!=z.enter){m.val=c.onChange===j?d:c.onChange.call(e,b,{val:d,key:a,settings:c,cache:m,ul:f});if(m.val.length>=c.minChars)l(b,c,m,a===z.backspace||a===z.space);else a==z.backspace&&f.html("").hide(b)}},"blur.autoComplete":function(b){if(!t.active||v)return g;h.order[0]!==j&&h.order.unshift(j);h.hasFocus=
o;t.hasFocus=o;s=-1;q=j;f.hide(p=b);h.blur&&h.blur.call(e,b,{settings:c,cache:m,ul:f});c.onBlur&&c.onBlur.call(e,b,{val:x,settings:c,cache:m,ul:f})},"focus.autoComplete":function(b,a){if(!t.active||t.hasFocus&&a===w||p["enter_"+w])return g;A!==i.data(f[0],"ac-input-index")&&f.html("").hide(b);if(h.order[0]===j)if(h.order[1]===A)h.order.shift();else h.order[0]=A;else h.order[0]!=A&&h.order[1]!=A&&h.order.unshift(A);h.defaults.cacheLimit!==-1&&h.order.length>h.defaults.cacheLimit&&h.order.pop();h.hasFocus=
g;t.hasFocus=g;p=b;h.focus&&h.focus.call(e,b,{settings:c,cache:m,ul:f});c.onFocus&&c.onFocus.call(e,b,{settings:c,cache:m,ul:f})},"autoComplete.document-click":function(b,a){if(t.active&&v&&(!p||a.timeStamp-p.timeStamp>200)&&i(a.target).closest("ul").data("ac-input-index")!==A){f.hide(p=a);r.trigger("blur")}},"autoComplete.form-submit":function(b,a,d){if(!t.active)return g;p=a;return c.preventEnterSubmit&&(v||p["enter_"+w])?o:c.onSubmit===j?g:c.onSubmit.call(e,a,{form:d,settings:c,cache:m,ul:f})},
"autoComplete.ul-mouseenter":function(b,a,d){q&&q.removeClass(c.rollover);q=i(d).addClass(c.rollover);s=E.index(d);y=C[s];J=f.scrollTop()+R;p=a;c.onRollover&&c.onRollover.call(e,a,{data:y,li:q,settings:c,cache:m,ul:f})},"autoComplete.ul-click":function(b,a){r.trigger("focus",[w]);r.val(x===H?x.substr(0,x.length-x.split(H).pop().length)+y.value+H:y.value);f.hide(p=a);I();c.onSelect&&c.onSelect.call(e,a,{data:y,li:q,settings:c,cache:m,ul:f})},"autoComplete.settings":function(b,a){if(!t.active)return g;
p=b;if(i.isFunction(a)){if((b=a.call(e,b,{settings:c,cache:m,ul:f}))&&i.isArray(b)&&b[0]!==j){i.extend(g,c,b[0]||c);i.extend(g,m,b[1]||m)}}else i.extend(g,c,a||{});aa=i.fn.bgiframe||i.fn.bgIframe||da;f=Z();c.requestType=c.requestType.toUpperCase();if(c.inputControl!==j&&c.onChange===j)c.onChange=c.inputControl;H=c.multiple?c.multipleSeparator:j;t.settings=c},"autoComplete.flush":function(b,a){if(!t.active)return g;a||(T=0);m={length:0,val:j,list:{}};p=b},"autoComplete.button-ajax":function(b,a,d){if(!t.active)return g;
if(typeof a=="string"){d=a;a={}}p=b;r.trigger("focus",[w]);m.val=d||"button-ajax_"+w;return l(b,i.extend(g,{},c,{maxItems:-1,postData:a||{}}),m)},"autoComplete.button-supply":function(b,a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a=j}p=b;r.trigger("focus",[w]);m.val=d||"button-supply_"+w;a=i.isArray(a)?a:c.dataSupply;return l(b,i.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSupply:ca}),m)},"autoComplete.direct-supply":function(b,a,d){if(!t.active)return g;if(typeof a=="string"){d=a;a=j}p=
b;r.trigger("focus",[w]);m.val=d||"direct-supply_"+w;a=i.isArray(a)&&a.length?a:c.dataSupply;return W(b,a,i.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSupply:ca}),m)},"autoComplete.search":function(b,a){if(!t.active)return g;m.val=a||"";return l(p=b,c,m)},"autoComplete.option":function(b,a,d){if(!t.active)return g;p=b;switch(Y.call(arguments).length){case 3:return c[a]=d;case 2:return a==="ul"?f:a==="cache"?m:a==="xhr"?V:a==="input"?r:c[a]||j;default:return c}},"autoComplete.enable":function(b){t.active=
g;p=b},"autoComplete.disable":function(b){t.active=o;f.html("").hide(p=b)},"autoComplete.destroy":function(b){b=i.data(f.html("").hide(p=b)[0],"ac-inputs")||{};var a;r.removeData("autoComplete").unbind(".autoComplete autoComplete");ha(r,A);b[A]=j;for(a in b)if(b[a]===g)return p;i.data(f[0],"ac-selfmade")===g?f.remove():f.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs")}});f=Z();c.requestType=c.requestType.toUpperCase();if(c.inputControl!==j&&c.onChange===j)c.onChange=
c.inputControl;H=c.multiple?c.multipleSeparator:j;h.stack[A]=e;h.jqStack[A]=r;N(r,A);return t.instance=new ka};h=i.extend(i.autoComplete,h)})(jQuery,this);
