/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */
(function(i,V,j){function L(f,r){if(L.flag!==g){L.flag=g;Y.bind("click.autoComplete",function(u){h.getFocus(g).trigger("autoComplete.document-click",[u])})}f=f.closest("form");var m=f.data("ac-inputs")||[],z;m[r]=g;f.data("ac-inputs",m);f.data("autoComplete")!==g&&f.data("autoComplete",g).bind("submit.autoComplete",function(u){return(z=h.getFocus(g)).length?z.triggerHandler("autoComplete.form-submit",[u]):g})}function da(f,r){if(L.flag===g&&h.length===0){L.flag=o;Y.unbind("click.autoComplete")}f=
f.closest("form");var m=f.data("ac-inputs"),z=-1,u=(m||[]).length;for(m[r]=o;++z<u;)if(m[z]===g)return;f.unbind("submit.autoComplete")}function Z(f,r){if(!i.isArray(r.supply))return[];f=-1;for(var m=r.supply.length,z=[],u;++f<m;){u=(u=r.supply[f])&&u.value?u:{value:u};z.push(u)}return z}i.fn.autoComplete=function(){var f=$.call(arguments),r=this,m=f.shift(),z=typeof m==="string",u,M;if(z)m=m.replace(ea,"-");f=h.arrayMethods[m]===g&&i.isArray(f[0])&&i.isArray(f[0][0])||f.length===1&&i.isArray(f[0])?
f[0]:f;u=z&&(h.handlerMethods[m]===-1||f.length<(h.handlerMethods[m]||0))?"triggerHandler":"trigger";return z?r[u]("autoComplete."+m,f):m&&m.preventDefault!==j?r.trigger(m,f):r.each(function(){if(i(M=this).data("autoComplete")!==g)fa(M,m)})};i.fn.bgiframe=i.fn.bgiframe?i.fn.bgiframe:i.fn.bgIframe?i.fn.bgIframe:function(){return this};var g=true,o=false,$=Array.prototype.slice,Y=i(V.document),aa=i(),ea=/\./,y="autoComplete_"+i.expando,h=i.autoComplete={version:"[VERSION]",counter:0,length:0,stack:{},
jqStack:{},order:[],hasFocus:o,keys:{backspace:8,tab:9,enter:13,space:32,pageup:33,pagedown:34,up:38,down:40},arrayMethods:{"button-supply":g,"direct-supply":g},handlerMethods:{option:2},getFocus:function(f){return!h.order[0]?f?aa:j:f?h.jqStack[h.order[0]]:h.stack[h.order[0]]},getPrevious:function(f){for(var r=0,m=h.order.length;++r<m;)if(h.order[r])return f?h.jqStack[h.order[r]]:h.stack[h.order[r]];return f?aa:j},remove:function(f){for(var r=-1,m=h.order.length;++r<m;)if(h.order[r]===f)h.order[r]=
j;h.length--;delete h.stack[f]},getAll:function(){for(var f=-1,r=h.counter,m=[];++f<r;)h.stack[f]&&m.push(h.stack[f]);return i(m)},defaults:{backwardsCompatible:o,ajax:"ajax.php",ajaxCache:i.ajaxSettings.cache,dataSupply:[],dataFn:j,formatSupply:j,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:j,striped:j,maxHeight:j,newList:o,postVar:"value",postData:{},postFormat:j,minChars:1,maxItems:-1,maxRequests:0,requestType:"POST",inputControl:j,autoFill:o,nonInput:j,multiple:o,multipleSeparator:" ",
onBlur:j,onFocus:j,onHide:j,onLoad:j,onMaxRequest:j,onRollover:j,onSelect:j,onShow:j,onSubmit:function(){return g},spinner:j,onListFormat:j,preventEnterSubmit:g,delay:0,useCache:g,cacheLimit:50}},G=h.keys,fa=function(f,r){function m(b,a,d,k,A){a.spinner&&a.spinner.call(f,b,{active:g,settings:a,cache:d,ul:e});if(Q)Q=clearTimeout(Q);if(a.delay>0&&A===j)return Q=V.setTimeout(function(){m(b,a,d,k,g)},a.delay);R&&R.abort();if(a.useCache&&d.list[d.val])return S(b,d.list[d.val],a,d,k);if(a.dataSupply.length)return z(b,
a,d,k);if(a.maxRequests&&++W>=a.maxRequests){e.html("").hide(b);a.spinner&&a.spinner.call(f,b,{active:o,settings:a,cache:d,ul:e});if(a.onMaxRequest&&W===a.maxRequests)return a.onMaxRequest.apply(f,a.backwardsCompatible?[d.val,e,b,v,a,d]:[b,{search:d.val,val:v,settings:a,cache:d,ul:e}]);return o}a.postData[a.postVar]=d.val;return R=i.ajax({type:a.requestType,url:a.ajax,cache:a.ajaxCache,dataType:"json",data:a.postFormat?a.postFormat.call(f,b,{data:a.postData,search:d.val,val:v,settings:a,cache:d,ul:e}):
a.postData,success:function(E){S(b,E,a,d,k)},error:function(){e.html("").hide(b);a.spinner&&a.spinner.call(f,b,{active:o,settings:a,cache:d,ul:e})}})}function z(b,a,d,k){var A=[],E=[],N=i.isFunction(a.dataFn),I=N?j:new RegExp("^"+d.val,"i"),O=0,B,T=-1,ga=a.dataSupply.length;if(a.formatSupply)A=a.formatSupply.call(f,b,{search:d.val,supply:a.dataSupply,settings:a,cache:d,ul:e});else for(;++T<ga;){B=a.dataSupply[T];B=typeof B==="object"&&B.value?B:{value:B};E=a.backwardsCompatible?[d.val,B.value,A,T,
a.dataSupply,e,b,a,d]:[b,{search:d.val,entry:B.value,list:A,i:T,supply:a.dataSupply,settings:a,cache:d,ul:e}];if(N&&a.dataFn.apply(f,E)||!N&&B.value.match(I)){if(a.maxItems>-1&&++O>a.maxItems)break;A.push(B)}}return S(b,A,a,d,k)}function u(b){if(C){if(c.onSelect)c.onSelect.apply(f,c.backwardsCompatible?[t,p,e,b,c,l]:[b,{data:t,li:p,settings:c,cache:l,ul:e}]);P();v=q.val();if(n.type==="keydown")n["enter_"+y]=g}return e.hide(b)}function M(b){p&&p.removeClass(c.rollover);e.show(b);p=F.eq(s).addClass(c.rollover);
t=D[s];if(!p.length||!t)return o;P(t.value);if(c.onRollover)c.onRollover.apply(f,c.backwardsCompatible?[t,p,e,b,c,l]:[b,{data:t,li:p,settings:c,cache:l,ul:e}]);b=s*J;if(b<K-U){K=b+U;e.scrollTop(b)}return p}function ba(b){p&&p.removeClass(c.rollover);e.show(b);p=F.eq(s).addClass(c.rollover);t=D[s];if(!p.length||!t)return o;P(t.value);var a=(s+1)*J;if(a>K)e.scrollTop((K=a)-U);if(c.onRollover)c.onRollover.apply(f,c.backwardsCompatible?[t,p,e,b,c,l]:[b,{data:t,li:p,settings:c,cache:l,ul:e}]);return p}
function ca(){var b=e.hide,a=e.show,d=e.data("ac-inputs")||{};if(!e[y]){e.hide=function(k,A,E){c.onHide&&C&&c.onHide.call(f,k,{ul:e,settings:c,cache:l});C=o;return b.call(e,A,E)};e.show=function(k,A,E){c.onShow&&!C&&c.onShow.call(f,k,{ul:e,settings:c,cache:l});C=g;return a.call(e,A,E)};e[y]=g}e.data("autoComplete")!==g&&e.data("autoComplete",g).delegate("li","mouseenter.autoComplete",function(k){h.getFocus(g).trigger("autoComplete.ul-mouseenter",[k,this])}).bind("click.autoComplete",function(k){h.getFocus(g).trigger("autoComplete.ul-click",
[k]);return o});d[w]=g;return e.data("ac-inputs",d)}function P(b){var a,d,k;if(b===j||b==="")a=d=q.val().length;else{if(H)b=v.substr(0,v.length-v.split(H).pop().length)+b+H;a=v.length;d=b.length;q.val(b)}if(!c.autoFill||a>d)return o;else if(f.createTextRange){k=f.createTextRange();if(b===j)k.move("character",a);else{k.collapse(g);k.moveStart("character",a);k.moveEnd("character",d)}k.select()}else if(f.setSelectionRange)f.setSelectionRange(a,d);else if(f.selectionStart){f.selectionStart=a;f.selectionEnd=
d}return g}function S(b,a,d,k,A){D=d.onLoad?d.onLoad.call(f,b,{list:a,settings:d,cache:k,ul:e}):a;d.spinner&&d.spinner.call(f,b,{active:o,settings:d,cache:k,ul:e});if(d.useCache&&k.list[k.val]===j){k.length++;k.list[k.val]=a;if(k.length>d.cacheLimit){k.list={};k.length=0}}if(!D||D.length<1)return e.html("").hide(b);s=-1;a=q.offset();var E=[],N=0,I=-1,O=o,B=D.length;if(d.onListFormat)d.onListFormat.call(f,b,{list:D,settings:d,cache:k,ul:e});else{for(;++I<B;)if(D[I].value){if(d.maxItems>-1&&++N>d.maxItems)break;
E.push(d.striped&&O?'<li class="'+d.striped+'">':"<li>",D[I].display||D[I].value,"</li>");O=!O}e.html(E.join(""))}F=e.children("li");if(d.autoFill&&!A){s=0;t=D[0];P(t.value);p=F.eq(0).addClass(d.rollover)}e.data("ac-input-index",w).scrollTop(0).css({top:a.top+q.outerHeight(),left:a.left,width:d.width});J=F.eq(0).outerHeight();if(d.maxHeight)e.css({height:J*F.length>d.maxHeight?d.maxHeight:"auto",overflow:"auto"});K=U=e.outerHeight();X=J===0?0:Math.floor(K/J);n.timeStamp=(new Date).getTime();return e.show(b)}
h.length++;h.counter++;var q=i(f).attr("autocomplete","off"),x=g,n={},v="",D=[],F={length:0},p,K,U,J,X,C=o,Q,R,s=-1,t,H,w=h.counter,W=0,l={length:0,val:j,list:{}},c=i.extend({width:q.outerWidth()},h.defaults,r||{},i.metadata?q.metadata():{}),e=!c.newList&&i("ul."+c.list)[0]?i("ul."+c.list).eq(0).bgiframe():i("<ul/>").appendTo("body").addClass(c.list).bgiframe().hide().data("ac-selfmade",g);q.data({autoComplete:g,"ac-input-index":w,"ac-active":x,"ac-initial-settings":i.extend(g,{},c),"ac-settings":c}).bind(V.opera?
"keypress.autoComplete":"keydown.autoComplete",function(b){if(!x)return g;var a=(n=b).keyCode,d=o;if(a===G.tab&&C)u(b);else if(a===G.enter)if(p&&p.hasClass(c.rollover)){d=c.preventEnterSubmit&&C?o:g;u(b)}else{if(C){e.hide(b);d=c.preventEnterSubmit&&C?o:g}}else if(a===G.up)if(s>0){s--;M(b)}else{s=-1;q.val(v);e.hide(b)}else if(a===G.down){if(s<F.length-1){s++;ba(b)}}else if(a===G.pageup){if(s>0){s-=X;if(s<0)s=0;M(b)}}else if(a===G.pagedown){if(s<F.length-1){s+=X;if(s>F.length-1)s=F.length-1;ba(b)}}else if(c.nonInput&&
i.inArray(a,c.nonInput)>-1)e.html("").hide(b);else return g;n["keydown_"+y]=g;return d}).bind({"keyup.autoComplete":function(b){if(!x||n["keydown_"+y])return g;v=q.val();var a=(n=b).keyCode,d=H?v.split(H).pop():v;if(a!=G.enter){l.val=c.inputControl===j?d:c.inputControl.apply(f,c.backwardsCompatible?[d,a,e,b,c,l]:[b,{val:d,key:a,settings:c,cache:l,ul:e}]);if(l.val.length>=c.minChars)m(b,c,l,a===G.backspace||a===G.space);else a==G.backspace&&e.html("").hide(b)}},"blur.autoComplete":function(b){if(!x||
C)return g;n=b;q.data("ac-hasFocus",o);s=-1;h.order[0]!==j&&h.order.unshift(j);h.hasFocus=o;e.hide(b);if(c.onBlur)c.onBlur.apply(f,c.backwardsCompatible?[v,e,b,c,l]:[b,{val:v,settings:c,cache:l,ul:e}])},"focus.autoComplete":function(b,a){if(!x||h.focus===w&&a===y||n["enter_"+y])return g;n=b;w!==e.data("ac-input-index")&&e.html("").hide(b);if(h.order[0]===j)if(h.order[1]===w)h.order.shift();else h.order[0]=w;else h.order[0]!=w&&h.order[1]!=w&&h.order.unshift(w);h.order.length>h.defaults.cacheLimit&&
h.order.pop();h.hasFocus=g;q.data("ac-hasFocus",g);if(c.onFocus)c.onFocus.apply(f,c.backwardsCompatible?[e,b,c,l]:[b,{settings:c,cache:l,ul:e}])},"autoComplete.document-click":function(b,a){if(x&&C&&(!n||a.timeStamp-n.timeStamp>200)&&i(a.target).closest("ul").data("ac-input-index")!==w){e.hide(n=a);q.blur()}},"autoComplete.form-submit":function(b,a){if(!x)return g;n=a;return c.preventEnterSubmit&&(C||n["enter_"+y])?o:c.onSubmit.call(f,a,{form:this,settings:c,cache:l,ul:e})},"autoComplete.ul-mouseenter":function(b,
a,d){p&&p.removeClass(c.rollover);p=i(d).addClass(c.rollover);s=F.index(d);t=D[s];if(c.onRollover)c.onRollover.apply(f,c.backwardsCompatible?[t,p,e,a,c,l]:[a,{data:t,li:p,settings:c,cache:l,ul:e}]);return n=a},"autoComplete.ul-click":function(b,a){q.trigger("focus",[y]);q.val(v===H?v.substr(0,v.length-v.split(H).pop().length)+t.value+H:t.value);e.hide(a);P();if(c.onSelect)c.onSelect.apply(f,c.backwardsCompatible?[t,p,e,a,c,l]:[a,{data:t,li:p,settings:c,cache:l,ul:e}]);return n=a},"autoComplete.settings":function(b,
a){if(!x)return g;var d;if(i.isFunction(a)){a=a.apply(f,c.backwardsCompatible?[c,l,e,b]:[b,{settings:c,cache:l,ul:e}]);if(i.isArray(a)&&a[0]!==j){i.extend(g,c,a[0]||c);i.extend(g,l,a[1]||l)}}else i.extend(g,c,a||{});e=!c.newList&&e.hasClass(c.list)?e:!c.newList&&(d=i("ul."+c.list).eq(0)).length?d.bgiframe():i("<ul/>").appendTo("body").addClass(c.list).bgiframe().hide().data("ac-selfmade",g);ca();c.requestType=c.requestType.toUpperCase();H=c.multiple?c.multipleSeparator:j;q.data("ac-settings",c);return n=
b},"autoComplete.flush":function(b,a){if(!x)return g;a||(W=0);l={length:0,val:j,list:{}};return n=b},"autoComplete.button-ajax":function(b,a,d){if(!x)return g;if(typeof a==="string"){d=a;a={}}n=b;q.trigger("focus",[y]);l.val=d||"button-ajax_"+y;return m(b,i.extend(g,{},c,{maxItems:-1,postData:a||{}}),l)},"autoComplete.button-supply":function(b,a,d){if(!x)return g;if(typeof a==="string"){d=a;a=j}n=b;q.trigger("focus",[y]);l.val=d||"button-supply_"+y;a=i.isArray(a)&&a.length?a:c.dataSupply;return m(b,
i.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSuppy:Z}),l)},"autoComplete.direct-supply":function(b,a,d){if(!x)return g;if(typeof a==="string"){d=a;a=j}n=b;q.trigger("focus",[y]);l.val=d||"direct-supply_"+y;a=i.isArray(a)&&a.length?a:c.dataSupply;return S(b,a,i.extend(g,{},c,{maxItems:-1,dataSupply:a,formatSuppy:Z}),l)},"autoComplete.search":function(b,a){if(!x)return g;l.val=a||"";return m(n=b,c,l)},"autoComplete.option":function(b,a,d){if(!x)return g;var k=$.call(arguments).length;n=b;if(k===
3)return c[a]=d;else if(k===2)switch(a){case "ul":return e;case "cache":return l;case "xhr":return R;case "input":return q;default:return c[a]||j}else return c},"autoComplete.enable":function(b){q.data("ac-active",x=g);return n=b},"autoComplete.disable":function(b){q.data("ac-active",x=o);e.html("").hide(b);return n=b},"autoComplete.destroy":function(b){var a=e.html("").hide(b).data("ac-inputs"),d;q.removeData("autoComplete").removeData("ac-input-index").removeData("ac-initial-settings").removeData("ac-settings").removeData("ac-active").unbind(".autoComplete autoComplete");
h.remove(w);da(q,w);x=o;a[w]=j;n=b;for(d in a)if(a.hasOwnProperty(d)&&a[d]===g)return n;e.data("ac-selfmade")===g?e.remove():e.removeData("autoComplete").removeData("ac-input-index").removeData("ac-inputs");return n}});ca();c.requestType=c.requestType.toUpperCase();H=c.multiple?c.multipleSeparator:j;h.stack[w]=f;h.jqStack[w]=q;L(q,w)}})(jQuery,window||this);
