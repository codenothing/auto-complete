/*
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */
(function(h,U,i){h.fn.autoComplete=function(){var f=V.call(arguments),x=this,q=f.shift(),O=typeof q==="string";if(O)q=q.replace(".","-");f=q==="button-supply"||q==="direct-supply"?h.isArray(f[0])&&h.isArray(f[0][0])?f[0]:f:f[1]===i&&h.isArray(f[0])?f[0]:f;return O?x[q==="option"&&f.length<2?"triggerHandler":"trigger"]("autoComplete."+q,f):q&&q[h.expando]?x.trigger(q,f):x.each(function(){$(this,q)})};h.fn.bgiframe=h.fn.bgiframe?h.fn.bgiframe:h.fn.bgIframe?h.fn.bgIframe:function(){return this};var g=
true,o=false,V=Array.prototype.slice,w=h.expando+"_autoComplete",E={backspace:8,tab:9,enter:13,space:32,pageup:33,pagedown:34,up:38,down:40},j=h.autoComplete={version:"[VERSION]",counter:0,length:0,stack:{},order:[],hasFocus:o,getFocus:function(){return j.order[0]?j.stack[j.order[0]]:i},getPrevious:function(){for(var f=0,x=j.order.length;++f<x;)if(j.order[f])return j.stack[j.order[f]];return i},remove:function(f){for(var x=-1,q=j.order.length;++x<q;)if(j.order[x]===f)j.order[x]=i;j.stack[f]=i;j.length--;
delete j.stack[f]},getAll:function(){for(var f=-1,x=j.counter,q=[];++f<x;)j.stack[f]&&q.push(j.stack[f]);return h(q)},defaults:{backwardsCompatible:o,ajax:"ajax.php",ajaxCache:h.ajaxSettings.cache,dataSupply:[],dataFn:i,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:i,striped:i,maxHeight:i,newList:o,postVar:"value",postData:{},postFormat:i,minChars:1,maxItems:-1,maxRequests:0,requestType:"POST",inputControl:i,autoFill:o,nonInput:i,multiple:o,multipleSeparator:" ",onBlur:i,
onFocus:i,onHide:i,onLoad:i,onMaxRequest:i,onRollover:i,onSelect:i,onShow:i,onSubmit:function(){return g},spinner:i,onListFormat:i,preventEnterSubmit:g,delay:0,useCache:g,cacheLimit:50}},$=function(f,x){function q(b,a,c,l,y){a.spinner&&a.spinner.call(f,b,{active:g,ul:d});if(H)H=clearTimeout(H);if(a.delay>0&&y===i)return H=U.setTimeout(function(){q(b,a,c,l,g);H=clearTimeout(H)},a.delay);P&&P.abort();if(a.useCache&&c.list[c.val])return Q(b,c.list[c.val],a,c,l);if(a.dataSupply.length)return O(b,a,c,
l);if(a.maxRequests&&++S>=a.maxRequests){d.html("").hide(b);a.spinner&&a.spinner.call(f,b,{active:o,ul:d});if(a.onMaxRequest&&S===a.maxRequests)return a.onMaxRequest.apply(f,a.backwardsCompatible?[c.val,d,b,t]:[b,{search:c.val,val:t,ul:d}]);return o}a.postData[a.postVar]=c.val;return P=h.ajax({type:a.requestType,url:a.ajax,cache:a.ajaxCache,dataType:"json",data:a.postFormat?a.postFormat.call(f,b,{data:a.postData,search:c.val,val:t,ul:d}):a.postData,success:function(B){Q(b,B,a,c,l)},error:function(){d.html("").hide(b);
a.spinner&&a.spinner.call(f,b,{active:o,ul:d})}})}function O(b,a,c,l){for(var y=[],B=[],L=h.isFunction(a.dataFn),I=L?i:new RegExp("^"+c.val,"i"),M=0,z,C=-1,aa=a.dataSupply.length;++C<aa;){z=a.dataSupply[C];z=typeof z==="object"&&z.value?z:{value:z};B=a.backwardsCompatible?[c.val,z.value,y,C,a.dataSupply,d,b]:[b,{val:c.val,entry:z.value,list:y,i:C,supply:a.dataSupply,ul:d}];if(L&&a.dataFn.apply(f,B)||!L&&z.value.match(I)){if(a.maxItems>-1&&++M>a.maxItems)break;y.push(z)}}return Q(b,y,a,c,l)}function W(b){if(F){if(e.onSelect)e.onSelect.apply(f,
e.backwardsCompatible?[r,k,d,b]:[b,{data:r,li:k,ul:d}]);N();t=p.val();if(m.type==="keydown")m[w+"_enter"]=g}d.hide(b);return k}function X(b){k&&k.removeClass(e.rollover);d.show(b);k=D.eq(n).addClass(e.rollover);r=A[n];if(!k.length||!r)return o;N(r.value);if(e.onRollover)e.onRollover.apply(f,e.backwardsCompatible?[r,k,d,b]:[b,{data:r,li:k,ul:d}]);b=n*J;if(b<K-R){K=b+R;d.scrollTop(b)}return k}function Y(b){k&&k.removeClass(e.rollover);d.show(b);k=D.eq(n).addClass(e.rollover);r=A[n];if(!k.length||!r)return o;
N(r.value);var a=(n+1)*J;if(a>K)d.scrollTop((K=a)-R);if(e.onRollover)e.onRollover.apply(f,e.backwardsCompatible?[r,k,d,b]:[b,{data:r,li:k,ul:d}]);return k}function Z(){var b=d.hide,a=d.show,c=d.data("ac-inputs")||{};if(!d[w]){d.hide=function(l,y,B){if(e.onHide&&F){e.onHide.call(f,l,{ul:d});m[w+"_hide"]=g}F=o;return b.call(d,y,B)};d.show=function(l,y,B){e.onShow&&!F&&e.onShow.call(f,l,{ul:d});F=g;return a.call(d,y,B)};d[w]=g}c[s]=g;return d.data("ac-inputs",c)}function N(b){var a,c,l;if(b===i||b===
"")a=c=p.val().length;else{if(G)b=t.substr(0,t.length-t.split(G).pop().length)+b+G;a=t.length;c=b.length;p.val(b)}if(!e.autoFill||a>c)return o;else if(f.createTextRange){l=f.createTextRange();if(b===i)l.move("character",a);else{l.collapse(g);l.moveStart("character",a);l.moveEnd("character",c)}l.select()}else if(f.setSelectionRange)f.setSelectionRange(a,c);else if(f.selectionStart){f.selectionStart=a;f.selectionEnd=c}return g}function Q(b,a,c,l,y){A=c.onLoad?c.onLoad.call(f,b,{list:a,settings:c,cache:l,
ul:d}):a;c.spinner&&c.spinner.call(f,b,{active:o,ul:d});if(c.useCache&&l.list[l.val]===i){l.length++;l.list[l.val]=a;if(l.length>c.cacheLimit){l.list={};l.length=0}}if(!A||A.length<1)return d.html("").hide(b);n=-1;a=p.offset();var B=[],L=0,I=-1,M=o,z=A.length;if(c.onListFormat)c.onListFormat.call(f,b,{list:A,settings:c,cache:l,ul:d});else{for(;++I<z;)if(A[I].value){if(c.maxItems>-1&&++L>c.maxItems)break;B.push(c.striped&&M?'<li class="'+c.striped+'">':"<li>",A[I].display||A[I].value,"</li>");M=!M}d.html(B.join(""))}D=
d.children("li");if(c.autoFill&&!y){n=0;r=A[0];N(r.value);k=D.eq(0).addClass(c.rollover)}d.unbind(".autoComplete").data("ac-input-index",s).delegate("li","mouseleave.autoComplete",function(){k&&k.removeClass(c.rollover)}).delegate("li","mouseenter.autoComplete",function(C){k&&k.removeClass(c.rollover);k=h(this).addClass(c.rollover);n=D.index(k[0]);r=A[n];if(c.onRollover)c.onRollover.apply(f,c.backwardsCompatible?[r,k,d,C]:[C,{data:r,li:k,ul:d}])}).bind("click.autoComplete",function(C){p.trigger("focus",
[w]);p.val(t=G?t.substr(0,t.length-t.split(G).pop().length)+r.value+G:r.value);d.hide(C);N();if(c.onSelect)c.onSelect.apply(f,c.backwardsCompatible?[r,k,d,C]:[C,{data:r,li:k,ul:d}])}).css({top:a.top+p.outerHeight(),left:a.left,width:c.width}).scrollTop(0);J=D.eq(0).outerHeight();if(c.maxHeight)d.css({height:J*D.length>c.maxHeight?c.maxHeight:"auto",overflow:"auto"});K=R=d.outerHeight();T=J===0?0:Math.floor(K/J);m.timeStamp=(new Date).getTime();return d.show(b)}j.length++;j.counter++;var p=h(f).attr("autocomplete",
"off"),v=g,m={},t="",A=[],D={length:0},k,K,R,J,T,F=o,H,P,n=-1,r,G,s=j.counter,S=0,u={length:0,val:i,list:{}},e=h.extend({width:p.outerWidth()},j.defaults,x||{},h.metadata?p.metadata():{}),d=!e.newList&&h("ul."+e.list)[0]?h("ul."+e.list).eq(0).bgiframe().data("autoComplete",g):h("<ul/>").appendTo("body").addClass(e.list).bgiframe().hide().data({"ac-selfmade":g,autoComplete:g}),ba=h(document).bind("click.autoComplete-"+s,function(b){var a;if(v&&F&&(!m||b.timeStamp-m.timeStamp>200)&&(a=h(b.target)).closest("ul").data("ac-input-index")!==
s&&a.data("ac-input-index")!==s){d.hide(b);p.blur()}m=b});p.data({autoComplete:g,"ac-input-index":s,"ac-active":v,"ac-initial-settings":h.extend(g,{},e),"ac-settings":e}).bind(U.opera?"keypress.autoComplete":"keydown.autoComplete",function(b){if(!v)return g;var a=(m=b).keyCode,c=o;if(a===E.tab&&F)W(b);else if(a===E.enter&&k){c=e.preventEnterSubmit&&F?o:g;W(b)}else if(a===E.up)if(n>0){n--;X(b)}else{n=-1;p.val(t);d.hide(b)}else if(a===E.down){if(n<D.length-1){n++;Y(b)}}else if(a===E.pageup){if(n>0){n-=
T;if(n<0)n=0;X(b)}}else if(a===E.pagedown){if(n<D.length-1){n+=T;if(n>D.length-1)n=D.length-1;Y(b)}}else if(e.nonInput&&h.inArray(a,e.nonInput))d.html("").hide(b);else return g;m[w+"_keydown"]=g;return c}).bind({"keyup.autoComplete":function(b){if(!v||m[w+"_keydown"])return g;t=p.val();var a=(m=b).keyCode,c=G?t.split(G).pop():t;if(a!=E.enter){u.val=e.inputControl===i?c:e.inputControl.apply(f,e.backwardsCompatible?[c,a,d,b]:[b,{val:c,key:a,ul:d}]);if(u.val.length>=e.minChars)q(b,e,u,a===E.backspace||
a===E.space);else a==E.backspace&&d.html("").hide(b)}},"blur.autoComplete":function(b){if(!v||F)return g;m=b;p.data("ac-hasFocus",o);n=-1;j.order[0]!==i&&j.order.unshift(i);j.hasFocus=o;d.hide(b);if(e.onBlur)e.onBlur.apply(f,e.backwardsCompatible?[t,d,b]:[b,{val:t,ul:d}])},"focus.autoComplete":function(b,a){if(!v||j.focus===s&&a===w||m[w+"_enter"])return g;m=b;s!=d.data("ac-input-index")&&d.html("").hide(b);if(j.order[0]===i)if(j.order[1]===s)j.order.shift();else j.order[0]=s;else j.order[0]!=s&&
j.order[1]!=s&&j.order.unshift(s);j.order.length>j.defaults.cacheLimit&&j.order.pop();j.hasFocus=g;p.data("ac-hasFocus",g);if(e.onFocus)e.onFocus.apply(f,e.backwardsCompatible?[d,b]:[b,{ul:d}])},"autoComplete.settings":function(b,a){if(!v)return g;if(h.isFunction(a)){a=a.apply(f,e.backwardsCompatible?[e,u,d,b]:[b,{settings:e,cache:u,ul:d}]);if(h.isArray(a)&&a[0]!==i){e=h.extend(g,{},e,a[0]||e);u=h.extend(g,{},u,a[1]||u)}}else e=h.extend(g,{},e,a||{});d=!e.newList&&d.hasClass(e.list)?d:!e.newList&&
h("ul."+e.list)[0]?h("ul."+e.list).bgiframe().data("autoComplete",g):h("<ul/>").appendTo("body").addClass(e.list).bgiframe().hide().data({"ac-selfmade":g,autoComplete:g});Z();e.requestType=e.requestType.toUpperCase();G=e.multiple?e.multipleSeparator:i;p.data("ac-settings",e);return m=b},"autoComplete.flush":function(b,a){if(!v)return g;a||(S=0);u={length:0,val:i,list:{}};return m=b},"autoComplete.button-ajax":function(b,a,c){if(!v)return g;if(typeof a==="string"){c=a;a={}}m=b;p.trigger("focus",[w]);
u.val=c||w+"_button-ajax";return q(b,h.extend(g,{},e,{maxItems:-1,postData:a||{}}),u)},"autoComplete.button-supply":function(b,a,c){if(!v)return g;if(typeof a==="string"){c=a;a=i}m=b;p.trigger("focus",[w]);u.val=c||w+"_button-supply";a=h.isArray(a)&&a.length?a:e.dataSupply;return q(b,h.extend(g,{},e,{maxItems:-1,dataSupply:a,dataFn:function(){return g}}),u)},"autoComplete.direct-supply":function(b,a,c){if(!v)return g;if(typeof a==="string"){c=a;a=i}m=b;p.trigger("focus",[w]);u.val=c||w+"_direct-supply";
a=h.isArray(a)&&a.length?a:e.dataSupply;return Q(b,a,h.extend(g,{},e,{maxItems:-1,dataSupply:a,dataFn:function(){return g}}),u)},"autoComplete.search":function(b,a){if(!v)return g;u.val=a||"";return q(m=b,e,u)},"autoComplete.option":function(b){if(!v)return g;var a=V.call(arguments),c=a.length;m=b;if(c===3){e[a[1]]=a[2];return a[2]}else if(c===2)switch(a[1]){case "ul":return d;case "cache":return u;case "xhr":return P;case "input":return p;default:return e[a[1]]||i}else return e},"autoComplete.enable":function(b){p.data("ac-active",
v=g);return m=b},"autoComplete.disable":function(b){p.data("ac-active",v=o);d.html("").hide(b);return m=b},"autoComplete.destroy":function(b){var a=d.html("").hide(b).data("ac-inputs"),c;p.removeData("autoComplete").removeData("ac-input-index").removeData("ac-initial-settings").removeData("ac-settings").removeData("ac-active").unbind(".autoComplete autoComplete").closest("form").unbind("submit.autoComplete-"+s);ba.unbind("click.autoComplete-"+s);j.remove(s);v=o;a[s]=i;m=b;for(c in a)if(a.hasOwnProperty(c)&&
a[c]===g)return m;d.data("ac-selfmade")===g&&d.remove();return m}}).closest("form").bind("submit.autoComplete-"+s,function(b){if(!v)return g;var a=m[w+"_enter"]||o;m=b;return e.preventEnterSubmit?F||a?o:e.onSubmit.call(f,b,{form:this,ul:d}):e.onSubmit.call(f,b,{form:this,ul:d})});Z();e.requestType=e.requestType.toUpperCase();G=e.multiple?e.multipleSeparator:i;j.stack[s]=f}})(jQuery,window||this);
