/*!
 * Auto Complete [VERSION]
 * [DATE]
 * Corey Hart @ http://www.codenothing.com
 */ 
(function(f,i){f.fn.autoComplete=function(){var l=R.call(arguments),h=this,j=l.shift(),s=typeof j==="string";if(s)j=j.replace(".","-");l=j==="button-supply"||j==="direct-supply"?f.isArray(l[0])&&f.isArray(l[0][0])?l[0]:l:l[1]===i&&f.isArray(l[0])?l[0]:l;return s?h[j==="option"&&l.length<2?"triggerHandler":"trigger"]("autoComplete."+j,l):j&&j[f.expando]?h.trigger(j,l):h.each(function(){W.call(this,j)})};f.fn.bgiframe=f.fn.bgiframe?f.fn.bgiframe:f.fn.bgIframe?f.fn.bgIframe:function(){return this};f.expando=
f.expando!==i?f.expando:function(){var l=f.Event("keyup"),h;for(h in l)if(h.indexOf("jQuery")===0)return h;return"jQuery"+l.timeStamp}();function X(){return(new Date).getTime()}var g=true,p=false,R=Array.prototype.slice,k=f.autoComplete={counter:0,length:0,stack:{},order:[],hasFocus:p,getFocus:function(){return this.order[0]?this.stack[this.order[0]]:i},getPrevious:function(){for(var l=0,h=k.order.length;++l<h;)if(k.order[l])return k.stack[k.order[l]]},remove:function(l){for(var h=-1,j=k.order.length;++h<
j;)if(k.order[h]===l)k.order[h]=i;k.stack[l]=i;k.length--;delete k.stack[l]},getAll:function(){for(var l=-1,h=k.counter,j=[];++l<h;)k.stack[l]&&j.push(k.stack[l]);return f(j)},defaults:{backwardsCompatible:p,ajax:"ajax.php",ajaxCache:f.ajaxSettings.cache,dataSupply:[],dataFn:i,list:"auto-complete-list",rollover:"auto-complete-list-rollover",width:i,striped:i,maxHeight:i,newList:p,postVar:"value",postData:{},postFormat:i,minChars:1,maxItems:-1,maxRequests:0,requestType:"POST",inputControl:i,autoFill:p,
nonInput:i,multiple:p,multipleSeparator:" ",onBlur:i,onFocus:i,onHide:i,onLoad:i,onMaxRequest:function(){},onRollover:i,onSelect:i,onShow:i,onSubmit:function(){return g},spinner:i,onListFormat:i,preventEnterSubmit:g,delay:0,useCache:g,cacheLimit:50}};function W(l){var h=this,j=f(h).attr("autocomplete","off"),s=g,o={},u="",x=[],y={length:0},n,E,L,G,O,B=p,F,M,q=-1,r,C,t=function(){k.length++;return++k.counter}(),P=0,v={length:0,val:i,list:{}},d=f.extend({width:j.outerWidth()},k.defaults,l||{},f.metadata?
j.metadata():{}),e=!d.newList&&f("ul."+d.list)[0]?f("ul."+d.list).eq(0).bgiframe().data("autoComplete",g):f("<ul/>").appendTo("body").addClass(d.list).bgiframe().hide().data("ac-selfmade",g).data("autoComplete",g),Y=f(document).bind("click.autoComplete-"+t,function(b){var a;if(s&&B&&(!o||b.timeStamp-o.timeStamp>200)&&(a=f(b.target)).closest("ul").data("ac-input-index")!==t&&a.data("ac-input-index")!==t){e.hide(b);j.blur()}o=b});S();d.requestType=d.requestType.toUpperCase();C=d.multiple?d.multipleSeparator:
i;k.stack[t]=h;j.data("autoComplete",g).data("ac-input-index",t).data("ac-active",s).data("ac-initial-settings",f.extend(g,{},d)).data("ac-settings",d).bind(window.opera?"keypress.autoComplete":"keydown.autoComplete",function(b){if(!s)return g;var a=(o=b).keyCode,c=p;if(a==9&&B)T(b);else if(a==13&&n){c=d.preventEnterSubmit&&B?p:g;T(b)}else if(a==38)if(q>0){q--;U(b)}else{q=-1;j.val(u);e.hide(b)}else if(a==40){if(q<y.length-1){q++;V(b)}}else if(a==33){if(q>0){q-=O;if(q<0)q=0;U(b)}}else if(a==34){if(q<
y.length-1){q+=O;if(q>y.length-1)q=y.length-1;V(b)}}else if(d.nonInput&&f.inArray(a,d.nonInput))e.html("").hide(b);else return g;o[f.expando+"_autoComplete_keydown"]=g;return c}).bind("keyup.autoComplete",function(b){if(!s||o[f.expando+"_autoComplete_keydown"])return g;u=j.val();var a=(o=b).keyCode,c=C?u.split(C).pop():u;if(a!=13){v.val=d.inputControl===i?c:d.inputControl.apply(h,d.backwardsCompatible?[c,a,e,b]:[b,{val:c,key:a,ul:e}]);if(v.val.length>=d.minChars)H(b,d,v,a==8||a==32);else a==8&&e.html("").hide(b)}}).bind("blur.autoComplete",
function(b){if(!s||B)return g;o=b;j.data("ac-hasFocus",p);q=-1;k.order[0]!==i&&k.order.unshift(i);k.hasFocus=p;e.hide(b);if(d.onBlur)d.onBlur.apply(h,d.backwardsCompatible?[u,e,b]:[b,{val:u,ul:e}])}).bind("focus.autoComplete",function(b,a){if(!s||k.focus===t&&a===f.expando+"_autoComplete"||o[f.expando+"_autoComplete_enter"])return g;o=b;t!=e.data("ac-input-index")&&e.html("").hide(b);j.data("ac-hasFocus",g);if(k.order[0]===i)if(k.order[1]===t)k.order.shift();else k.order[0]=t;else k.order[0]!=t&&
k.order[1]!=t&&k.order.unshift(t);k.order.length>k.defaults.cacheLimit&&k.order.pop();k.hasFocus=g;if(d.onFocus)d.onFocus.apply(h,d.backwardsCompatible?[e,b]:[b,{ul:e}])}).bind("autoComplete.settings",function(b,a){if(!s)return g;if(f.isFunction(a)){a=a.apply(h,d.backwardsCompatible?[d,v,e,b]:[b,{settings:d,cache:v,ul:e}]);if(f.isArray(a)&&a[0]!==i){d=f.extend(g,{},d,a[0]||d);v=f.extend(g,{},v,a[1]||v)}}else d=f.extend(g,{},d,a||{});d.requestType=d.requestType.toUpperCase();C=d.multiple?d.multipleSeparator:
i;j.data("ac-settings",d);e=!d.newList&&e.hasClass(d.list)?e:!d.newList&&f("ul."+d.list)[0]?f("ul."+d.list).bgiframe().data("autoComplete",g):f("<ul/>").appendTo("body").addClass(d.list).bgiframe().hide().data("ac-selfmade",g).data("autoComplete",g);S();return o=b}).bind("autoComplete.flush",function(b,a){if(!s)return g;v={length:0,val:i,list:{}};a||(P=0);return o=b}).bind("autoComplete.button-ajax",function(b,a,c){if(!s)return g;o=b;j.trigger("focus",[f.expando+"_autoComplete"]);if(typeof a==="string"){c=
a;a={}}v.val=c||"NON_404_<>!@$^&";return H(b,f.extend(g,{},d,{maxItems:-1,postData:a||{}}),v)}).bind("autoComplete.button-supply",function(b,a,c){if(!s)return g;o=b;j.trigger("focus",[f.expando+"_autoComplete"]);if(typeof a==="string"){c=a;a=i}v.val=c||"NON_404_SUPPLY_<>!@$^&";a=f.isArray(a)&&a.length?a:d.dataSupply;return H(b,f.extend(g,{},d,{maxItems:-1,dataSupply:a,dataFn:function(){return g}}),v)}).bind("autoComplete.direct-supply",function(b,a,c){if(!s)return g;o=b;j.trigger("focus",[f.expando+
"_autoComplete"]);if(typeof a==="string"){c=a;a=i}v.val=c||"NON_404_SUPPLY_<>!@$^&";a=f.isArray(a)&&a.length?a:d.dataSupply;return N(b,a,f.extend(g,{},d,{maxItems:-1,dataSupply:a,dataFn:function(){return g}}),v)}).bind("autoComplete.search",function(b,a){if(!s)return g;v.val=a||"";return H(o=b,d,v)}).bind("autoComplete.option",function(b){if(!s)return g;o=b;var a=R.call(arguments),c=a.length;return c==3?function(){d[a[1]]=a[2];j.data("ac-settings",d);return a[2]}():c==2?function(){switch(a[1]){case "ul":return e;
case "cache":return v;case "xhr":return M;case "input":return j;default:return d[a[1]]||i}}():d}).bind("autoComplete.enable",function(b){j.data("ac-active",s=g);return o=b}).bind("autoComplete.disable",function(b){j.data("ac-active",s=p);e.html("").hide(b);return o=b}).bind("autoComplete.destroy",function(b){j.removeData("autoComplete").removeData("ac-input-index").removeData("ac-initial-settings").removeData("ac-settings").removeData("ac-active").unbind(".autoComplete").unbind("autoComplete."+["settings",
"flush","button-ajax","button-supply","direct-supply","search","option","enable","disable","destroy"].join(" autoComplete.")).parents("form").eq(0).unbind("submit.autoComplete-"+t);Y.unbind("click.autoComplete-"+t);k.remove(t);s=p;var a=e.html("").hide(b).data("ac-inputs"),c;a[t]=i;for(c in a)if(a[c]===g)return o=b;e.data("ac-selfmade")===g&&e.remove();return o=b}).parents("form").eq(0).bind("submit.autoComplete-"+t,function(b){if(!s)return g;var a=o[f.expando+"_autoComplete_enter"]||p;o=b;return d.preventEnterSubmit?
B||a?p:d.onSubmit.call(h,b,{form:this,ul:e}):d.onSubmit.call(h,b,{form:this,ul:e})});function H(b,a,c,m,z){a.spinner&&a.spinner.call(h,b,{active:g,ul:e});if(F)F=clearTimeout(F);if(a.delay>0&&z===i)return F=setTimeout(function(){H(b,a,c,m,g);F=clearTimeout(F)},a.delay);M&&M.abort();if(a.useCache&&c.list[c.val])return N(b,c.list[c.val],a,c,m);if(a.dataSupply.length)return Z(b,a,c,m);if(a.maxRequests&&++P>=a.maxRequests){e.html("").hide(b);a.spinner&&a.spinner.call(h,b,{active:p,ul:e});return P>a.maxRequests?
p:a.onMaxRequest.apply(h,a.backwardsCompatible?[c.val,e,b,u]:[b,{search:c.val,val:u,ul:e}])}a.postData[a.postVar]=c.val;return M=f.ajax({type:a.requestType,url:a.ajax,data:a.postFormat?a.postFormat.call(h,b,{data:a.postData,search:c.val,val:u,ul:e}):a.postData,dataType:"json",cache:a.ajaxCache,success:function(A){N(b,A,a,c,m)},error:function(){e.html("").hide(b);a.spinner&&a.spinner.call(h,b,{active:p,ul:e})}})}function Z(b,a,c,m){for(var z=[],A=[],D=f.isFunction(a.dataFn),I=D?i:new RegExp("^"+c.val,
"i"),Q=0,w,J=0,$=a.dataSupply.length;J<$;J++){w=a.dataSupply[J];w=typeof w==="object"&&w.value?w:{value:w};A=a.backwardsCompatible?[c.val,w.value,z,J,a.dataSupply,e,b]:[b,{val:c.val,entry:w.value,list:z,i:J,supply:a.dataSupply,ul:e}];if(D&&a.dataFn.apply(h,A)||!D&&w.value.match(I)){if(a.maxItems>-1&&++Q>a.maxItems)break;z.push(w)}}return N(b,z,a,c,m)}function T(b){if(B){if(d.onSelect)d.onSelect.apply(h,d.backwardsCompatible?[r,n,e,b]:[b,{data:r,li:n,ul:e}]);K(i);u=j.val();if(o.type=="keydown")o[f.expando+
"_autoComplete_enter"]=g}e.hide(b);return n}function U(b){n&&n.removeClass(d.rollover);e.show(b);n=y.eq(q).addClass(d.rollover);r=x[q];if(!n.length||!r)return p;K(r.value||"");if(d.onRollover)d.onRollover.apply(h,d.backwardsCompatible?[r,n,e,b]:[b,{data:r,li:n,ul:e}]);b=q*G;if(b<E-L){E=b+L;e.scrollTop(b)}return n}function V(b){n&&n.removeClass(d.rollover);e.show(b);n=y.eq(q).addClass(d.rollover);r=x[q];if(!n.length||!r)return p;K(r.value||"");var a=(q+1)*G;if(a>E)e.scrollTop((E=a)-L);if(d.onRollover)d.onRollover.apply(h,
d.backwardsCompatible?[r,n,e,b]:[b,{data:r,li:n,ul:e}]);return n}function S(){if(!e[f.expando+"_autoComplete"]){var b=e.hide,a=e.show;e.hide=function(m,z,A){if(d.onHide&&B){d.onHide.call(h,m,{ul:e});o[f.expando+"_autoComplete_hide"]=g}B=p;return b.call(e,z,A)};e.show=function(m,z,A){d.onShow&&!B&&d.onShow.call(h,m,{ul:e});B=g;return a.call(e,z,A)};e[f.expando+"_autoComplete"]=g}var c=e.data("ac-inputs")||{};c[t]=g;return e.data("ac-inputs",c)}function K(b){if(b===i){var a,c;a=c=j.val().length}else{if(C)b=
u.substr(0,u.length-u.split(C).pop().length)+b+C;a=u.length;c=b.length;j.val(b)}if(!d.autoFill||a>c)return p;else if(h.createTextRange){var m=h.createTextRange();if(b===i)m.move("character",a);else{m.collapse(g);m.moveStart("character",a);m.moveEnd("character",c)}m.select()}else if(h.setSelectionRange)h.setSelectionRange(a,c);else if(h.selectionStart){h.selectionStart=a;h.selectionEnd=c}return g}function N(b,a,c,m,z){x=c.onLoad?c.onLoad.call(h,b,{list:a,settings:c,cache:m,ul:e}):a;c.spinner&&c.spinner.call(h,
b,{active:p,ul:e});if(c.useCache&&m.list[m.val]===i){m.length++;m.list[m.val]=a;if(m.length>c.cacheLimit){m.list={};m.length=0}}if(!x||x.length<1)return e.html("").hide(b);q=-1;if(c.onListFormat)c.onListFormat.call(h,b,{list:x,settings:c,cache:m,ul:e});else{var A=j.offset();a=[];m=0;for(var D=-1,I=p,Q=x.length;++D<Q;)if(x[D].value){if(c.maxItems>-1&&++m>c.maxItems)break;a.push(c.striped&&I?'<li class="'+c.striped+'">':"<li>",x[D].display||x[D].value,"</li>");I=!I}e.html(a.join(""))}y=e.children("li");
if(c.autoFill&&!z){q=0;r=x[0];K(r.value||"");n=y.eq(0).addClass(c.rollover)}e.unbind(".autoComplete").data("ac-input-index",t).bind("mouseout.autoComplete",function(){n.removeClass(c.rollover)}).bind("mouseover.autoComplete",function(w){n=f(w.target).closest("li");if(n.length<1)return p;y.filter("."+c.rollover).removeClass(c.rollover);q=y.index(n[0]);r=x[q];n.addClass(c.rollover);if(c.onRollover)c.onRollover.apply(h,c.backwardsCompatible?[r,n,e,w]:[w,{data:r,li:n,ul:e}])}).bind("click.autoComplete",
function(w){j.trigger("focus",[f.expando+"_autoComplete"]);j.val(u=C?u.substr(0,u.length-u.split(C).pop().length)+r.value+C:r.value);e.hide(w);K(i);if(c.onSelect)c.onSelect.apply(h,c.backwardsCompatible?[r,n,e,w]:[w,{data:r,li:n,ul:e}])}).css({top:A.top+j.outerHeight(),left:A.left,width:c.width}).scrollTop(0);if(c.maxHeight)e.css({height:G*y.length>c.maxHeight?c.maxHeight:"auto",overflow:"auto"});E=L=e.show(b).outerHeight();G=y.eq(0).outerHeight();O=Math.floor(E/G);o.timeStamp=X();return e}}})(jQuery);
